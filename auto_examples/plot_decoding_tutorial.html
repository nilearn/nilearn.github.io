
<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Nilearn: Machine learning for NeuroImaging in Python &mdash; Machine learning for NeuroImaging</title>
    
    <link rel="stylesheet" href="../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/gallery.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.2.5',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/copybutton.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="top" title="Machine learning for NeuroImaging" href="../index.html" />
    <link rel="up" title="General examples" href="index.html" />
    <link rel="next" title="Basic Atlas plotting" href="01_plotting/plot_atlas.html" />
    <link rel="prev" title="3D and 4D niimgs: handling and visualizing" href="plot_3d_and_4d_niimg.html" />
<meta content="True" name="HandheldFriendly">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
<meta name="keywords" content="nilearn, neuroimaging, python, neuroscience, machinelearning">
<script type="text/javascript">
$(function () {
    // Lock the table of content to a fixed position once we scroll enough
    var top = 105 + $('.sphinxsidebarwrapper').offset().top - parseFloat($('.sphinxsidebarwrapper').css('margin-top').replace(/auto/, 0)),
        sections = {},
        i        = 0,
	url	 = document.URL.replace(/#.*$/, ""),
	current_section = 0;

    // Grab positions of our sections
    $('.headerlink').each(function(){
        sections[this.href.replace(url, '')] = $(this).offset().top - 50;
    });

    $(window).scroll(function(event) {
	var pos   = $(window).scrollTop();
	// Lock the table of content to a fixed position once we scroll enough
	if(pos > top){
	    //begin to scroll
	    $('.sphinxsidebarwrapper').css("position", "fixed");
	    $('.sphinxsidebarwrapper').css("top", -105);
	}
	else{
	    //lock it back into place
	    $('.sphinxsidebarwrapper').css("position", "relative");
	    $('.sphinxsidebarwrapper').css("top",0);
	}

	// Highlight the current section
	$('a.internal').removeClass('active');
        for(i in sections){
            if(sections[i] > pos){
		break;
            };
	    if($('a.internal[href$="' + i + '"]').is(':visible')){
		current_section = i;
	    };
        }
	$('a.internal[href$="' + current_section + '"]').addClass('active');
    });

});
</script>


<script type="text/javascript">

        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-41920728-1']);
        _gaq.push(['_trackPageview']);

        (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
    </script>

  </head>
  <body>
<div id="logo-banner">
  <div class="logo">
    <a href="../index.html">
      <img src="../_static/nilearn-logo.png" alt="Nilearn logo"  border="0" />
    </a>
  </div>
  <!-- A tag cloud to make it easy for people to find what they are
                         looking for -->
 <div class="tags">
  <ul>
    <li>
      <big><a href="decoding/plot_haxby_anova_svm.html">SVM</a></big>
    </li>
    <li>
      <small><a href="../connectivity/parcellating.html">Ward
          clustering</a></small>
    </li>
    <li>
      <a href="../decoding/searchlight.html">Searchlight</a>
    </li>
    <li>
      <big><a href="../connectivity/resting_state_networks.html">ICA</a></big>
    </li>
    <li>
      <a href="../manipulating_images/data_preparation.html">Nifti IO</a>
    </li>
    <li>
      <a href="../modules/reference.html#module-nilearn.datasets">Datasets</a>
    </li>
  </ul>
 </div>

  <div class="banner">
    <h1>Nilearn:</h1>
    <h2>Machine learning for Neuro-Imaging in Python</h2>
  </div>
  <div class="search_form">
    <div id="cse" style="width: 100%;"></div>
    <script src="http://www.google.com/jsapi" type="text/javascript"></script>
    <script type="text/javascript">
      google.load('search', '1', {language : 'en'});
      google.setOnLoadCallback(function() {
      var customSearchControl = new google.search.CustomSearchControl('014136483057745874622:r-npolb1uki');
      customSearchControl.setResultSetSize(google.search.Search.FILTERED_CSE_RESULTSET);
      var options = new google.search.DrawOptions();
      options.setAutoComplete(true);
      customSearchControl.draw('cse', options);
      }, true);
    </script>
  </div>
</div>



    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="01_plotting/plot_atlas.html" title="Basic Atlas plotting"
             accesskey="N">next</a></li>
        <li class="right" >
          <a href="plot_3d_and_4d_niimg.html" title="3D and 4D niimgs: handling and visualizing"
             accesskey="P">previous</a> |</li>
<li><a href="../index.html">Nilearn Home</a> |&nbsp;</li>
<li><a href="../user_guide.html">User Guide</a> |&nbsp;</li>
<li><a href="index.html">Examples</a> |&nbsp;</li>
<li><a href="../modules/reference.html">Reference</a> |&nbsp;</li>
<li id="navbar-about"><a href="../authors.html">About</a>|&nbsp;</li>
<li id="navbar-ecosystem"><a href="http://www.nipy.org/">Nipy ecosystem</a></li>

          <li><a href="index.html" accesskey="U">General examples</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">


<h4> Giving credit </h4>
  <ul class="simple">
    <li><p>Please consider <a href="../authors.html#citing">citing the
                    papers</a>.</p></li>
  </ul>

  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">A introduction tutorial to fMRI decoding</a><ul>
<li><a class="reference internal" href="#retrieve-and-load-the-fmri-data-from-the-haxby-study">Retrieve and load the fMRI data from the  Haxby study</a><ul>
<li><a class="reference internal" href="#first-download-the-data">First download the data</a></li>
<li><a class="reference internal" href="#convert-the-fmri-volume-s-to-a-data-matrix">Convert the fMRI volume&#8217;s to a data matrix</a></li>
<li><a class="reference internal" href="#load-the-behavioral-labels">Load the behavioral labels</a></li>
<li><a class="reference internal" href="#restrict-the-analysis-to-cats-and-faces">Restrict the analysis to cats and faces</a></li>
</ul>
</li>
<li><a class="reference internal" href="#decoding-with-an-svm">Decoding with an SVM</a></li>
<li><a class="reference internal" href="#measuring-prediction-scores-using-cross-validation">Measuring prediction scores using cross-validation</a><ul>
<li><a class="reference internal" href="#manually-leaving-out-data">Manually leaving out data</a></li>
<li><a class="reference internal" href="#implementing-a-kfold-loop">Implementing a KFold loop</a></li>
<li><a class="reference internal" href="#cross-validation-with-scikit-learn">Cross-validation with scikit-learn</a></li>
</ul>
</li>
<li><a class="reference internal" href="#inspecting-the-model-weights">Inspecting the model weights</a><ul>
<li><a class="reference internal" href="#turning-the-weights-into-a-nifti-image">Turning the weights into a nifti image</a></li>
<li><a class="reference internal" href="#plotting-the-svm-weights">Plotting the SVM weights</a></li>
</ul>
</li>
<li><a class="reference internal" href="#further-reading">Further reading</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="plot_3d_and_4d_niimg.html"
                        title="previous chapter">3D and 4D niimgs: handling and visualizing</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="01_plotting/plot_atlas.html"
                        title="next chapter">Basic Atlas plotting</a></p>

<div class="navbar">
</div> <!-- end navbar -->

<script type="text/javascript">$('#searchbox-ml').show(0);</script>
<script type="text/javascript">$('#searchbox-site').show(0);</script>


        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="a-introduction-tutorial-to-fmri-decoding">
<span id="sphx-glr-auto-examples-plot-decoding-tutorial-py"></span><h1>A introduction tutorial to fMRI decoding<a class="headerlink" href="#a-introduction-tutorial-to-fmri-decoding" title="Permalink to this headline">¶</a></h1>
<p>Here is a simple tutorial on decoding with nilearn. It reproduces the
Haxby 2001 study on a face vs cat discrimination task in a mask of the
ventral stream.</p>
<p>This tutorial is meant as an introduction to the various steps of a
decoding analysis.</p>
<p>It is not a minimalistic example, as it strives to be didactic. It is not
meant to be copied to analyze new data: many of the steps are unecessary.</p>
<div class="contents local topic" id="contents">
<p class="topic-title first"><strong>Contents</strong></p>
<ul class="simple">
<li><a class="reference internal" href="#retrieve-and-load-the-fmri-data-from-the-haxby-study" id="id1">Retrieve and load the fMRI data from the  Haxby study</a></li>
<li><a class="reference internal" href="#decoding-with-an-svm" id="id2">Decoding with an SVM</a></li>
<li><a class="reference internal" href="#measuring-prediction-scores-using-cross-validation" id="id3">Measuring prediction scores using cross-validation</a></li>
<li><a class="reference internal" href="#inspecting-the-model-weights" id="id4">Inspecting the model weights</a></li>
<li><a class="reference internal" href="#further-reading" id="id5">Further reading</a></li>
</ul>
</div>
<div class="section" id="retrieve-and-load-the-fmri-data-from-the-haxby-study">
<h2><a class="toc-backref" href="#id1">Retrieve and load the fMRI data from the  Haxby study</a><a class="headerlink" href="#retrieve-and-load-the-fmri-data-from-the-haxby-study" title="Permalink to this headline">¶</a></h2>
<div class="section" id="first-download-the-data">
<h3>First download the data<a class="headerlink" href="#first-download-the-data" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference internal" href="../modules/generated/nilearn.datasets.fetch_haxby.html#nilearn.datasets.fetch_haxby" title="nilearn.datasets.fetch_haxby"><tt class="xref py py-func docutils literal"><span class="pre">nilearn.datasets.fetch_haxby</span></tt></a> function will download the
Haxby dataset if not present on the disk, in the nilear data directory.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">nilearn</span> <span class="kn">import</span> <span class="n">datasets</span>
<span class="n">haxby_dataset</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">fetch_haxby</span><span class="p">()</span>
<span class="n">fmri_filename</span> <span class="o">=</span> <span class="n">haxby_dataset</span><span class="o">.</span><span class="n">func</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="c"># print basic information on the dataset</span>
<span class="k">print</span><span class="p">(</span><span class="s">&#39;First subject functional nifti images (4D) are at: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span>
      <span class="n">fmri_filename</span><span class="p">)</span>  <span class="c"># 4D data</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-python"><div class="highlight"><pre>First subject functional nifti images (4D) are at: /home/varoquau/nilearn_data/haxby2001/subj1/bold.nii.gz
</pre></div>
</div>
</div>
<div class="section" id="convert-the-fmri-volume-s-to-a-data-matrix">
<h3>Convert the fMRI volume&#8217;s to a data matrix<a class="headerlink" href="#convert-the-fmri-volume-s-to-a-data-matrix" title="Permalink to this headline">¶</a></h3>
<p>We will use the <a class="reference internal" href="../modules/generated/nilearn.input_data.NiftiMasker.html#nilearn.input_data.NiftiMasker" title="nilearn.input_data.NiftiMasker"><tt class="xref py py-class docutils literal"><span class="pre">nilearn.input_data.NiftiMasker</span></tt></a> to extract the
fMRI data on a mask and convert it to data series.</p>
<p>The mask is a mask of the Ventral Temporal streaming coming from the
Haxby study:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">mask_filename</span> <span class="o">=</span> <span class="n">haxby_dataset</span><span class="o">.</span><span class="n">mask_vt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="c"># Let&#39;s visualize it, using the subject&#39;s anatomical image as a</span>
<span class="c"># background</span>
<span class="kn">from</span> <span class="nn">nilearn</span> <span class="kn">import</span> <span class="n">plotting</span>
<a href="../modules/generated/nilearn.plotting.plot_roi.html#nilearn.plotting.plot_roi"><span class="n">plotting</span><span class="o">.</span><span class="n">plot_roi</span></a><span class="p">(</span><span class="n">mask_filename</span><span class="p">,</span> <span class="n">bg_img</span><span class="o">=</span><span class="n">haxby_dataset</span><span class="o">.</span><span class="n">anat</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                 <span class="n">cmap</span><span class="o">=</span><span class="s">&#39;Paired&#39;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../_images/sphx_glr_plot_decoding_tutorial_001.png" class="align-center" src="../_images/sphx_glr_plot_decoding_tutorial_001.png" />
<p>Now we use the NiftiMasker.</p>
<p>We first create a masker, giving it the options that we care
about. Here we use standardizing of the data, as it is often important
for decoding</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">nilearn.input_data</span> <span class="kn">import</span> <a href="../modules/generated/nilearn.input_data.NiftiMasker.html#nilearn.input_data.NiftiMasker"><span class="n">NiftiMasker</span></a>
<span class="n">masker</span> <span class="o">=</span> <a href="../modules/generated/nilearn.input_data.NiftiMasker.html#nilearn.input_data.NiftiMasker"><span class="n">NiftiMasker</span></a><span class="p">(</span><span class="n">mask_img</span><span class="o">=</span><span class="n">mask_filename</span><span class="p">,</span> <span class="n">standardize</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="c"># We give the masker a filename and retrieve a 2D array ready</span>
<span class="c"># for machine learning with scikit-learn</span>
<span class="n">fmri_masked</span> <span class="o">=</span> <span class="n">masker</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">fmri_filename</span><span class="p">)</span>
</pre></div>
</div>
<p>The variable &#8220;fmri_masked&#8221; is a numpy array:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">print</span><span class="p">(</span><span class="n">fmri_masked</span><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-python"><div class="highlight"><pre> [[-2.25146627  1.11008501 -0.38940424 ..., -1.31005859 -0.82755452
  1.04562497]
[-1.99929178  0.90351063 -0.78263468 ..., -1.76820636 -0.66073179
 -0.30779985]
[-1.72771943  0.8471722  -0.71709627 ..., -1.16538048 -1.11570287
  0.35240737]
...,
[ 0.28967512 -1.70683813 -2.66686344 ...,  1.28209257  1.0074954
  1.24368715]
[ 0.75522774 -1.61294067 -2.8307097  ...,  1.71612716  1.37147236
  1.07863522]
[ 0.17328696 -1.59416115 -2.71601725 ...,  1.58350551  1.56862628
  1.57379067]]
</pre></div>
</div>
<p>Its shape corresponds to the number of time-points times the number of
voxels in the mask</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">print</span><span class="p">(</span><span class="n">fmri_masked</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-python"><div class="highlight"><pre><span class="p">(</span><span class="mi">1452</span><span class="p">,</span> <span class="mi">577</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="load-the-behavioral-labels">
<h3>Load the behavioral labels<a class="headerlink" href="#load-the-behavioral-labels" title="Permalink to this headline">¶</a></h3>
<p>The behavioral labels are stored in a CSV file, separated by spaces.</p>
<p>We use numpy to load them in an array.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="c"># Load target information as string and give a numerical identifier to each</span>
<span class="n">labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">recfromcsv</span><span class="p">(</span><span class="n">haxby_dataset</span><span class="o">.</span><span class="n">session_target</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">delimiter</span><span class="o">=</span><span class="s">&quot; &quot;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-python"><div class="highlight"><pre> [(&#39;rest&#39;, 0) (&#39;rest&#39;, 0) (&#39;rest&#39;, 0) ..., (&#39;rest&#39;, 11) (&#39;rest&#39;, 11)
(&#39;rest&#39;, 11)]
</pre></div>
</div>
<p>Retrieve the behavioral targets, that we are going to predict in the
decoding</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">target</span> <span class="o">=</span> <span class="n">labels</span><span class="p">[</span><span class="s">&#39;labels&#39;</span><span class="p">]</span>
<span class="k">print</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-python"><div class="highlight"><pre>[&#39;rest&#39; &#39;rest&#39; &#39;rest&#39; ..., &#39;rest&#39; &#39;rest&#39; &#39;rest&#39;]
</pre></div>
</div>
</div>
<div class="section" id="restrict-the-analysis-to-cats-and-faces">
<h3>Restrict the analysis to cats and faces<a class="headerlink" href="#restrict-the-analysis-to-cats-and-faces" title="Permalink to this headline">¶</a></h3>
<p>As we can see from the targets above, the experiment contains many
conditions, not all that interest us for decoding.</p>
<p>To keep only data corresponding to faces or cats, we create a
mask of the samples belonging to the condition.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">condition_mask</span> <span class="o">=</span> <a href="http://docs.scipy.org/doc/numpy-1.6.0/reference/generated/numpy.logical_or.html#numpy.logical_or"><span class="n">np</span><span class="o">.</span><span class="n">logical_or</span></a><span class="p">(</span><span class="n">target</span> <span class="o">==</span> <span class="n">b</span><span class="s">&#39;face&#39;</span><span class="p">,</span> <span class="n">target</span> <span class="o">==</span> <span class="n">b</span><span class="s">&#39;cat&#39;</span><span class="p">)</span>

<span class="c"># We apply this mask in the sampe direction to restrict the</span>
<span class="c"># classification to the face vs cat discrimination</span>
<span class="n">fmri_masked</span> <span class="o">=</span> <span class="n">fmri_masked</span><span class="p">[</span><span class="n">condition_mask</span><span class="p">]</span>
</pre></div>
</div>
<p>We now have less samples</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">print</span><span class="p">(</span><span class="n">fmri_masked</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-python"><div class="highlight"><pre><span class="p">(</span><span class="mi">216</span><span class="p">,</span> <span class="mi">577</span><span class="p">)</span>
</pre></div>
</div>
<p>We apply the same mask to the targets</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">target</span> <span class="o">=</span> <span class="n">target</span><span class="p">[</span><span class="n">condition_mask</span><span class="p">]</span>
<span class="k">print</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-python"><div class="highlight"><pre><span class="p">(</span><span class="mi">216</span><span class="p">,)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="decoding-with-an-svm">
<h2><a class="toc-backref" href="#id2">Decoding with an SVM</a><a class="headerlink" href="#decoding-with-an-svm" title="Permalink to this headline">¶</a></h2>
<p>We will now use the <a class="reference external" href="http://www.scikit-learn.org">scikit-learn</a>
machine-learning toolbox on the fmri_masked data.</p>
<p>As a decoder, we use a Support Vector Classification, with a linear
kernel.</p>
<p>We first create it:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">sklearn.svm</span> <span class="kn">import</span> <a href="http://scikit-learn.org/stable/modules/generated/sklearn.svm.SVC.html#sklearn.svm.SVC"><span class="n">SVC</span></a>
<span class="n">svc</span> <span class="o">=</span> <a href="http://scikit-learn.org/stable/modules/generated/sklearn.svm.SVC.html#sklearn.svm.SVC"><span class="n">SVC</span></a><span class="p">(</span><span class="n">kernel</span><span class="o">=</span><span class="s">&#39;linear&#39;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">svc</span><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-python"><div class="highlight"><pre><a href="http://scikit-learn.org/stable/modules/generated/sklearn.svm.SVC.html#sklearn.svm.SVC"><span class="n">SVC</span></a><span class="p">(</span><span class="n">C</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">cache_size</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">class_weight</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">coef0</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
<span class="n">decision_function_shape</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">degree</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="s">&#39;auto&#39;</span><span class="p">,</span> <span class="n">kernel</span><span class="o">=</span><span class="s">&#39;linear&#39;</span><span class="p">,</span>
<span class="n">max_iter</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">probability</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">shrinking</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
<span class="n">tol</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</pre></div>
</div>
<p>The svc object is an object that can be fit (or trained) on data with
labels, and then predict labels on data without.</p>
<p>We first fit it on the data</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">svc</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">fmri_masked</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
</pre></div>
</div>
<p>We can then predict the labels from the data</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">prediction</span> <span class="o">=</span> <span class="n">svc</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">fmri_masked</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">prediction</span><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-python"><div class="highlight"><pre> [&#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;cat&#39; &#39;cat&#39;
&#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39;
&#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39;
&#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39;
&#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;cat&#39; &#39;cat&#39;
&#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39;
&#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39;
&#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39;
&#39;cat&#39; &#39;cat&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39;
&#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39;
&#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39;
&#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39;
&#39;face&#39; &#39;face&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;face&#39;
&#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39;
&#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39;
&#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39;
&#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;face&#39;
&#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39;
&#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;face&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39;
&#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39; &#39;cat&#39;]
</pre></div>
</div>
<p>Let&#8217;s measure the error rate:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">print</span><span class="p">((</span><span class="n">prediction</span> <span class="o">==</span> <span class="n">target</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">target</span><span class="p">)))</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-python"><div class="highlight"><pre><span class="mf">1.0</span>
</pre></div>
</div>
<p>This error rate is meaningless. Why?</p>
</div>
<div class="section" id="measuring-prediction-scores-using-cross-validation">
<h2><a class="toc-backref" href="#id3">Measuring prediction scores using cross-validation</a><a class="headerlink" href="#measuring-prediction-scores-using-cross-validation" title="Permalink to this headline">¶</a></h2>
<p>The proper way to measure error rates or prediction accuracy is via
cross-validation: leaving out some data and testing on it.</p>
<div class="section" id="manually-leaving-out-data">
<h3>Manually leaving out data<a class="headerlink" href="#manually-leaving-out-data" title="Permalink to this headline">¶</a></h3>
<p>Let&#8217;s leave out the 30 last data points during training, and test the
prediction on these 30 last points:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">svc</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">fmri_masked</span><span class="p">[:</span><span class="o">-</span><span class="mi">30</span><span class="p">],</span> <span class="n">target</span><span class="p">[:</span><span class="o">-</span><span class="mi">30</span><span class="p">])</span>

<span class="n">prediction</span> <span class="o">=</span> <span class="n">svc</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">fmri_masked</span><span class="p">[</span><span class="o">-</span><span class="mi">30</span><span class="p">:])</span>
<span class="k">print</span><span class="p">((</span><span class="n">prediction</span> <span class="o">==</span> <span class="n">target</span><span class="p">[</span><span class="o">-</span><span class="mi">30</span><span class="p">:])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">target</span><span class="p">[</span><span class="o">-</span><span class="mi">30</span><span class="p">:])))</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-python"><div class="highlight"><pre><span class="mf">0.633333333333</span>
</pre></div>
</div>
</div>
<div class="section" id="implementing-a-kfold-loop">
<h3>Implementing a KFold loop<a class="headerlink" href="#implementing-a-kfold-loop" title="Permalink to this headline">¶</a></h3>
<p>We can split the data in train and test set repetitively in a <cite>KFold</cite>
strategy:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">sklearn.cross_validation</span> <span class="kn">import</span> <a href="http://scikit-learn.org/stable/modules/generated/sklearn.cross_validation.KFold.html#sklearn.cross_validation.KFold"><span class="n">KFold</span></a>

<span class="n">cv</span> <span class="o">=</span> <a href="http://scikit-learn.org/stable/modules/generated/sklearn.cross_validation.KFold.html#sklearn.cross_validation.KFold"><span class="n">KFold</span></a><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">fmri_masked</span><span class="p">),</span> <span class="n">n_folds</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

<span class="k">for</span> <span class="n">train</span><span class="p">,</span> <span class="n">test</span> <span class="ow">in</span> <span class="n">cv</span><span class="p">:</span>
    <span class="n">svc</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">fmri_masked</span><span class="p">[</span><span class="n">train</span><span class="p">],</span> <span class="n">target</span><span class="p">[</span><span class="n">train</span><span class="p">])</span>
    <span class="n">prediction</span> <span class="o">=</span> <span class="n">svc</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">fmri_masked</span><span class="p">[</span><span class="n">test</span><span class="p">])</span>
    <span class="k">print</span><span class="p">((</span><span class="n">prediction</span> <span class="o">==</span> <span class="n">target</span><span class="p">[</span><span class="n">test</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">target</span><span class="p">[</span><span class="n">test</span><span class="p">])))</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-python"><div class="highlight"><pre>  0.727272727273
0.46511627907
0.720930232558
0.581395348837
0.744186046512
</pre></div>
</div>
</div>
<div class="section" id="cross-validation-with-scikit-learn">
<h3>Cross-validation with scikit-learn<a class="headerlink" href="#cross-validation-with-scikit-learn" title="Permalink to this headline">¶</a></h3>
<p>Scikit-learn has tools to perform cross-validation easier:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">sklearn.cross_validation</span> <span class="kn">import</span> <a href="http://scikit-learn.org/stable/modules/generated/sklearn.cross_validation.cross_val_score.html#sklearn.cross_validation.cross_val_score"><span class="n">cross_val_score</span></a>
<span class="n">cv_score</span> <span class="o">=</span> <a href="http://scikit-learn.org/stable/modules/generated/sklearn.cross_validation.cross_val_score.html#sklearn.cross_validation.cross_val_score"><span class="n">cross_val_score</span></a><span class="p">(</span><span class="n">svc</span><span class="p">,</span> <span class="n">fmri_masked</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">cv_score</span><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-python"><div class="highlight"><pre>[ 0.625       0.52777778  0.68055556]
</pre></div>
</div>
<p>Note that we can speed things up to use all the CPUs of our computer
with the n_jobs parameter.</p>
<p>By default, cross_val_score uses a 3-fold KFold. We can control this by
passing the &#8220;cv&#8221; object, here a 5-fold:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">cv_score</span> <span class="o">=</span> <a href="http://scikit-learn.org/stable/modules/generated/sklearn.cross_validation.cross_val_score.html#sklearn.cross_validation.cross_val_score"><span class="n">cross_val_score</span></a><span class="p">(</span><span class="n">svc</span><span class="p">,</span> <span class="n">fmri_masked</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">cv</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">cv_score</span><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-python"><div class="highlight"><pre>[ 0.72727273  0.46511628  0.72093023  0.58139535  0.74418605]
</pre></div>
</div>
<p>The best way to do cross-validation is to respect the structure of
the experiment, for instance by leaving out full sessions of
acquisition.</p>
<p>The number of the session is stored in the CSV file giving the
behavioral data. We have to apply our session mask, to select only cats
and faces. To leave a session out, we pass it to a
LeaveOneLabelOut object:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">session_label</span> <span class="o">=</span> <span class="n">labels</span><span class="p">[</span><span class="s">&#39;chunks&#39;</span><span class="p">][</span><span class="n">condition_mask</span><span class="p">]</span>

<span class="kn">from</span> <span class="nn">sklearn.cross_validation</span> <span class="kn">import</span> <a href="http://scikit-learn.org/stable/modules/generated/sklearn.cross_validation.LeaveOneLabelOut.html#sklearn.cross_validation.LeaveOneLabelOut"><span class="n">LeaveOneLabelOut</span></a>
<span class="n">cv</span> <span class="o">=</span> <a href="http://scikit-learn.org/stable/modules/generated/sklearn.cross_validation.LeaveOneLabelOut.html#sklearn.cross_validation.LeaveOneLabelOut"><span class="n">LeaveOneLabelOut</span></a><span class="p">(</span><span class="n">session_label</span><span class="p">)</span>
<span class="n">cv_score</span> <span class="o">=</span> <a href="http://scikit-learn.org/stable/modules/generated/sklearn.cross_validation.cross_val_score.html#sklearn.cross_validation.cross_val_score"><span class="n">cross_val_score</span></a><span class="p">(</span><span class="n">svc</span><span class="p">,</span> <span class="n">fmri_masked</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">cv</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">cv_score</span><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-python"><div class="highlight"><pre>[ 1.          0.61111111  0.94444444  0.88888889  0.88888889  0.94444444
0.72222222  0.94444444  0.5         0.72222222  0.5         0.55555556]
</pre></div>
</div>
</div>
</div>
<div class="section" id="inspecting-the-model-weights">
<h2><a class="toc-backref" href="#id4">Inspecting the model weights</a><a class="headerlink" href="#inspecting-the-model-weights" title="Permalink to this headline">¶</a></h2>
<p>Finally, it may be useful to inspect and display the model weights.</p>
<div class="section" id="turning-the-weights-into-a-nifti-image">
<h3>Turning the weights into a nifti image<a class="headerlink" href="#turning-the-weights-into-a-nifti-image" title="Permalink to this headline">¶</a></h3>
<p>We retrieve the SVC discriminating weights</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">coef_</span> <span class="o">=</span> <span class="n">svc</span><span class="o">.</span><span class="n">coef_</span>
<span class="k">print</span><span class="p">(</span><span class="n">coef_</span><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-python"><div class="highlight"><pre>[[ -4.03108891e-02  -3.49412808e-02  -1.70223087e-02  -3.42159057e-03
 -2.33893667e-02  -1.22940103e-02  -2.79866312e-02  -1.52685970e-02
 -1.36452221e-02  -3.23905377e-02  -2.26553880e-03  -6.13453888e-02
 -2.50680842e-02   2.41239333e-02  -3.97237046e-02   2.46573345e-02
 -2.67997500e-02  -2.41813969e-02  -5.66277288e-02  -1.62779798e-02
  3.59979712e-03  -3.51138649e-03  -2.19785252e-02  -1.03746823e-02
  3.41675262e-02  -6.03516535e-04  -3.16508567e-02  -1.26717950e-02
 -2.68206252e-02   1.56282120e-02  -4.60449159e-02  -3.08783179e-02
 -3.09531222e-02  -2.60623211e-02  -4.04018099e-02  -1.91451953e-02
 -1.79200521e-02   4.20827401e-04  -1.63643999e-04   1.28799775e-02
 -2.14542008e-02  -3.79804039e-02   3.47548934e-03  -2.27829740e-02
  1.05304886e-02   5.10571035e-02  -5.96033709e-02  -1.21514715e-02
 -1.32891972e-02   2.74404987e-03  -2.64419989e-02  -2.72180564e-02
  9.81565551e-03  -2.28569302e-02   1.79850222e-02   5.12699359e-03
  2.26668770e-02   1.13485019e-02  -1.37285976e-02  -8.42849382e-03
  1.80805127e-02   3.25851907e-02   4.49505926e-02   2.65420287e-02
 -4.14040229e-03  -2.57342422e-03   9.49777195e-03  -8.87820161e-03
 -1.43446551e-02  -3.28213123e-02   1.85465075e-02   1.15539312e-02
  1.58250066e-02  -3.66900390e-02   1.33679808e-02  -2.80167282e-03
 -6.78624970e-03  -1.39389464e-02   7.11005106e-03   1.25255293e-03
 -9.93324998e-03  -1.98938034e-02   9.30365154e-03  -1.80082169e-02
 -7.50651663e-02  -1.36555015e-02  -1.93083157e-04  -1.00708412e-02
  2.27116741e-02  -7.27886725e-03  -1.09759670e-03  -1.64105528e-02
  1.86844766e-02   2.23105459e-02   3.25910235e-02  -1.43157291e-02
 -5.12380653e-02  -3.09087809e-03   1.99446574e-02   4.30448615e-03
  1.03896134e-02  -1.25207421e-02  -2.59542007e-02  -4.62812876e-02
 -1.94396688e-02  -9.39224302e-02  -5.27409151e-02  -1.38402826e-02
 -3.66717507e-02  -8.61988081e-04  -1.67515616e-02   1.99479815e-02
  4.93914020e-02   1.03880545e-02  -2.39692667e-02   3.38233360e-02
  1.18487942e-02  -9.22433128e-03  -1.74728954e-02  -1.42393835e-02
  2.75995625e-02   6.96505909e-02   2.63890287e-02   2.30069534e-03
 -4.37956237e-03   7.33019162e-02   5.96415015e-02   6.77320376e-03
 -6.03426341e-03  -1.09072532e-02   3.29295133e-02  -3.73092079e-02
 -2.69077918e-02  -1.42559791e-01  -2.80880331e-02   1.78805165e-03
 -2.85045028e-03   2.10780059e-02  -2.12275771e-02   3.02096376e-02
  1.69047062e-02  -1.79925330e-02   6.29726008e-03   1.97070458e-02
  5.19257553e-03  -1.71189697e-02  -4.96526668e-02  -2.60450246e-02
  1.01453352e-02   5.22672481e-03   2.72231882e-02  -2.27722438e-03
  4.06790595e-02  -1.21596262e-02  -1.19305198e-02   1.82343302e-02
  9.83757520e-03  -2.61979484e-02   2.04487598e-02   5.51516204e-02
  7.21752269e-04   7.12426523e-03   2.27884198e-02  -5.51432951e-03
 -5.05484283e-03  -1.25750447e-02  -9.98317335e-03   9.10102525e-03
 -4.12577513e-02   6.75056663e-03  -1.28852503e-02  -2.05455613e-02
 -3.05885998e-03  -4.23882426e-02  -1.94251852e-02  -4.39963778e-02
 -3.93118786e-02  -4.25212537e-03  -9.29729400e-03   2.56150442e-02
 -3.66289624e-02  -1.59079974e-02   7.69945408e-02   2.28973357e-02
 -2.00362095e-02  -3.96060401e-03   2.75528018e-02  -1.91182026e-02
  5.73627828e-03   1.97838417e-03  -1.36419000e-02  -5.48799304e-04
  2.95456136e-02  -2.15121074e-02  -2.12279788e-02  -1.48681968e-02
 -2.14180763e-02  -1.53681694e-02   3.07962434e-02  -1.78962651e-02
 -1.97521183e-02  -8.21820309e-02  -2.02482742e-02  -8.85823966e-03
  1.02113474e-03   7.67524477e-05  -1.70879074e-02  -1.14176182e-02
 -2.43713099e-02  -2.76552412e-02   1.91091641e-02  -1.14726012e-02
 -1.86286609e-02  -1.31084709e-02   7.40567457e-03   1.75635633e-02
  1.11522464e-02   2.42276238e-02  -8.01769572e-03  -1.05413539e-01
  5.62218585e-02  -2.92319255e-02  -1.00402219e-02   1.68063753e-02
 -6.01120414e-02  -2.22246216e-03   2.14606826e-02   3.99100298e-02
  6.12458034e-03  -1.08740372e-02  -1.09971322e-02   3.42789960e-02
 -5.59461192e-02  -7.63054757e-02  -8.03146839e-02  -3.58863642e-02
  1.61196907e-02   3.21940269e-03   1.21636577e-03  -2.90197989e-02
 -9.35227221e-03  -1.59688625e-05  -3.29350938e-02  -4.41580502e-02
  3.21163741e-02  -6.60394390e-03  -1.73136473e-02  -3.59917312e-02
  3.52603276e-02   4.06738206e-02   7.22910793e-03  -5.58496922e-02
 -1.09184634e-01   1.52286149e-02  -9.31198759e-02  -7.09771286e-03
  2.60766459e-02   1.99467826e-02  -1.23325181e-02  -1.46052290e-02
 -2.16200660e-02   2.36714194e-02  -2.13157498e-02   4.43838061e-02
 -1.79283588e-02   1.12783423e-02  -3.25686235e-02   7.66889933e-04
 -9.23260146e-03   8.27999553e-03   1.28849945e-02  -1.15072543e-02
 -5.20747227e-02  -6.63801714e-03   9.26696052e-03   4.63252367e-02
  1.05965089e-02  -3.50972605e-02   1.59798251e-02  -2.76032133e-02
  6.46913401e-03  -1.45474501e-02   9.02755230e-03   2.34789967e-02
  1.64502659e-02  -8.94965280e-03  -2.62138765e-02   3.97881583e-02
  4.01252416e-02  -2.05344672e-02  -6.87990335e-03   1.61253144e-02
 -1.10220314e-03  -3.16495887e-04  -9.53361811e-03  -6.49180524e-03
  1.87385687e-02  -4.54779685e-03  -1.23768254e-02  -1.88580352e-02
  4.28713729e-03   3.45707900e-02  -3.35144317e-02  -1.17520774e-02
 -2.54358765e-02   1.47666417e-02   1.51702191e-03  -1.33425440e-03
  3.85942176e-03   5.85566965e-02   5.59697784e-02   2.83093817e-02
  4.46591596e-02  -7.55808499e-02  -7.04415066e-02   1.83652278e-02
 -3.85744338e-02  -1.05279986e-02  -2.81058743e-02   3.06858267e-02
  1.03214014e-02   2.49989745e-02   2.83181834e-02   9.25965200e-03
  2.74379410e-02  -6.12138693e-02  -8.19938790e-03  -1.26716634e-02
 -7.34556842e-03  -5.80696316e-02  -1.34963397e-02   4.41847145e-02
 -8.97369676e-03  -2.98443811e-02  -2.26838214e-03  -3.34088721e-02
  3.08623716e-02  -1.52511409e-02   3.50665596e-02   1.54337145e-02
  8.34288538e-03   9.54533492e-03   8.47157471e-03   2.48006868e-02
  5.10038981e-03  -1.03542929e-02  -4.37854909e-03   5.93693735e-03
  2.35804002e-02   9.73416728e-03   1.81055033e-02  -3.55955732e-02
 -1.72570256e-02   7.86218384e-03  -2.67356837e-02  -1.90421278e-02
 -2.50366010e-02  -4.50170335e-02  -1.98435444e-02  -7.20490055e-02
 -3.52624629e-02   9.31020471e-03  -1.95318978e-02  -2.08288676e-02
  7.52467063e-02  -1.91827012e-03  -9.39457021e-03  -7.58961250e-03
  1.08116296e-02  -5.98220171e-02  -3.76435773e-02   5.24512539e-03
  4.13630203e-02   1.57091839e-02   1.08518413e-02   1.92760170e-02
 -3.86927118e-03   2.34315748e-02   2.32312137e-02   1.58486834e-02
  3.26069386e-02   1.32669420e-02  -9.31780115e-03   3.90870899e-02
  6.08225404e-03  -1.86155505e-02   2.57141711e-03   1.53096590e-02
  1.67025866e-02  -1.88378432e-02  -9.56235969e-06  -2.09577691e-02
 -4.67431028e-02  -6.20644361e-02  -1.35635191e-02  -4.28685651e-02
 -6.59800161e-02  -3.33360025e-02  -2.20968900e-03  -6.47142033e-02
 -2.76189682e-02   4.91147020e-03  -3.05262193e-02  -7.04413608e-03
 -2.47297910e-03   4.43022724e-02   7.19417357e-02  -3.18219972e-03
 -9.82646723e-03  -1.82706365e-03   1.63706221e-02   1.90412779e-02
 -2.16736959e-02  -1.85392963e-02  -1.25785116e-02  -1.48458540e-02
 -8.00540470e-03  -1.53274638e-02  -1.23672325e-02  -2.27229510e-02
 -2.93591476e-02   1.15777766e-02  -9.80380940e-03   4.09331314e-03
  1.19922289e-02   3.02399018e-02   8.03025658e-03  -1.19018408e-04
 -6.77773968e-03  -2.93086031e-02   3.14479909e-02  -1.60359551e-03
  7.78314600e-03   2.06700717e-02  -8.75949539e-05  -1.93882021e-02
 -3.15032075e-02   7.75133590e-03  -1.55123588e-02  -5.44747779e-02
 -2.68593288e-02   2.09385420e-02  -7.97514014e-03   8.18536534e-02
 -2.66469105e-02  -5.09135597e-03  -2.55842803e-05  -2.97755016e-02
 -3.68015492e-02   2.46763293e-02   4.76807369e-03   1.20080528e-02
 -2.11372076e-02   4.04368095e-02   2.68156215e-02  -7.63188274e-03
 -1.21033579e-02   4.32613239e-02   4.98555591e-03   1.74822656e-02
  1.24958330e-02  -2.65123986e-02   1.45474469e-02  -5.81669849e-03
  3.17016600e-02   1.13393724e-02   2.97475539e-02  -2.21944622e-02
  2.00943734e-03  -3.68775954e-03  -2.22269870e-02   1.51721842e-02
  5.36333386e-03  -7.71686424e-03  -2.28463563e-02  -3.56265036e-04
 -3.95075487e-02   3.90486582e-03   3.06183572e-04  -3.45055119e-02
  2.26583449e-02   4.02002762e-02  -6.16801739e-03  -4.62610868e-02
  2.12373237e-02   6.00461431e-02   2.08901672e-02  -3.24164540e-02
  5.68871576e-02   3.27982341e-02   4.09861103e-03   2.54232284e-02
 -1.59434361e-03  -3.41047524e-02   5.47714727e-03  -7.10876631e-03
  3.75923401e-02   2.35386137e-02  -1.82586051e-02  -1.09479009e-02
  2.60533982e-03  -1.40905371e-03   2.75199971e-02  -3.43646595e-04
  5.04911799e-02   3.38722272e-02   5.48546341e-02   1.82817373e-02
 -1.03574388e-02   3.47202484e-02  -1.05740989e-02  -7.01238419e-03
  1.49009287e-02  -9.48353938e-03   5.72621304e-02   2.69253847e-02
 -2.21845869e-03   1.12307845e-02   4.11254390e-02  -2.71719293e-02
 -3.17634546e-02   2.25042431e-02   5.04721630e-02   2.46462900e-02
 -3.37808131e-02  -4.27184634e-02  -1.78258571e-02  -2.21585722e-03
  3.18972300e-02  -5.62737367e-02  -4.43641310e-03  -1.71371122e-02
 -1.19589983e-02   3.62066014e-02   2.30375845e-02   1.76171689e-02
  6.41621890e-04   2.70469680e-02  -1.27140166e-02   2.89744043e-02
 -3.26445301e-02  -1.41582264e-02  -3.67447104e-02  -2.76041142e-02
 -2.97790642e-02  -2.96674617e-02  -4.09775759e-02  -9.04346759e-03
 -1.78011679e-02   2.63841911e-02  -5.89516299e-02  -1.10771568e-02
  1.72603074e-02   1.47990524e-02   1.58001613e-02   3.17601230e-02
 -1.36228106e-02   1.98247751e-02  -2.17712212e-02   2.32370266e-02
 -1.03451901e-02   1.03070681e-02  -2.28218870e-02  -1.18930486e-02
 -2.82862676e-02  -3.34766468e-02  -8.93257958e-03  -5.70712203e-03
  4.16808764e-03   2.87900361e-02  -7.43285918e-03  -1.70139356e-02
 -8.99402530e-03   4.83385635e-02  -1.56222594e-02  -1.57487687e-02
 -5.48830102e-03]]
</pre></div>
</div>
<p>It&#8217;s a numpy array</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">print</span><span class="p">(</span><span class="n">coef_</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-python"><div class="highlight"><pre><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">577</span><span class="p">)</span>
</pre></div>
</div>
<p>We need to turn it back into a Nifti image, in essence, &#8220;inverting&#8221;
what the NiftiMasker has done.</p>
<p>For this, we can call inverse_transform on the NiftiMasker:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">coef_img</span> <span class="o">=</span> <span class="n">masker</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">coef_</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">coef_img</span><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-python"><div class="highlight"><pre>  &lt;class &#39;nibabel.nifti1.Nifti1Image&#39;&gt;
data shape (40, 64, 64, 1)
affine:
[[  -3.5      0.       0.      68.25 ]
 [   0.       3.75     0.    -118.125]
 [   0.       0.       3.75  -118.125]
 [   0.       0.       0.       1.   ]]
metadata:
&lt;class &#39;nibabel.nifti1.Nifti1Header&#39;&gt; object, endian=&#39;&lt;&#39;
sizeof_hdr      : 348
data_type       :
db_name         :
extents         : 0
session_error   : 0
regular         :
dim_info        : 0
dim             : [ 4 40 64 64  1  1  1  1]
intent_p1       : 0.0
intent_p2       : 0.0
intent_p3       : 0.0
intent_code     : none
datatype        : float64
bitpix          : 64
slice_start     : 0
pixdim          : [-1.    3.5   3.75  3.75  1.    1.    1.    1.  ]
vox_offset      : 0.0
scl_slope       : nan
scl_inter       : nan
slice_end       : 0
slice_code      : unknown
xyzt_units      : 0
cal_max         : 0.0
cal_min         : 0.0
slice_duration  : 0.0
toffset         : 0.0
glmax           : 0
glmin           : 0
descrip         :
aux_file        :
qform_code      : unknown
sform_code      : aligned
quatern_b       : 0.0
quatern_c       : 1.0
quatern_d       : 0.0
qoffset_x       : 68.25
qoffset_y       : -118.125
qoffset_z       : -118.125
srow_x          : [ -3.5    0.     0.    68.25]
srow_y          : [   0.       3.75     0.    -118.125]
srow_z          : [   0.       0.       3.75  -118.125]
intent_name     :
magic           : n+1
</pre></div>
</div>
<p>coef_img is now a NiftiImage.</p>
<p>We can save the coefficients as a nii.gz file:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">coef_img</span><span class="o">.</span><span class="n">to_filename</span><span class="p">(</span><span class="s">&#39;haxby_svc_weights.nii.gz&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="plotting-the-svm-weights">
<h3>Plotting the SVM weights<a class="headerlink" href="#plotting-the-svm-weights" title="Permalink to this headline">¶</a></h3>
<p>We can plot the weights, using the subject&#8217;s anatomical as a background</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">nilearn.plotting</span> <span class="kn">import</span> <a href="../modules/generated/nilearn.plotting.plot_stat_map.html#nilearn.plotting.plot_stat_map"><span class="n">plot_stat_map</span></a><span class="p">,</span> <a href="../modules/generated/nilearn.plotting.show.html#nilearn.plotting.show"><span class="n">show</span></a>

<a href="../modules/generated/nilearn.plotting.plot_stat_map.html#nilearn.plotting.plot_stat_map"><span class="n">plot_stat_map</span></a><span class="p">(</span><span class="n">coef_img</span><span class="p">,</span> <span class="n">bg_img</span><span class="o">=</span><span class="n">haxby_dataset</span><span class="o">.</span><span class="n">anat</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
              <span class="n">title</span><span class="o">=</span><span class="s">&quot;SVM weights&quot;</span><span class="p">,</span> <span class="n">display_mode</span><span class="o">=</span><span class="s">&quot;yx&quot;</span><span class="p">)</span>

<a href="../modules/generated/nilearn.plotting.show.html#nilearn.plotting.show"><span class="n">show</span></a><span class="p">()</span>
</pre></div>
</div>
<img alt="../_images/sphx_glr_plot_decoding_tutorial_002.png" class="align-center" src="../_images/sphx_glr_plot_decoding_tutorial_002.png" />
</div>
</div>
<div class="section" id="further-reading">
<h2><a class="toc-backref" href="#id5">Further reading</a><a class="headerlink" href="#further-reading" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>The <a class="reference internal" href="../decoding/decoding_tutorial.html#decoding-tutorial"><em>section of the documentation on decoding</em></a></li>
<li><a class="reference internal" href="02_decoding/plot_haxby_anova_svm.html#sphx-glr-auto-examples-02-decoding-plot-haxby-anova-svm-py"><em>Decoding with ANOVA + SVM: face vs house in the Haxby dataset</em></a></li>
<li><a class="reference internal" href="../decoding/space_net.html#space-net"><em>SpaceNet: decoding with spatial structure for better maps</em></a></li>
</ul>
<p><strong>Total running time of the script:</strong>
(0 minutes 12.071 seconds)</p>
<div class="sphx-glr-download container">
<strong>Download Python source code:</strong> <a class="reference download internal" href="../_downloads/plot_decoding_tutorial.py"><tt class="xref download docutils literal"><span class="pre">plot_decoding_tutorial.py</span></tt></a></div>
<div class="sphx-glr-download container">
<strong>Download IPython notebook:</strong> <a class="reference download internal" href="../_downloads/plot_decoding_tutorial.ipynb"><tt class="xref download docutils literal"><span class="pre">plot_decoding_tutorial.ipynb</span></tt></a></div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="01_plotting/plot_atlas.html" title="Basic Atlas plotting"
             >next</a></li>
        <li class="right" >
          <a href="plot_3d_and_4d_niimg.html" title="3D and 4D niimgs: handling and visualizing"
             >previous</a> |</li>
<li><a href="../index.html">Nilearn Home</a> |&nbsp;</li>
<li><a href="../user_guide.html">User Guide</a> |&nbsp;</li>
<li><a href="index.html">Examples</a> |&nbsp;</li>
<li><a href="../modules/reference.html">Reference</a> |&nbsp;</li>
<li id="navbar-about"><a href="../authors.html">About</a>|&nbsp;</li>
<li id="navbar-ecosystem"><a href="http://www.nipy.org/">Nipy ecosystem</a></li>

          <li><a href="index.html" >General examples</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
            &copy; The nilearn developers 2010-2015.
          Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.2.3.
        <span style="padding-left: 5ex;">
          <a href="../_sources/auto_examples/plot_decoding_tutorial.txt"
        	 rel="nofollow">Show this page source</a>
        </span>
    </div>
  </body>
</html>