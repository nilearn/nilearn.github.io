
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Nilearn: Machine learning for NeuroImaging in Python &#8212; Machine learning for NeuroImaging</title>
    <link rel="stylesheet" href="../../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/gallery.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/copybutton.js"></script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="8.6.6. Massively univariate analysis of face vs house recognition" href="plot_haxby_mass_univariate.html" />
    <link rel="prev" title="8.6.4. Massively univariate analysis of a motor task from the Localizer dataset" href="plot_localizer_mass_univariate_methods.html" />
<meta content="True" name="HandheldFriendly">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
<meta name="keywords" content="nilearn, neuroimaging, python, neuroscience, machinelearning">


<script type="text/javascript">
function updateTopMenuPosition(height, width) {
    if($(window).scrollTop() > height && $(window).outerWidth() > 1024) {
        //begin to scroll
        $('.related-wrapper').css("z-index", 1000)
        $('.related-wrapper').css("position", "sticky")
        $('.related-wrapper').css("top", 0)
        $('.related-wrapper').css("width", width)
    } else {
        //lock it back into place
        $('.related-wrapper').css("position", "relative")
        $('.related-wrapper').css("top", 0)
    }
}

$(function() {
    var banner_height = $('#logo-banner').outerHeight()
    var banner_width = $('#logo-banner').outerWidth()
    var width = $('.related-wrapper').css("height", $('.related').outerHeight())

    updateTopMenuPosition(banner_height, width)

    $(window).scroll(function(event) {
        updateTopMenuPosition(banner_height, width)
    });

    $(window).resize(function(event) {
        var banner_width = $('#logo-banner').outerWidth()
        var menu_height = $('.related').outerHeight()
        $('.related').css("width", banner_width)
        $('.related-wrapper').css("height", menu_height)
        updateTopMenuPosition(banner_height, width)
    })
});
</script>
<script type="text/javascript">
function updateSideBarPosition(top, offset, sections) {
    var pos = $(window).scrollTop()
    // Lock the table of content to a fixed position once we scroll enough
    var topShift = 2 * offset
    if(pos > top + topShift + 1) {
        // begin to scroll with sticky menu bar
        var topShift = -topShift + 1
        if ($(window).outerWidth() < 1024) {
            // compensate top menu that disappears
            topShift -= offset + 1
        }
        $('.sphinxsidebarwrapper').css("position", "fixed")
        $('.sphinxsidebarwrapper').css("top", topShift)
    }
    else {
        //lock it back into place
        $('.sphinxsidebarwrapper').css("position", "relative")
        $('.sphinxsidebarwrapper').css("top",0)
    }

    // Highlight the current section
    i = 0
    current_section = 0
    $('a.internal').removeClass('active')
    for(i in sections) {
        if(sections[i] > pos) {
            break
        };
        if($('a.internal[href$="' + i + '"]').is(':visible')){
            current_section = i
        };
    }
    $('a.internal[href$="' + current_section + '"]').addClass('active')
    $('a.internal[href$="' + current_section + '"]').parent().addClass('active')
}

$(function () {
    // Lock the table of content to a fixed position once we scroll enough
    var tocOffset = $('.related-wrapper').outerHeight()
    var marginTop = parseFloat($('.sphinxsidebarwrapper').css('margin-top').replace(/auto/, 0))
    var top = $('.sphinxsidebarwrapper').offset().top - marginTop
    sections = {}
    url = document.URL.replace(/#.*$/, "")

    // Grab positions of our sections
    $('.headerlink').each(function(){
        sections[this.href.replace(url, '')] = $(this).offset().top - 50
    });

    updateSideBarPosition(top, tocOffset, sections)

    $(window).scroll(function(event) {
        updateSideBarPosition(top, tocOffset, sections)
    });

    $(window).resize(function(event) {
        tocOffset = $('.related-wrapper').outerHeight()
        updateSideBarPosition(top, tocOffset, sections)
    });
});
</script>


<script type="text/javascript">

        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-41920728-1']);
        _gaq.push(['_trackPageview']);

        (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
    </script>

  </head><body>
<div id="logo-banner">
  <div class="logo">
    <a href="../../index.html">
      <img src="../../_static/nilearn-logo.png" alt="Nilearn logo"  border="0" />
    </a>
  </div>
  <!-- A tag cloud to make it easy for people to find what they are
                         looking for -->
 <div class="tags">
  <ul>
    <li>
      <big><a href="../decoding/plot_haxby_anova_svm.html">SVM</a></big>
    </li>
    <li>
      <small><a href="../../connectivity/parcellating.html">Ward
          clustering</a></small>
    </li>
    <li>
      <a href="../../decoding/searchlight.html">Searchlight</a>
    </li>
    <li>
      <big><a href="../../connectivity/resting_state_networks.html">ICA</a></big>
    </li>
    <li>
      <a href="../../manipulating_images/data_preparation.html">Nifti IO</a>
    </li>
    <li>
      <a href="../../modules/reference.html#module-nilearn.datasets">Datasets</a>
    </li>
  </ul>
 </div>

  <div class="banner">
    <h1>Nilearn:</h1>
    <h2>Machine learning for Neuro-Imaging in Python</h2>
  </div>
  <div class="search_form">
    <div class="gcse-search" id="cse" style="width: 100%;"></div>
    <script>
      (function() {
        var cx = '017289614950330089114:elrt9qoutrq';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
  </div>
</div>



<div class=related-wrapper>
    
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a></li>
        <li class="right" >
          <a href="plot_haxby_mass_univariate.html" title="8.6.6. Massively univariate analysis of face vs house recognition"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="plot_localizer_mass_univariate_methods.html" title="8.6.4. Massively univariate analysis of a motor task from the Localizer dataset"
             accesskey="P">previous</a> |</li>
<li><a href="../../index.html">Nilearn Home</a> |&nbsp;</li>
<li><a href="../../user_guide.html">User Guide</a> |&nbsp;</li>
<li><a href="../index.html">Examples</a> |&nbsp;</li>
<li><a href="../../modules/reference.html">Reference</a> |&nbsp;</li>
<li id="navbar-about"><a href="../../authors.html">About</a>|&nbsp;</li>
<li id="navbar-ecosystem"><a href="http://www.nipy.org/">Nipy ecosystem</a></li>

          <li class="nav-item nav-item-1"><a href="../../user_guide.html" >User guide: table of contents</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../index.html" accesskey="U">8. Nilearn usage examples</a> &#187;</li> 
      </ul>
    </div>
</div>

      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">


<h4> Giving credit </h4>
  <ul class="simple">
    <li><p>Please consider <a href="../../authors.html#citing">citing the
                    papers</a>.</p></li>
  </ul>

  <h3><a href="../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">8.6.5. NeuroVault cross-study ICA maps.</a><ul>
<li><a class="reference internal" href="#get-image-and-term-data">8.6.5.1. Get image and term data</a></li>
<li><a class="reference internal" href="#reshape-and-mask-images">8.6.5.2. Reshape and mask images</a></li>
<li><a class="reference internal" href="#run-ica-and-map-components-to-terms">8.6.5.3. Run ICA and map components to terms</a></li>
<li><a class="reference internal" href="#generate-figures">8.6.5.4. Generate figures</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="plot_localizer_mass_univariate_methods.html"
                        title="previous chapter">8.6.4. Massively univariate analysis of a motor task from the Localizer dataset</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="plot_haxby_mass_univariate.html"
                        title="next chapter">8.6.6. Massively univariate analysis of face vs house recognition</a></p>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="neurovault-cross-study-ica-maps">
<span id="sphx-glr-auto-examples-05-advanced-plot-ica-neurovault-py"></span><h1>8.6.5. NeuroVault cross-study ICA maps.<a class="headerlink" href="#neurovault-cross-study-ica-maps" title="Permalink to this headline">¶</a></h1>
<p>This example shows how to download statistical maps from
NeuroVault, label them with NeuroSynth terms,
and compute ICA components across all the maps.</p>
<p>See <a class="reference internal" href="../../modules/generated/nilearn.datasets.fetch_neurovault.html#nilearn.datasets.fetch_neurovault" title="nilearn.datasets.fetch_neurovault"><code class="xref py py-func docutils literal notranslate"><span class="pre">nilearn.datasets.fetch_neurovault</span></code></a>
documentation for more details.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Author: Ben Cipollini</span>
<span class="c1"># License: BSD</span>
<span class="c1"># Ported from code authored by Chris Filo Gorgolewski, Gael Varoquaux</span>
<span class="c1"># https://github.com/NeuroVault/neurovault_analysis</span>
<span class="kn">import</span> <span class="nn">warnings</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>
<span class="kn">from</span> <span class="nn">sklearn.decomposition</span> <span class="kn">import</span> <a href="http://scikit-learn.org/0.18/modules/generated/sklearn.decomposition.FastICA.html#sklearn.decomposition.FastICA" title="View documentation for sklearn.decomposition.FastICA"><span class="n">FastICA</span></a>

<span class="kn">from</span> <span class="nn">nilearn.datasets</span> <span class="kn">import</span> <a href="../../modules/generated/nilearn.datasets.fetch_neurovault.html#nilearn.datasets.fetch_neurovault" title="View documentation for nilearn.datasets.fetch_neurovault"><span class="n">fetch_neurovault</span></a>
<span class="kn">from</span> <span class="nn">nilearn.image</span> <span class="kn">import</span> <a href="../../modules/generated/nilearn.image.smooth_img.html#nilearn.image.smooth_img" title="View documentation for nilearn.image.smooth_img"><span class="n">smooth_img</span></a>

<span class="kn">from</span> <span class="nn">nilearn.datasets</span> <span class="kn">import</span> <a href="../../modules/generated/nilearn.datasets.load_mni152_brain_mask.html#nilearn.datasets.load_mni152_brain_mask" title="View documentation for nilearn.datasets.load_mni152_brain_mask"><span class="n">load_mni152_brain_mask</span></a>
<span class="kn">from</span> <span class="nn">nilearn.input_data</span> <span class="kn">import</span> <a href="../../modules/generated/nilearn.input_data.NiftiMasker.html#nilearn.input_data.NiftiMasker" title="View documentation for nilearn.input_data.NiftiMasker"><span class="n">NiftiMasker</span></a>

<span class="kn">from</span> <span class="nn">nilearn</span> <span class="kn">import</span> <span class="n">plotting</span>
</pre></div>
</div>
<div class="section" id="get-image-and-term-data">
<h2>8.6.5.1. Get image and term data<a class="headerlink" href="#get-image-and-term-data" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Download images</span>
<span class="c1"># Here by default we only download 80 images to save time,</span>
<span class="c1"># but for better results I recommend using at least 200.</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;Fetching Neurovault images; &quot;</span>
      <span class="s2">&quot;if you haven&#39;t downloaded any Neurovault data before &quot;</span>
      <span class="s2">&quot;this will take several minutes.&quot;</span><span class="p">)</span>
<span class="n">nv_data</span> <span class="o">=</span> <a href="../../modules/generated/nilearn.datasets.fetch_neurovault.html#nilearn.datasets.fetch_neurovault" title="View documentation for nilearn.datasets.fetch_neurovault"><span class="n">fetch_neurovault</span></a><span class="p">(</span><span class="n">max_images</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">fetch_neurosynth_words</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="n">images</span> <span class="o">=</span> <span class="n">nv_data</span><span class="p">[</span><span class="s1">&#39;images&#39;</span><span class="p">]</span>
<span class="n">term_weights</span> <span class="o">=</span> <span class="n">nv_data</span><span class="p">[</span><span class="s1">&#39;word_frequencies&#39;</span><span class="p">]</span>
<span class="n">vocabulary</span> <span class="o">=</span> <span class="n">nv_data</span><span class="p">[</span><span class="s1">&#39;vocabulary&#39;</span><span class="p">]</span>

<span class="c1"># Clean and report term scores</span>
<span class="n">term_weights</span><span class="p">[</span><span class="n">term_weights</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">total_scores</span> <span class="o">=</span> <a href="http://docs.scipy.org/doc/numpy-1.11.0/reference/generated/numpy.mean.html#numpy.mean" title="View documentation for numpy.mean"><span class="n">np</span><span class="o">.</span><span class="n">mean</span></a><span class="p">(</span><span class="n">term_weights</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Top 10 neurosynth terms from downloaded images:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">term_idx</span> <span class="ow">in</span> <a href="http://docs.scipy.org/doc/numpy-1.11.0/reference/generated/numpy.argsort.html#numpy.argsort" title="View documentation for numpy.argsort"><span class="n">np</span><span class="o">.</span><span class="n">argsort</span></a><span class="p">(</span><span class="n">total_scores</span><span class="p">)[</span><span class="o">-</span><span class="mi">10</span><span class="p">:][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
    <span class="k">print</span><span class="p">(</span><span class="n">vocabulary</span><span class="p">[</span><span class="n">term_idx</span><span class="p">])</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-default notranslate"><div class="highlight"><pre><span></span>Fetching Neurovault images; if you haven&#39;t downloaded any Neurovault data before this will take several minutes.
Reading local neurovault data.
Already fetched 1 image
Already fetched 2 images
Already fetched 3 images
Already fetched 4 images
Already fetched 5 images
Already fetched 6 images
Already fetched 7 images
Already fetched 8 images
Already fetched 9 images
Already fetched 10 images
Already fetched 11 images
Already fetched 12 images
Already fetched 13 images
Already fetched 14 images
Already fetched 15 images
Already fetched 16 images
Already fetched 17 images
Already fetched 18 images
Already fetched 19 images
Already fetched 20 images
Already fetched 21 images
Already fetched 22 images
Already fetched 23 images
Downloading file: http://neurosynth.org/api/decode/?neurovault=40012
Problem downloading file from http://neurosynth.org/api/decode/?neurovault=40012
Could not fetch words for image 40012
Already fetched 24 images
Downloading file: http://neurosynth.org/api/decode/?neurovault=40013
Problem downloading file from http://neurosynth.org/api/decode/?neurovault=40013
Could not fetch words for image 40013
Already fetched 25 images
Already fetched 26 images
Already fetched 27 images
Already fetched 28 images
Already fetched 29 images
Already fetched 30 images
Already fetched 31 images
Already fetched 32 images
Already fetched 33 images
Already fetched 34 images
Already fetched 35 images
Already fetched 36 images
Already fetched 37 images
Already fetched 38 images
Already fetched 39 images
Already fetched 40 images
Already fetched 41 images
Already fetched 42 images
Already fetched 43 images
Already fetched 44 images
Already fetched 45 images
Already fetched 46 images
Already fetched 47 images
Already fetched 48 images
Already fetched 49 images
Already fetched 50 images
Already fetched 51 images
Already fetched 52 images
Already fetched 53 images
Already fetched 54 images
Already fetched 55 images
Already fetched 56 images
Already fetched 57 images
Already fetched 58 images
Already fetched 59 images
Already fetched 60 images
Already fetched 61 images
Already fetched 62 images
Already fetched 63 images
Already fetched 64 images
Already fetched 65 images
Already fetched 66 images
Already fetched 67 images
Already fetched 68 images
Already fetched 69 images
Already fetched 70 images
Already fetched 71 images
Already fetched 72 images
Already fetched 73 images
Already fetched 74 images
Already fetched 75 images
Already fetched 76 images
Already fetched 77 images
Already fetched 78 images
Already fetched 79 images
Already fetched 80 images
80 images found on local disk.
Computing word features.
Could not load words from file /home/kshitij/nilearn_data/neurovault/collection_2138/neurosynth_words_for_image_40012.json; error: Traceback (most recent call last):
  File &quot;/home/kshitij/workspace/nilearn-org/nilearn-repo/master/nilearn/nilearn/datasets/neurovault.py&quot;, line 1251, in neurosynth_words_vectorized
    with open(file_name, &#39;rb&#39;) as word_file:
FileNotFoundError: [Errno 2] No such file or directory: &#39;/home/kshitij/nilearn_data/neurovault/collection_2138/neurosynth_words_for_image_40012.json&#39;

Could not load words from file /home/kshitij/nilearn_data/neurovault/collection_2138/neurosynth_words_for_image_40013.json; error: Traceback (most recent call last):
  File &quot;/home/kshitij/workspace/nilearn-org/nilearn-repo/master/nilearn/nilearn/datasets/neurovault.py&quot;, line 1251, in neurosynth_words_vectorized
    with open(file_name, &#39;rb&#39;) as word_file:
FileNotFoundError: [Errno 2] No such file or directory: &#39;/home/kshitij/nilearn_data/neurovault/collection_2138/neurosynth_words_for_image_40013.json&#39;

Computing word features done; vocabulary size: 2957

Top 10 neurosynth terms from downloaded images:

thalamus
cingulate
striatum
basal ganglia
ganglia
basal
precuneus
anterior insula
reward
nucleus
</pre></div>
</div>
</div>
<div class="section" id="reshape-and-mask-images">
<h2>8.6.5.2. Reshape and mask images<a class="headerlink" href="#reshape-and-mask-images" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Reshaping and masking images.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="ne">UserWarning</span><span class="p">)</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="ne">DeprecationWarning</span><span class="p">)</span>

    <span class="n">mask_img</span> <span class="o">=</span> <a href="../../modules/generated/nilearn.datasets.load_mni152_brain_mask.html#nilearn.datasets.load_mni152_brain_mask" title="View documentation for nilearn.datasets.load_mni152_brain_mask"><span class="n">load_mni152_brain_mask</span></a><span class="p">()</span>
    <span class="n">masker</span> <span class="o">=</span> <a href="../../modules/generated/nilearn.input_data.NiftiMasker.html#nilearn.input_data.NiftiMasker" title="View documentation for nilearn.input_data.NiftiMasker"><span class="n">NiftiMasker</span></a><span class="p">(</span>
        <span class="n">mask_img</span><span class="o">=</span><span class="n">mask_img</span><span class="p">,</span> <span class="n">memory</span><span class="o">=</span><span class="s1">&#39;nilearn_cache&#39;</span><span class="p">,</span> <span class="n">memory_level</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">masker</span> <span class="o">=</span> <span class="n">masker</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

    <span class="c1"># Images may fail to be transformed, and are of different shapes,</span>
    <span class="c1"># so we need to transform one-by-one and keep track of failures.</span>
    <span class="n">X</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">is_usable</span> <span class="o">=</span> <a href="http://docs.scipy.org/doc/numpy-1.11.0/reference/generated/numpy.ones.html#numpy.ones" title="View documentation for numpy.ones"><span class="n">np</span><span class="o">.</span><span class="n">ones</span></a><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">images</span><span class="p">),),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">image_path</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">images</span><span class="p">):</span>
        <span class="c1"># load image and remove nan and inf values.</span>
        <span class="c1"># applying smooth_img to an image with fwhm=None simply cleans up</span>
        <span class="c1"># non-finite values but otherwise doesn&#39;t modify the image.</span>
        <span class="n">image</span> <span class="o">=</span> <a href="../../modules/generated/nilearn.image.smooth_img.html#nilearn.image.smooth_img" title="View documentation for nilearn.image.smooth_img"><span class="n">smooth_img</span></a><span class="p">(</span><span class="n">image_path</span><span class="p">,</span> <span class="n">fwhm</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">X</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">masker</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">image</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">meta</span> <span class="o">=</span> <span class="n">nv_data</span><span class="p">[</span><span class="s1">&#39;images_meta&#39;</span><span class="p">][</span><span class="n">index</span><span class="p">]</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Failed to mask/reshape image: id: {0}; &quot;</span>
                  <span class="s2">&quot;name: &#39;{1}&#39;; collection: {2}; error: {3}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                      <span class="n">meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">),</span> <span class="n">meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">),</span>
                      <span class="n">meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;collection_id&#39;</span><span class="p">),</span> <span class="n">e</span><span class="p">))</span>
            <span class="n">is_usable</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>

<span class="c1"># Now reshape list into 2D matrix, and remove failed images from terms</span>
<span class="n">X</span> <span class="o">=</span> <a href="http://docs.scipy.org/doc/numpy-1.11.0/reference/generated/numpy.vstack.html#numpy.vstack" title="View documentation for numpy.vstack"><span class="n">np</span><span class="o">.</span><span class="n">vstack</span></a><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="n">term_weights</span> <span class="o">=</span> <span class="n">term_weights</span><span class="p">[</span><span class="n">is_usable</span><span class="p">,</span> <span class="p">:]</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Reshaping</span> <span class="ow">and</span> <span class="n">masking</span> <span class="n">images</span><span class="o">.</span>
</pre></div>
</div>
</div>
<div class="section" id="run-ica-and-map-components-to-terms">
<h2>8.6.5.3. Run ICA and map components to terms<a class="headerlink" href="#run-ica-and-map-components-to-terms" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="s2">&quot;Running ICA; may take time...&quot;</span><span class="p">)</span>
<span class="c1"># We use a very small number of components as we have downloaded only 80</span>
<span class="c1"># images. For better results, increase the number of images downloaded</span>
<span class="c1"># and the number of components</span>
<span class="n">n_components</span> <span class="o">=</span> <span class="mi">16</span>
<span class="n">fast_ica</span> <span class="o">=</span> <a href="http://scikit-learn.org/0.18/modules/generated/sklearn.decomposition.FastICA.html#sklearn.decomposition.FastICA" title="View documentation for sklearn.decomposition.FastICA"><span class="n">FastICA</span></a><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="n">n_components</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">ica_maps</span> <span class="o">=</span> <span class="n">fast_ica</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

<span class="n">term_weights_for_components</span> <span class="o">=</span> <a href="http://docs.scipy.org/doc/numpy-1.11.0/reference/generated/numpy.dot.html#numpy.dot" title="View documentation for numpy.dot"><span class="n">np</span><span class="o">.</span><span class="n">dot</span></a><span class="p">(</span><span class="n">fast_ica</span><span class="o">.</span><span class="n">components_</span><span class="p">,</span> <span class="n">term_weights</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;Done, plotting results.&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Running</span> <span class="n">ICA</span><span class="p">;</span> <span class="n">may</span> <span class="n">take</span> <span class="n">time</span><span class="o">...</span>
<span class="n">Done</span><span class="p">,</span> <span class="n">plotting</span> <span class="n">results</span><span class="o">.</span>
</pre></div>
</div>
</div>
<div class="section" id="generate-figures">
<h2>8.6.5.4. Generate figures<a class="headerlink" href="#generate-figures" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="ne">DeprecationWarning</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="p">(</span><span class="n">ic_map</span><span class="p">,</span> <span class="n">ic_terms</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
            <span class="nb">zip</span><span class="p">(</span><span class="n">ica_maps</span><span class="p">,</span> <span class="n">term_weights_for_components</span><span class="p">)):</span>
        <span class="k">if</span> <span class="o">-</span><span class="n">ic_map</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">ic_map</span><span class="o">.</span><span class="n">max</span><span class="p">():</span>
            <span class="c1"># Flip the map&#39;s sign for prettiness</span>
            <span class="n">ic_map</span> <span class="o">=</span> <span class="o">-</span> <span class="n">ic_map</span>
            <span class="n">ic_terms</span> <span class="o">=</span> <span class="o">-</span> <span class="n">ic_terms</span>

        <span class="n">ic_threshold</span> <span class="o">=</span> <a href="http://docs.scipy.org/doc/scipy-0.17.0/reference/generated/scipy.stats.scoreatpercentile.html#scipy.stats.scoreatpercentile" title="View documentation for scipy.stats.scoreatpercentile"><span class="n">stats</span><span class="o">.</span><span class="n">scoreatpercentile</span></a><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">ic_map</span><span class="p">),</span> <span class="mi">90</span><span class="p">)</span>
        <span class="n">ic_img</span> <span class="o">=</span> <span class="n">masker</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">ic_map</span><span class="p">)</span>
        <span class="n">important_terms</span> <span class="o">=</span> <span class="n">vocabulary</span><span class="p">[</span><a href="http://docs.scipy.org/doc/numpy-1.11.0/reference/generated/numpy.argsort.html#numpy.argsort" title="View documentation for numpy.argsort"><span class="n">np</span><span class="o">.</span><span class="n">argsort</span></a><span class="p">(</span><span class="n">ic_terms</span><span class="p">)[</span><span class="o">-</span><span class="mi">3</span><span class="p">:]]</span>
        <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;IC</span><span class="si">%i</span><span class="s1">  </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">important_terms</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>

        <a href="../../modules/generated/nilearn.plotting.plot_stat_map.html#nilearn.plotting.plot_stat_map" title="View documentation for nilearn.plotting.plot_stat_map"><span class="n">plotting</span><span class="o">.</span><span class="n">plot_stat_map</span></a><span class="p">(</span>
            <span class="n">ic_img</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="n">ic_threshold</span><span class="p">,</span> <span class="n">colorbar</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
            <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span>
</pre></div>
</div>
<ul class="sphx-glr-horizontal">
<li><a class="first reference internal image-reference" href="../../_images/sphx_glr_plot_ica_neurovault_001.png"><img alt="../../_images/sphx_glr_plot_ica_neurovault_001.png" src="../../_images/sphx_glr_plot_ica_neurovault_001.png" style="width: 310.2px; height: 122.19999999999999px;" /></a>
</li>
<li><a class="first reference internal image-reference" href="../../_images/sphx_glr_plot_ica_neurovault_002.png"><img alt="../../_images/sphx_glr_plot_ica_neurovault_002.png" src="../../_images/sphx_glr_plot_ica_neurovault_002.png" style="width: 310.2px; height: 122.19999999999999px;" /></a>
</li>
<li><a class="first reference internal image-reference" href="../../_images/sphx_glr_plot_ica_neurovault_003.png"><img alt="../../_images/sphx_glr_plot_ica_neurovault_003.png" src="../../_images/sphx_glr_plot_ica_neurovault_003.png" style="width: 310.2px; height: 122.19999999999999px;" /></a>
</li>
<li><a class="first reference internal image-reference" href="../../_images/sphx_glr_plot_ica_neurovault_004.png"><img alt="../../_images/sphx_glr_plot_ica_neurovault_004.png" src="../../_images/sphx_glr_plot_ica_neurovault_004.png" style="width: 310.2px; height: 122.19999999999999px;" /></a>
</li>
<li><a class="first reference internal image-reference" href="../../_images/sphx_glr_plot_ica_neurovault_005.png"><img alt="../../_images/sphx_glr_plot_ica_neurovault_005.png" src="../../_images/sphx_glr_plot_ica_neurovault_005.png" style="width: 310.2px; height: 122.19999999999999px;" /></a>
</li>
<li><a class="first reference internal image-reference" href="../../_images/sphx_glr_plot_ica_neurovault_006.png"><img alt="../../_images/sphx_glr_plot_ica_neurovault_006.png" src="../../_images/sphx_glr_plot_ica_neurovault_006.png" style="width: 310.2px; height: 122.19999999999999px;" /></a>
</li>
<li><a class="first reference internal image-reference" href="../../_images/sphx_glr_plot_ica_neurovault_007.png"><img alt="../../_images/sphx_glr_plot_ica_neurovault_007.png" src="../../_images/sphx_glr_plot_ica_neurovault_007.png" style="width: 310.2px; height: 122.19999999999999px;" /></a>
</li>
<li><a class="first reference internal image-reference" href="../../_images/sphx_glr_plot_ica_neurovault_008.png"><img alt="../../_images/sphx_glr_plot_ica_neurovault_008.png" src="../../_images/sphx_glr_plot_ica_neurovault_008.png" style="width: 310.2px; height: 122.19999999999999px;" /></a>
</li>
<li><a class="first reference internal image-reference" href="../../_images/sphx_glr_plot_ica_neurovault_009.png"><img alt="../../_images/sphx_glr_plot_ica_neurovault_009.png" src="../../_images/sphx_glr_plot_ica_neurovault_009.png" style="width: 310.2px; height: 122.19999999999999px;" /></a>
</li>
<li><a class="first reference internal image-reference" href="../../_images/sphx_glr_plot_ica_neurovault_010.png"><img alt="../../_images/sphx_glr_plot_ica_neurovault_010.png" src="../../_images/sphx_glr_plot_ica_neurovault_010.png" style="width: 310.2px; height: 122.19999999999999px;" /></a>
</li>
<li><a class="first reference internal image-reference" href="../../_images/sphx_glr_plot_ica_neurovault_011.png"><img alt="../../_images/sphx_glr_plot_ica_neurovault_011.png" src="../../_images/sphx_glr_plot_ica_neurovault_011.png" style="width: 310.2px; height: 122.19999999999999px;" /></a>
</li>
<li><a class="first reference internal image-reference" href="../../_images/sphx_glr_plot_ica_neurovault_012.png"><img alt="../../_images/sphx_glr_plot_ica_neurovault_012.png" src="../../_images/sphx_glr_plot_ica_neurovault_012.png" style="width: 310.2px; height: 122.19999999999999px;" /></a>
</li>
<li><a class="first reference internal image-reference" href="../../_images/sphx_glr_plot_ica_neurovault_013.png"><img alt="../../_images/sphx_glr_plot_ica_neurovault_013.png" src="../../_images/sphx_glr_plot_ica_neurovault_013.png" style="width: 310.2px; height: 122.19999999999999px;" /></a>
</li>
<li><a class="first reference internal image-reference" href="../../_images/sphx_glr_plot_ica_neurovault_014.png"><img alt="../../_images/sphx_glr_plot_ica_neurovault_014.png" src="../../_images/sphx_glr_plot_ica_neurovault_014.png" style="width: 310.2px; height: 122.19999999999999px;" /></a>
</li>
<li><a class="first reference internal image-reference" href="../../_images/sphx_glr_plot_ica_neurovault_015.png"><img alt="../../_images/sphx_glr_plot_ica_neurovault_015.png" src="../../_images/sphx_glr_plot_ica_neurovault_015.png" style="width: 310.2px; height: 122.19999999999999px;" /></a>
</li>
<li><a class="first reference internal image-reference" href="../../_images/sphx_glr_plot_ica_neurovault_016.png"><img alt="../../_images/sphx_glr_plot_ica_neurovault_016.png" src="../../_images/sphx_glr_plot_ica_neurovault_016.png" style="width: 310.2px; height: 122.19999999999999px;" /></a>
</li>
</ul>
<p>As we can see, some of the components capture cognitive or neurological
maps, while other capture noise in the database. More data, better
filtering, and better cognitive labels would give better maps</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Done.</span>
<a href="../../modules/generated/nilearn.plotting.show.html#nilearn.plotting.show" title="View documentation for nilearn.plotting.show"><span class="n">plotting</span><span class="o">.</span><span class="n">show</span></a><span class="p">()</span>
</pre></div>
</div>
<p><strong>Total running time of the script:</strong> ( 0 minutes  34.419 seconds)</p>
<div class="sphx-glr-footer docutils container">
<div class="sphx-glr-download docutils container">
<a class="reference download internal" href="../../_downloads/plot_ica_neurovault.py" download=""><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">plot_ica_neurovault.py</span></code></a></div>
<div class="sphx-glr-download docutils container">
<a class="reference download internal" href="../../_downloads/plot_ica_neurovault.ipynb" download=""><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">plot_ica_neurovault.ipynb</span></code></a></div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.readthedocs.io">Generated by Sphinx-Gallery</a></p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>

    <div class="footer">
            &copy; The nilearn developers 2010-2015.
          Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.7.9.
        <span style="padding-left: 5ex;">
          <a href="../../_sources/auto_examples/05_advanced/plot_ica_neurovault.rst.txt"
        	 rel="nofollow">Show this page source</a>
        </span>
    </div>
  </body>
</html>