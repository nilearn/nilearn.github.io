
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Nilearn: Machine learning for NeuroImaging in Python &#8212; Machine learning for NeuroImaging</title>
    <link rel="stylesheet" href="../../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/gallery.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.5.0b',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/copybutton.js"></script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="8.3.11. Example of pattern recognition on simulated data" href="plot_simulated_data.html" />
    <link rel="prev" title="8.3.9. ROI-based decoding analysis in Haxby et al. dataset" href="plot_haxby_full_analysis.html" />
<meta content="True" name="HandheldFriendly">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
<meta name="keywords" content="nilearn, neuroimaging, python, neuroscience, machinelearning">


<script type="text/javascript">
function updateTopMenuPosition(height, width) {
    if($(window).scrollTop() > height && $(window).outerWidth() > 1024) {
        //begin to scroll
        $('.related-wrapper').css("z-index", 1000)
        $('.related-wrapper').css("position", "sticky")
        $('.related-wrapper').css("top", 0)
        $('.related-wrapper').css("width", width)
    } else {
        //lock it back into place
        $('.related-wrapper').css("position", "relative")
        $('.related-wrapper').css("top", 0)
    }
}

$(function() {
    var banner_height = $('#logo-banner').outerHeight()
    var banner_width = $('#logo-banner').outerWidth()
    var width = $('.related-wrapper').css("height", $('.related').outerHeight())

    updateTopMenuPosition(banner_height, width)

    $(window).scroll(function(event) {
        updateTopMenuPosition(banner_height, width)
    });

    $(window).resize(function(event) {
        var banner_width = $('#logo-banner').outerWidth()
        var menu_height = $('.related').outerHeight()
        $('.related').css("width", banner_width)
        $('.related-wrapper').css("height", menu_height)
        updateTopMenuPosition(banner_height, width)
    })
});
</script>
<script type="text/javascript">
function updateSideBarPosition(top, offset, sections) {
    var pos = $(window).scrollTop()
    // Lock the table of content to a fixed position once we scroll enough
    var topShift = 2 * offset
    if(pos > top + topShift + 1) {
        // begin to scroll with sticky menu bar
        var topShift = -topShift + 1
        if ($(window).outerWidth() < 1024) {
            // compensate top menu that disappears
            topShift -= offset + 1
        }
        $('.sphinxsidebarwrapper').css("position", "fixed")
        $('.sphinxsidebarwrapper').css("top", topShift)
    }
    else {
        //lock it back into place
        $('.sphinxsidebarwrapper').css("position", "relative")
        $('.sphinxsidebarwrapper').css("top",0)
    }

    // Highlight the current section
    i = 0
    current_section = 0
    $('a.internal').removeClass('active')
    for(i in sections) {
        if(sections[i] > pos) {
            break
        };
        if($('a.internal[href$="' + i + '"]').is(':visible')){
            current_section = i
        };
    }
    $('a.internal[href$="' + current_section + '"]').addClass('active')
    $('a.internal[href$="' + current_section + '"]').parent().addClass('active')
}

$(function () {
    // Lock the table of content to a fixed position once we scroll enough
    var tocOffset = $('.related-wrapper').outerHeight()
    var marginTop = parseFloat($('.sphinxsidebarwrapper').css('margin-top').replace(/auto/, 0))
    var top = $('.sphinxsidebarwrapper').offset().top - marginTop
    sections = {}
    url = document.URL.replace(/#.*$/, "")

    // Grab positions of our sections
    $('.headerlink').each(function(){
        sections[this.href.replace(url, '')] = $(this).offset().top - 50
    });

    updateSideBarPosition(top, tocOffset, sections)

    $(window).scroll(function(event) {
        updateSideBarPosition(top, tocOffset, sections)
    });

    $(window).resize(function(event) {
        tocOffset = $('.related-wrapper').outerHeight()
        updateSideBarPosition(top, tocOffset, sections)
    });
});
</script>


<script type="text/javascript">

        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-41920728-1']);
        _gaq.push(['_trackPageview']);

        (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
    </script>

  </head>
  <body>
<div id="logo-banner">
  <div class="logo">
    <a href="../../index.html">
      <img src="../../_static/nilearn-logo.png" alt="Nilearn logo"  border="0" />
    </a>
  </div>
  <!-- A tag cloud to make it easy for people to find what they are
                         looking for -->
 <div class="tags">
  <ul>
    <li>
      <big><a href="../decoding/plot_haxby_anova_svm.html">SVM</a></big>
    </li>
    <li>
      <small><a href="../../connectivity/parcellating.html">Ward
          clustering</a></small>
    </li>
    <li>
      <a href="../../decoding/searchlight.html">Searchlight</a>
    </li>
    <li>
      <big><a href="../../connectivity/resting_state_networks.html">ICA</a></big>
    </li>
    <li>
      <a href="../../manipulating_images/data_preparation.html">Nifti IO</a>
    </li>
    <li>
      <a href="../../modules/reference.html#module-nilearn.datasets">Datasets</a>
    </li>
  </ul>
 </div>

  <div class="banner">
    <h1>Nilearn:</h1>
    <h2>Machine learning for Neuro-Imaging in Python</h2>
  </div>
  <div class="search_form">
    <div class="gcse-search" id="cse" style="width: 100%;"></div>
    <script>
      (function() {
        var cx = '017289614950330089114:elrt9qoutrq';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
  </div>
</div>



<div class=related-wrapper>
    
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a></li>
        <li class="right" >
          <a href="plot_simulated_data.html" title="8.3.11. Example of pattern recognition on simulated data"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="plot_haxby_full_analysis.html" title="8.3.9. ROI-based decoding analysis in Haxby et al. dataset"
             accesskey="P">previous</a> |</li>
<li><a href="../../index.html">Nilearn Home</a> |&nbsp;</li>
<li><a href="../../user_guide.html">User Guide</a> |&nbsp;</li>
<li><a href="../index.html">Examples</a> |&nbsp;</li>
<li><a href="../../modules/reference.html">Reference</a> |&nbsp;</li>
<li id="navbar-about"><a href="../../authors.html">About</a>|&nbsp;</li>
<li id="navbar-ecosystem"><a href="http://www.nipy.org/">Nipy ecosystem</a></li>

          <li class="nav-item nav-item-1"><a href="../../user_guide.html" >User guide: table of contents</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../index.html" accesskey="U">8. Nilearn usage examples</a> &#187;</li> 
      </ul>
    </div>
</div>

      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">


<h4> Giving credit </h4>
  <ul class="simple">
    <li><p>Please consider <a href="../../authors.html#citing">citing the
                    papers</a>.</p></li>
  </ul>

	   <div class="sidebartoc">
  <h3><a href="../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">8.3.10. Voxel-Based Morphometry on Oasis dataset</a><ul>
<li><a class="reference internal" href="#predictive-modeling-analysis-vbm-bio-markers-of-aging">8.3.10.1. Predictive modeling analysis: VBM bio-markers of aging?</a></li>
<li><a class="reference internal" href="#brain-mapping-with-mass-univariate">8.3.10.2. Brain mapping with mass univariate</a></li>
<li><a class="reference internal" href="#load-oasis-dataset">8.3.10.3. Load Oasis dataset</a></li>
<li><a class="reference internal" href="#preprocess-data">8.3.10.4. Preprocess data</a></li>
<li><a class="reference internal" href="#prediction-pipeline-with-anova-and-svr">8.3.10.5. Prediction pipeline with ANOVA and SVR</a></li>
<li><a class="reference internal" href="#visualization">8.3.10.6. Visualization</a></li>
</ul>
</li>
</ul>
</div>

  <h4>Previous topic</h4>
  <p class="topless"><a href="plot_haxby_full_analysis.html"
                        title="previous chapter">8.3.9. ROI-based decoding analysis in Haxby et al. dataset</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="plot_simulated_data.html"
                        title="next chapter">8.3.11. Example of pattern recognition on simulated data</a></p>

<script type="text/javascript">$('#searchbox-ml').show(0);</script>
<script type="text/javascript">$('#searchbox-site').show(0);</script>


        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="voxel-based-morphometry-on-oasis-dataset">
<span id="sphx-glr-auto-examples-02-decoding-plot-oasis-vbm-py"></span><h1>8.3.10. Voxel-Based Morphometry on Oasis dataset<a class="headerlink" href="#voxel-based-morphometry-on-oasis-dataset" title="Permalink to this headline">¶</a></h1>
<p>This example uses Voxel-Based Morphometry (VBM) to study the relationship
between aging and gray matter density.</p>
<p>The data come from the <a class="reference external" href="http://www.oasis-brains.org/">OASIS</a> project.
If you use it, you need to agree with the data usage agreement available
on the website.</p>
<p>It has been run through a standard VBM pipeline (using SPM8 and
NewSegment) to create VBM maps, which we study here.</p>
<div class="section" id="predictive-modeling-analysis-vbm-bio-markers-of-aging">
<h2>8.3.10.1. Predictive modeling analysis: VBM bio-markers of aging?<a class="headerlink" href="#predictive-modeling-analysis-vbm-bio-markers-of-aging" title="Permalink to this headline">¶</a></h2>
<p>We run a standard SVM-ANOVA nilearn pipeline to predict age from the VBM
data. We use only 100 subjects from the OASIS dataset to limit the memory
usage.</p>
<p>Note that for an actual predictive modeling study of aging, the study
should be ran on the full set of subjects. Also, parameters such as the
smoothing applied to the data and the number of features selected by the
Anova step should be set by nested cross-validation, as they impact
significantly the prediction score.</p>
</div>
<div class="section" id="brain-mapping-with-mass-univariate">
<h2>8.3.10.2. Brain mapping with mass univariate<a class="headerlink" href="#brain-mapping-with-mass-univariate" title="Permalink to this headline">¶</a></h2>
<p>SVM weights are very noisy, partly because heavy smoothing is detrimental
for the prediction here. A standard analysis using mass-univariate GLM
(here permuted to have exact correction for multiple comparisons) gives a
much clearer view of the important regions.</p>
<hr class="docutils" />
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># Authors: Elvis Dhomatob, &lt;elvis.dohmatob@inria.fr&gt;, Apr. 2014</span>
<span class="c1">#          Virgile Fritsch, &lt;virgile.fritsch@inria.fr&gt;, Apr 2014</span>
<span class="c1">#          Gael Varoquaux, Apr 2014</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">nilearn</span> <span class="kn">import</span> <span class="n">datasets</span>
<span class="kn">from</span> <span class="nn">nilearn.input_data</span> <span class="kn">import</span> <a href="../../modules/generated/nilearn.input_data.NiftiMasker.html#nilearn.input_data.NiftiMasker" title="View documentation for nilearn.input_data.NiftiMasker"><span class="n">NiftiMasker</span></a>

<span class="n">n_subjects</span> <span class="o">=</span> <span class="mi">100</span>  <span class="c1"># more subjects requires more memory</span>
</pre></div>
</div>
</div>
<div class="section" id="load-oasis-dataset">
<h2>8.3.10.3. Load Oasis dataset<a class="headerlink" href="#load-oasis-dataset" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">oasis_dataset</span> <span class="o">=</span> <a href="../../modules/generated/nilearn.datasets.fetch_oasis_vbm.html#nilearn.datasets.fetch_oasis_vbm" title="View documentation for nilearn.datasets.fetch_oasis_vbm"><span class="n">datasets</span><span class="o">.</span><span class="n">fetch_oasis_vbm</span></a><span class="p">(</span><span class="n">n_subjects</span><span class="o">=</span><span class="n">n_subjects</span><span class="p">)</span>
<span class="n">gray_matter_map_filenames</span> <span class="o">=</span> <span class="n">oasis_dataset</span><span class="o">.</span><span class="n">gray_matter_maps</span>
<span class="n">age</span> <span class="o">=</span> <span class="n">oasis_dataset</span><span class="o">.</span><span class="n">ext_vars</span><span class="p">[</span><span class="s1">&#39;age&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>

<span class="c1"># print basic information on the dataset</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;First gray-matter anatomy image (3D) is located at: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span>
      <span class="n">oasis_dataset</span><span class="o">.</span><span class="n">gray_matter_maps</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>  <span class="c1"># 3D data</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;First white-matter anatomy image (3D) is located at: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span>
      <span class="n">oasis_dataset</span><span class="o">.</span><span class="n">white_matter_maps</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>  <span class="c1"># 3D data</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-default"><div class="highlight"><pre><span></span><span class="n">First</span> <span class="n">gray</span><span class="o">-</span><span class="n">matter</span> <span class="n">anatomy</span> <span class="n">image</span> <span class="p">(</span><span class="mi">3</span><span class="n">D</span><span class="p">)</span> <span class="ow">is</span> <span class="n">located</span> <span class="n">at</span><span class="p">:</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">varoquau</span><span class="o">/</span><span class="n">nilearn_data</span><span class="o">/</span><span class="n">oasis1</span><span class="o">/</span><span class="n">OAS1_0001_MR1</span><span class="o">/</span><span class="n">mwrc1OAS1_0001_MR1_mpr_anon_fslswapdim_bet</span><span class="o">.</span><span class="n">nii</span><span class="o">.</span><span class="n">gz</span>
<span class="n">First</span> <span class="n">white</span><span class="o">-</span><span class="n">matter</span> <span class="n">anatomy</span> <span class="n">image</span> <span class="p">(</span><span class="mi">3</span><span class="n">D</span><span class="p">)</span> <span class="ow">is</span> <span class="n">located</span> <span class="n">at</span><span class="p">:</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">varoquau</span><span class="o">/</span><span class="n">nilearn_data</span><span class="o">/</span><span class="n">oasis1</span><span class="o">/</span><span class="n">OAS1_0001_MR1</span><span class="o">/</span><span class="n">mwrc2OAS1_0001_MR1_mpr_anon_fslswapdim_bet</span><span class="o">.</span><span class="n">nii</span><span class="o">.</span><span class="n">gz</span>
</pre></div>
</div>
</div>
<div class="section" id="preprocess-data">
<h2>8.3.10.4. Preprocess data<a class="headerlink" href="#preprocess-data" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">nifti_masker</span> <span class="o">=</span> <a href="../../modules/generated/nilearn.input_data.NiftiMasker.html#nilearn.input_data.NiftiMasker" title="View documentation for nilearn.input_data.NiftiMasker"><span class="n">NiftiMasker</span></a><span class="p">(</span>
    <span class="n">standardize</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
    <span class="n">smoothing_fwhm</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">memory</span><span class="o">=</span><span class="s1">&#39;nilearn_cache&#39;</span><span class="p">)</span>  <span class="c1"># cache options</span>
<span class="n">gm_maps_masked</span> <span class="o">=</span> <span class="n">nifti_masker</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">gray_matter_map_filenames</span><span class="p">)</span>
<span class="n">n_samples</span><span class="p">,</span> <span class="n">n_features</span> <span class="o">=</span> <span class="n">gm_maps_masked</span><span class="o">.</span><span class="n">shape</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> samples, </span><span class="si">%d</span><span class="s2"> features&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">n_subjects</span><span class="p">,</span> <span class="n">n_features</span><span class="p">))</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-default"><div class="highlight"><pre><span></span><span class="mi">100</span> <span class="n">samples</span><span class="p">,</span> <span class="mi">902629</span> <span class="n">features</span>
</pre></div>
</div>
</div>
<div class="section" id="prediction-pipeline-with-anova-and-svr">
<h2>8.3.10.5. Prediction pipeline with ANOVA and SVR<a class="headerlink" href="#prediction-pipeline-with-anova-and-svr" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="s2">&quot;ANOVA + SVR&quot;</span><span class="p">)</span>
<span class="c1"># Define the prediction function to be used.</span>
<span class="c1"># Here we use a Support Vector Classification, with a linear kernel</span>
<span class="kn">from</span> <span class="nn">sklearn.svm</span> <span class="kn">import</span> <a href="http://scikit-learn.org/0.18/modules/generated/sklearn.svm.SVR.html#sklearn.svm.SVR" title="View documentation for sklearn.svm.SVR"><span class="n">SVR</span></a>
<span class="n">svr</span> <span class="o">=</span> <a href="http://scikit-learn.org/0.18/modules/generated/sklearn.svm.SVR.html#sklearn.svm.SVR" title="View documentation for sklearn.svm.SVR"><span class="n">SVR</span></a><span class="p">(</span><span class="n">kernel</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">)</span>

<span class="c1"># Dimension reduction</span>
<span class="kn">from</span> <span class="nn">sklearn.feature_selection</span> <span class="kn">import</span> <a href="http://scikit-learn.org/0.18/modules/generated/sklearn.feature_selection.VarianceThreshold.html#sklearn.feature_selection.VarianceThreshold" title="View documentation for sklearn.feature_selection.VarianceThreshold"><span class="n">VarianceThreshold</span></a><span class="p">,</span> <a href="http://scikit-learn.org/0.18/modules/generated/sklearn.feature_selection.SelectKBest.html#sklearn.feature_selection.SelectKBest" title="View documentation for sklearn.feature_selection.SelectKBest"><span class="n">SelectKBest</span></a><span class="p">,</span> \
        <a href="http://scikit-learn.org/0.18/modules/generated/sklearn.feature_selection.f_regression.html#sklearn.feature_selection.f_regression" title="View documentation for sklearn.feature_selection.f_regression"><span class="n">f_regression</span></a>

<span class="c1"># Remove features with too low between-subject variance</span>
<span class="n">variance_threshold</span> <span class="o">=</span> <a href="http://scikit-learn.org/0.18/modules/generated/sklearn.feature_selection.VarianceThreshold.html#sklearn.feature_selection.VarianceThreshold" title="View documentation for sklearn.feature_selection.VarianceThreshold"><span class="n">VarianceThreshold</span></a><span class="p">(</span><span class="n">threshold</span><span class="o">=.</span><span class="mo">01</span><span class="p">)</span>

<span class="c1"># Here we use a classical univariate feature selection based on F-test,</span>
<span class="c1"># namely Anova.</span>
<span class="n">feature_selection</span> <span class="o">=</span> <a href="http://scikit-learn.org/0.18/modules/generated/sklearn.feature_selection.SelectKBest.html#sklearn.feature_selection.SelectKBest" title="View documentation for sklearn.feature_selection.SelectKBest"><span class="n">SelectKBest</span></a><span class="p">(</span><a href="http://scikit-learn.org/0.18/modules/generated/sklearn.feature_selection.f_regression.html#sklearn.feature_selection.f_regression" title="View documentation for sklearn.feature_selection.f_regression"><span class="n">f_regression</span></a><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">2000</span><span class="p">)</span>

<span class="c1"># We have our predictor (SVR), our feature selection (SelectKBest), and now,</span>
<span class="c1"># we can plug them together in a *pipeline* that performs the two operations</span>
<span class="c1"># successively:</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <a href="http://scikit-learn.org/0.18/modules/generated/sklearn.pipeline.Pipeline.html#sklearn.pipeline.Pipeline" title="View documentation for sklearn.pipeline.Pipeline"><span class="n">Pipeline</span></a>
<span class="n">anova_svr</span> <span class="o">=</span> <a href="http://scikit-learn.org/0.18/modules/generated/sklearn.pipeline.Pipeline.html#sklearn.pipeline.Pipeline" title="View documentation for sklearn.pipeline.Pipeline"><span class="n">Pipeline</span></a><span class="p">([</span>
            <span class="p">(</span><span class="s1">&#39;variance_threshold&#39;</span><span class="p">,</span> <span class="n">variance_threshold</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;anova&#39;</span><span class="p">,</span> <span class="n">feature_selection</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;svr&#39;</span><span class="p">,</span> <span class="n">svr</span><span class="p">)])</span>

<span class="c1">### Fit and predict</span>
<span class="n">anova_svr</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">gm_maps_masked</span><span class="p">,</span> <span class="n">age</span><span class="p">)</span>
<span class="n">age_pred</span> <span class="o">=</span> <span class="n">anova_svr</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">gm_maps_masked</span><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-default"><div class="highlight"><pre><span></span><span class="n">ANOVA</span> <span class="o">+</span> <a href="http://scikit-learn.org/0.18/modules/generated/sklearn.svm.SVR.html#sklearn.svm.SVR" title="View documentation for sklearn.svm.SVR"><span class="n">SVR</span></a>
</pre></div>
</div>
</div>
<div class="section" id="visualization">
<h2>8.3.10.6. Visualization<a class="headerlink" href="#visualization" title="Permalink to this headline">¶</a></h2>
<p>Look at the SVR’s discriminating weights</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">coef</span> <span class="o">=</span> <span class="n">svr</span><span class="o">.</span><span class="n">coef_</span>
<span class="c1"># reverse feature selection</span>
<span class="n">coef</span> <span class="o">=</span> <span class="n">feature_selection</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">coef</span><span class="p">)</span>
<span class="c1"># reverse variance threshold</span>
<span class="n">coef</span> <span class="o">=</span> <span class="n">variance_threshold</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">coef</span><span class="p">)</span>
<span class="c1"># reverse masking</span>
<span class="n">weight_img</span> <span class="o">=</span> <span class="n">nifti_masker</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">coef</span><span class="p">)</span>

<span class="c1"># Create the figure</span>
<span class="kn">from</span> <span class="nn">nilearn.plotting</span> <span class="kn">import</span> <a href="../../modules/generated/nilearn.plotting.plot_stat_map.html#nilearn.plotting.plot_stat_map" title="View documentation for nilearn.plotting.plot_stat_map"><span class="n">plot_stat_map</span></a><span class="p">,</span> <a href="../../modules/generated/nilearn.plotting.show.html#nilearn.plotting.show" title="View documentation for nilearn.plotting.show"><span class="n">show</span></a>
<span class="n">bg_filename</span> <span class="o">=</span> <span class="n">gray_matter_map_filenames</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">z_slice</span> <span class="o">=</span> <span class="mi">0</span>


<span class="n">fig</span> <span class="o">=</span> <a href="http://matplotlib.org/api/_as_gen/matplotlib.figure.SubplotParams.html#matplotlib.figure" title="View documentation for matplotlib.pyplot.figure"><span class="n">plt</span><span class="o">.</span><span class="n">figure</span></a><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">5.5</span><span class="p">,</span> <span class="mf">7.5</span><span class="p">),</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="c1"># Hard setting vmax to highlight weights more</span>
<span class="n">display</span> <span class="o">=</span> <a href="../../modules/generated/nilearn.plotting.plot_stat_map.html#nilearn.plotting.plot_stat_map" title="View documentation for nilearn.plotting.plot_stat_map"><span class="n">plot_stat_map</span></a><span class="p">(</span><span class="n">weight_img</span><span class="p">,</span> <span class="n">bg_img</span><span class="o">=</span><span class="n">bg_filename</span><span class="p">,</span>
                        <span class="n">display_mode</span><span class="o">=</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="n">cut_coords</span><span class="o">=</span><span class="p">[</span><span class="n">z_slice</span><span class="p">],</span>
                        <span class="n">figure</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">display</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;SVM weights&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.2</span><span class="p">)</span>

<span class="c1"># Measure accuracy with cross validation</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <a href="http://scikit-learn.org/0.18/modules/generated/sklearn.model_selection.cross_val_score.html#sklearn.model_selection.cross_val_score" title="View documentation for sklearn.model_selection.cross_val_score"><span class="n">cross_val_score</span></a>
<span class="n">cv_scores</span> <span class="o">=</span> <a href="http://scikit-learn.org/0.18/modules/generated/sklearn.model_selection.cross_val_score.html#sklearn.model_selection.cross_val_score" title="View documentation for sklearn.model_selection.cross_val_score"><span class="n">cross_val_score</span></a><span class="p">(</span><span class="n">anova_svr</span><span class="p">,</span> <span class="n">gm_maps_masked</span><span class="p">,</span> <span class="n">age</span><span class="p">)</span>

<span class="c1"># Return the corresponding mean prediction accuracy</span>
<span class="n">prediction_accuracy</span> <span class="o">=</span> <a href="http://docs.scipy.org/doc/numpy-1.11.0/reference/generated/numpy.mean.html#numpy.mean" title="View documentation for numpy.mean"><span class="n">np</span><span class="o">.</span><span class="n">mean</span></a><span class="p">(</span><span class="n">cv_scores</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;=== ANOVA ===&quot;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;Prediction accuracy: </span><span class="si">%f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">prediction_accuracy</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

<span class="c1">### Inference with massively univariate model #################################</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;Massively univariate model&quot;</span><span class="p">)</span>

<span class="c1"># Statistical inference</span>
<span class="kn">from</span> <span class="nn">nilearn.mass_univariate</span> <span class="kn">import</span> <a href="../../modules/generated/nilearn.mass_univariate.permuted_ols.html#nilearn.mass_univariate.permuted_ols" title="View documentation for nilearn.mass_univariate.permuted_ols"><span class="n">permuted_ols</span></a>
<span class="n">data</span> <span class="o">=</span> <span class="n">variance_threshold</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">gm_maps_masked</span><span class="p">)</span>
<span class="n">neg_log_pvals</span><span class="p">,</span> <span class="n">t_scores_original_data</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <a href="../../modules/generated/nilearn.mass_univariate.permuted_ols.html#nilearn.mass_univariate.permuted_ols" title="View documentation for nilearn.mass_univariate.permuted_ols"><span class="n">permuted_ols</span></a><span class="p">(</span>
    <span class="n">age</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span>  <span class="c1"># + intercept as a covariate by default</span>
    <span class="n">n_perm</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span>  <span class="c1"># 1,000 in the interest of time; 10000 would be better</span>
    <span class="n">n_jobs</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># can be changed to use more CPUs</span>
<span class="n">signed_neg_log_pvals</span> <span class="o">=</span> <span class="n">neg_log_pvals</span> <span class="o">*</span> <a href="http://docs.scipy.org/doc/numpy-1.11.0/reference/generated/numpy.sign.html#numpy.sign" title="View documentation for numpy.sign"><span class="n">np</span><span class="o">.</span><span class="n">sign</span></a><span class="p">(</span><span class="n">t_scores_original_data</span><span class="p">)</span>
<span class="n">signed_neg_log_pvals_unmasked</span> <span class="o">=</span> <span class="n">nifti_masker</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span>
    <span class="n">variance_threshold</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">signed_neg_log_pvals</span><span class="p">))</span>

<span class="c1"># Show results</span>
<span class="n">threshold</span> <span class="o">=</span> <span class="o">-</span><a href="http://docs.scipy.org/doc/numpy-1.11.0/reference/generated/numpy.log10.html#numpy.log10" title="View documentation for numpy.log10"><span class="n">np</span><span class="o">.</span><span class="n">log10</span></a><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>  <span class="c1"># 10% corrected</span>

<span class="n">fig</span> <span class="o">=</span> <a href="http://matplotlib.org/api/_as_gen/matplotlib.figure.SubplotParams.html#matplotlib.figure" title="View documentation for matplotlib.pyplot.figure"><span class="n">plt</span><span class="o">.</span><span class="n">figure</span></a><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">5.5</span><span class="p">,</span> <span class="mf">7.5</span><span class="p">),</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>

<span class="n">display</span> <span class="o">=</span> <a href="../../modules/generated/nilearn.plotting.plot_stat_map.html#nilearn.plotting.plot_stat_map" title="View documentation for nilearn.plotting.plot_stat_map"><span class="n">plot_stat_map</span></a><span class="p">(</span><span class="n">signed_neg_log_pvals_unmasked</span><span class="p">,</span> <span class="n">bg_img</span><span class="o">=</span><span class="n">bg_filename</span><span class="p">,</span>
                        <span class="n">threshold</span><span class="o">=</span><span class="n">threshold</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">RdBu_r</span><span class="p">,</span>
                        <span class="n">display_mode</span><span class="o">=</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="n">cut_coords</span><span class="o">=</span><span class="p">[</span><span class="n">z_slice</span><span class="p">],</span>
                        <span class="n">figure</span><span class="o">=</span><span class="n">fig</span><span class="p">)</span>
<span class="n">title</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Negative $\log_{10}$ p-values&#39;</span>
         <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">(Non-parametric + max-type correction)&#39;</span><span class="p">)</span>
<span class="n">display</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.2</span><span class="p">)</span>

<span class="n">n_detections</span> <span class="o">=</span> <span class="p">(</span><span class="n">signed_neg_log_pvals_unmasked</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="si">%d</span><span class="s1"> detections&#39;</span> <span class="o">%</span> <span class="n">n_detections</span><span class="p">)</span>

<a href="../../modules/generated/nilearn.plotting.show.html#nilearn.plotting.show" title="View documentation for nilearn.plotting.show"><span class="n">show</span></a><span class="p">()</span>
</pre></div>
</div>
<ul class="sphx-glr-horizontal">
<li><a class="first reference internal image-reference" href="../../_images/sphx_glr_plot_oasis_vbm_001.png"><img alt="../../_images/sphx_glr_plot_oasis_vbm_001.png" src="../../_images/sphx_glr_plot_oasis_vbm_001.png" style="width: 258.5px; height: 352.5px;" /></a>
</li>
<li><a class="first reference internal image-reference" href="../../_images/sphx_glr_plot_oasis_vbm_002.png"><img alt="../../_images/sphx_glr_plot_oasis_vbm_002.png" src="../../_images/sphx_glr_plot_oasis_vbm_002.png" style="width: 258.5px; height: 352.5px;" /></a>
</li>
</ul>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-default"><div class="highlight"><pre><span></span><span class="o">===</span> <span class="n">ANOVA</span> <span class="o">===</span>
<span class="n">Prediction</span> <span class="n">accuracy</span><span class="p">:</span> <span class="mf">0.736385</span>

<span class="n">Massively</span> <span class="n">univariate</span> <span class="n">model</span>

<span class="mi">1944</span> <span class="n">detections</span>
</pre></div>
</div>
<p><strong>Total running time of the script:</strong> ( 1 minutes  11.896 seconds)</p>
<div class="sphx-glr-footer docutils container">
<div class="sphx-glr-download docutils container">
<a class="reference download internal" href="../../_downloads/plot_oasis_vbm.py" download=""><code class="xref download docutils literal"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">plot_oasis_vbm.py</span></code></a></div>
<div class="sphx-glr-download docutils container">
<a class="reference download internal" href="../../_downloads/plot_oasis_vbm.ipynb" download=""><code class="xref download docutils literal"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">plot_oasis_vbm.ipynb</span></code></a></div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.readthedocs.io">Generated by Sphinx-Gallery</a></p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>

    <div class="footer">
            &copy; The nilearn developers 2010-2015.
          Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.6.7.
        <span style="padding-left: 5ex;">
          <a href="../../_sources/auto_examples/02_decoding/plot_oasis_vbm.rst.txt"
        	 rel="nofollow">Show this page source</a>
        </span>
    </div>
  </body>
</html>