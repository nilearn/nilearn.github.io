<!doctypehtml><html lang=en><meta charset=utf-8><meta content=width=device-width,initial-scale=1.0 name=viewport><meta content="9.6.5. Second-level fMRI model: two-sample test, unpaired and paired"property=og:title><meta content=website property=og:type><meta content=https://nilearn.github.io/auto_examples/05_glm_second_level/plot_second_level_two_sample_test.html property=og:url><meta content=Nilearn property=og:site_name><meta content="Full step-by-step example of fitting a GLM to perform a second level analysis in experimental data and visualizing the results More specifically: A sample of n=16 visual activity fMRIs are download..."property=og:description><meta content=https://nilearn.github.io/_static/nilearn-logo.png property=og:image><meta content=Nilearn property=og:image:alt><title>Nilearn: Statistical Analysis for NeuroImaging in Python — Machine learning for NeuroImaging</title><link href=../../_static/pygments.css rel=stylesheet><link href=../../_static/nature.css rel=stylesheet><link href=../../_static/copybutton.css rel=stylesheet><link href=../../_static/sg_gallery.css rel=stylesheet><link href=../../_static/sg_gallery-binder.css rel=stylesheet><link href=../../_static/sg_gallery-dataframe.css rel=stylesheet><link href=../../_static/sg_gallery-rendered-html.css rel=stylesheet><script data-url_root=../../ id=documentation_options src=../../_static/documentation_options.js></script><script src=../../_static/jquery.js></script><script src=../../_static/underscore.js></script><script src=../../_static/doctools.js></script><script src=../../_static/clipboard.min.js></script><script src=../../_static/copybutton.js></script><link rel="shortcut icon"href=../../_static/favicon.ico><link href=../../search.html rel=search title=Search><link title="9.6.6. Second-level fMRI model: one sample test"href=plot_second_level_one_sample_test.html rel=next><link title="9.6.4. Voxel-Based Morphometry on Oasis dataset"href=plot_oasis.html rel=prev><meta content=True name=HandheldFriendly><meta content=width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0 name=viewport><meta content="nilearn, neuroimaging, python, neuroscience, machinelearning"name=keywords><script>function updateTopMenuPosition(height, width) {
    if($(window).scrollTop() > height && $(window).outerWidth() > 1024) {
        //begin to scroll
        $('.related-wrapper').css("z-index", 1000);
        $('.related-wrapper').css("position", "sticky");
        $('.related-wrapper').css("top", 0);
        $('.related-wrapper').css("width", width)
    } else {
        //lock it back into place
        $('.related-wrapper').css("position", "relative");
        $('.related-wrapper').css("top", 0)
    }
}

$(function() {
    var banner_height = $('#logo-banner').outerHeight();
    var banner_width = $('#logo-banner').outerWidth();
    var width = $('.related-wrapper').css("height", $('.related').outerHeight());

    updateTopMenuPosition(banner_height, width);

    $(window).scroll(function(event) {
        updateTopMenuPosition(banner_height, width)
    });

    $(window).resize(function(event) {
        var banner_width = $('#logo-banner').outerWidth();
        var menu_height = $('.related').outerHeight();
        $('.related').css("width", banner_width);
        $('.related-wrapper').css("height", menu_height);
        updateTopMenuPosition(banner_height, width)
    })
});</script><script>function updateSideBarPosition(top, offset, sections) {
    var pos = $(window).scrollTop();
    // Lock the table of content to a fixed position once we scroll enough
    var topShift = 2 * offset;
    if(pos > top + topShift + 1) {
        // begin to scroll with sticky menu bar
        var topShift = -topShift + 1;
        if ($(window).outerWidth() < 1024) {
            // compensate top menu that disappears
            topShift -= offset + 1
        }
        $('.sphinxsidebarwrapper').css("position", "fixed");
        $('.sphinxsidebarwrapper').css("top", topShift)
    }
    else {
        //lock it back into place
        $('.sphinxsidebarwrapper').css("position", "relative");
        $('.sphinxsidebarwrapper').css("top",0)
    }

    // Highlight the current section
    i = 0;
    current_section = 0;
    $('a.internal').removeClass('active');
    for(i in sections) {
        if(sections[i] > pos) {
            break
        }
        if($('a.internal[href$="' + i + '"]').is(':visible')){
            current_section = i
        }
    }
    $('a.internal[href$="' + current_section + '"]').addClass('active');
    $('a.internal[href$="' + current_section + '"]').parent().addClass('active')
}

$(function () {
    // Lock the table of content to a fixed position once we scroll enough
    var tocOffset = $('.related-wrapper').outerHeight();
    var marginTop = parseFloat($('.sphinxsidebarwrapper').css('margin-top').replace(/auto/, 0));
    var top = $('.sphinxsidebarwrapper').offset().top - marginTop;
    sections = {};
    url = document.URL.replace(/#.*$/, "");

    // Grab positions of our sections
    $('.headerlink').each(function(){
        sections[this.href.replace(url, '')] = $(this).offset().top - 50
    });

    updateSideBarPosition(top, tocOffset, sections);

    $(window).scroll(function(event) {
        updateSideBarPosition(top, tocOffset, sections)
    });

    $(window).resize(function(event) {
        tocOffset = $('.related-wrapper').outerHeight();
        updateSideBarPosition(top, tocOffset, sections)
    });
});</script><script>var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-41920728-1']);
        _gaq.push(['_trackPageview']);

        (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();</script><body><div id=logo-banner><div class=logo><a href=../../index.html> <img alt="Nilearn logo"border=0 src=../../_static/nilearn-logo.png> </a></div><div class=tags><ul><li><big><a href=../decoding/plot_haxby_anova_svm.html>SVM</a></big></li><li><small><a href=../../connectivity/parcellating.html>Ward clustering</a></small></li><li><a href=../../decoding/searchlight.html>Searchlight</a></li><li><big><a href=../../connectivity/resting_state_networks.html>ICA</a></big></li><li><a href=../../manipulating_images/data_preparation.html>Nifti IO</a></li><li><a href=../../modules/reference.html#module-nilearn.datasets>Datasets</a></li></ul></div><div class=banner><h1>Nilearn:</h1><h2>Statistics for NeuroImaging in Python</h2></div><div class=search_form><div class=gcse-search id=cse style=width:100%></div><script>(function() {
        var cx = '017289614950330089114:elrt9qoutrq';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();</script></div></div><div class=related-wrapper><div aria-label="related navigation"class=related role=navigation><h3>Navigation</h3><ul><li class=right style=margin-right:10px><a title="Python Module Index"href=../../py-modindex.html>modules</a></li><li class=right><a title="9.6.6. Second-level fMRI model: one sample test"accesskey=N href=plot_second_level_one_sample_test.html>next</a> |</li><li class=right><a title="9.6.4. Voxel-Based Morphometry on Oasis dataset"accesskey=P href=plot_oasis.html>previous</a> |</li><li><a href=../../index.html>Nilearn Home</a> | </li><li><a href=../../user_guide.html>User Guide</a> | </li><li><a href=../index.html>Examples</a> | </li><li><a href=../../modules/reference.html>Reference</a> | </li><li id=navbar-about><a href=../../authors.html>About</a>| </li><li><a href=../../glossary.html>Glossary</a>| </li><li><a href=../../bibliography.html>Bibliography</a>| </li><li id=navbar-ecosystem><a href=http://www.nipy.org/>Nipy ecosystem</a></li><li class="nav-item nav-item-1"><a href=../../user_guide.html>User guide: table of contents</a> »</li><li class="nav-item nav-item-2"><a accesskey=U href=../index.html><span class=section-number>9. </span>Nilearn usage examples</a> »</li><li class="nav-item nav-item-this"><a href>Nilearn: Statistical Analysis for NeuroImaging in Python</a></li></ul></div></div><div class=stable-banner>This is the <em>stable</em> documentation for the latest release of Nilearn, the current development version is available <a href=https://nilearn.github.io/dev/index.html>here</a>.</div><div class=document><div class=documentwrapper><div class=bodywrapper><div class=body role=main><div class="sphx-glr-download-link-note admonition note"><p class=admonition-title>Note</p><p>Click <a class="reference internal"href=#sphx-glr-download-auto-examples-05-glm-second-level-plot-second-level-two-sample-test-py><span class="std std-ref">here</span></a> to download the full example code or to run this example in your browser via Binder</p></div><div class="sphx-glr-example-title section"id=second-level-fmri-model-two-sample-test-unpaired-and-paired><span id=sphx-glr-auto-examples-05-glm-second-level-plot-second-level-two-sample-test-py></span><h1><span class=section-number>9.6.5. </span>Second-level fMRI model: two-sample test, unpaired and paired<a title="Permalink to this headline"class=headerlink href=#second-level-fmri-model-two-sample-test-unpaired-and-paired>¶</a></h1><p>Full step-by-step example of fitting a GLM to perform a second level analysis in experimental data and visualizing the results</p><p>More specifically:</p><ol class="arabic simple"><li><p>A sample of n=16 visual activity fMRIs are downloaded.</p></li></ol><p>2. An unpaired, two-sample t-test is applied to the brain maps in order to see the effect of the contrast difference across subjects.</p><p>3. A paired, two-sample t-test is applied to the brain maps in order to see the effect of the contrast difference across subjects, considering subject intercepts</p><p>The contrast is between responses to retinotopically distinct vertical versus horizontal checkerboards. At the individual level, these stimuli are sometimes used to map the borders of primary visual areas. At the group level, such a mapping is not possible. Yet, we may observe some significant effects in these areas.</p><div class="highlight-default notranslate"><div class=highlight><pre><span></span><span class=kn>import</span> <span class=nn>pandas</span> <span class=k>as</span> <span class=nn>pd</span>
<span class=kn>from</span> <span class=nn>nilearn</span> <span class=kn>import</span> <span class=n>plotting</span>
<span class=kn>from</span> <span class=nn>nilearn.datasets</span> <span class=kn>import</span> <a class="sphx-glr-backref-module-nilearn-datasets sphx-glr-backref-type-py-function"href=../../modules/generated/nilearn.datasets.fetch_localizer_contrasts.html#nilearn.datasets.fetch_localizer_contrasts title=nilearn.datasets.fetch_localizer_contrasts><span class=n>fetch_localizer_contrasts</span></a>
<span class=kn>import</span> <span class=nn>matplotlib.pyplot</span> <span class=k>as</span> <span class=nn>plt</span>
</pre></div></div><div class=section id=fetch-dataset><h2><span class=section-number>9.6.5.1. </span>Fetch dataset<a title="Permalink to this headline"class=headerlink href=#fetch-dataset>¶</a></h2><p>We download a list of left vs right button press contrasts from a localizer dataset.</p><div class="highlight-default notranslate"><div class=highlight><pre><span></span><a class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"href=https://docs.python.org/3.8/library/functions.html#int title=builtins.int><span class=n>n_subjects</span></a> <span class=o>=</span> <span class=mi>16</span>
<a class="sphx-glr-backref-module-sklearn-utils sphx-glr-backref-type-py-function"href=https://scikit-learn.org/stable/modules/generated/sklearn.utils.Bunch.html#sklearn.utils.Bunch title=sklearn.utils.Bunch><span class=n>sample_vertical</span></a> <span class=o>=</span> <a class="sphx-glr-backref-module-nilearn-datasets sphx-glr-backref-type-py-function"href=../../modules/generated/nilearn.datasets.fetch_localizer_contrasts.html#nilearn.datasets.fetch_localizer_contrasts title=nilearn.datasets.fetch_localizer_contrasts><span class=n>fetch_localizer_contrasts</span></a><span class=p>(</span>
    <span class=p>[</span><span class=s2>"vertical checkerboard"</span><span class=p>],</span> <a class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"href=https://docs.python.org/3.8/library/functions.html#int title=builtins.int><span class=n>n_subjects</span></a><span class=p>,</span>
    <span class=n>get_tmaps</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>legacy_format</span><span class=o>=</span><span class=kc>False</span>
<span class=p>)</span>
<a class="sphx-glr-backref-module-sklearn-utils sphx-glr-backref-type-py-function"href=https://scikit-learn.org/stable/modules/generated/sklearn.utils.Bunch.html#sklearn.utils.Bunch title=sklearn.utils.Bunch><span class=n>sample_horizontal</span></a> <span class=o>=</span> <a class="sphx-glr-backref-module-nilearn-datasets sphx-glr-backref-type-py-function"href=../../modules/generated/nilearn.datasets.fetch_localizer_contrasts.html#nilearn.datasets.fetch_localizer_contrasts title=nilearn.datasets.fetch_localizer_contrasts><span class=n>fetch_localizer_contrasts</span></a><span class=p>(</span>
    <span class=p>[</span><span class=s2>"horizontal checkerboard"</span><span class=p>],</span> <a class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"href=https://docs.python.org/3.8/library/functions.html#int title=builtins.int><span class=n>n_subjects</span></a><span class=p>,</span>
    <span class=n>get_tmaps</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>legacy_format</span><span class=o>=</span><span class=kc>False</span>
<span class=p>)</span>

<span class=c1># Implicitly, there is a one-to-one correspondence between the two samples:</span>
<span class=c1># the first image of both samples comes from subject S1, the second from subject S2 etc.</span>
</pre></div></div></div><div class=section id=estimate-second-level-models><h2><span class=section-number>9.6.5.2. </span>Estimate second level models<a title="Permalink to this headline"class=headerlink href=#estimate-second-level-models>¶</a></h2><p>We define the input maps and the design matrix for the second level model and fit it.</p><div class="highlight-default notranslate"><div class=highlight><pre><span></span><a class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"href=https://docs.python.org/3.8/library/stdtypes.html#list title=builtins.list><span class=n>second_level_input</span></a> <span class=o>=</span> <a class="sphx-glr-backref-module-sklearn-utils sphx-glr-backref-type-py-function"href=https://scikit-learn.org/stable/modules/generated/sklearn.utils.Bunch.html#sklearn.utils.Bunch title=sklearn.utils.Bunch><span class=n>sample_vertical</span></a><span class=p>[</span><span class=s1>'cmaps'</span><span class=p>]</span> <span class=o>+</span> <a class="sphx-glr-backref-module-sklearn-utils sphx-glr-backref-type-py-function"href=https://scikit-learn.org/stable/modules/generated/sklearn.utils.Bunch.html#sklearn.utils.Bunch title=sklearn.utils.Bunch><span class=n>sample_horizontal</span></a><span class=p>[</span><span class=s1>'cmaps'</span><span class=p>]</span>
</pre></div></div><p>Next, we model the effect of conditions (sample 1 vs sample 2).</p><div class="highlight-default notranslate"><div class=highlight><pre><span></span><span class=kn>import</span> <span class=nn>numpy</span> <span class=k>as</span> <span class=nn>np</span>
<a class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"href=https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray title=numpy.ndarray><span class=n>condition_effect</span></a> <span class=o>=</span> <a class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"href=https://numpy.org/doc/stable/reference/generated/numpy.hstack.html#numpy.hstack title=numpy.hstack><span class=n>np</span><span class=o>.</span><span class=n>hstack</span></a><span class=p>(([</span><span class=mi>1</span><span class=p>]</span> <span class=o>*</span> <a class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"href=https://docs.python.org/3.8/library/functions.html#int title=builtins.int><span class=n>n_subjects</span></a><span class=p>,</span> <span class=p>[</span><span class=o>-</span> <span class=mi>1</span><span class=p>]</span> <span class=o>*</span> <a class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"href=https://docs.python.org/3.8/library/functions.html#int title=builtins.int><span class=n>n_subjects</span></a><span class=p>))</span>
</pre></div></div><p>The design matrix for the unpaired test doesn’t need any more columns For the paired test, we include an intercept for each subject.</p><div class="highlight-default notranslate"><div class=highlight><pre><span></span><a class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"href=https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray title=numpy.ndarray><span class=n>subject_effect</span></a> <span class=o>=</span> <a class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"href=https://numpy.org/doc/stable/reference/generated/numpy.vstack.html#numpy.vstack title=numpy.vstack><span class=n>np</span><span class=o>.</span><span class=n>vstack</span></a><span class=p>((</span><a class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"href=https://numpy.org/doc/stable/reference/generated/numpy.eye.html#numpy.eye title=numpy.eye><span class=n>np</span><span class=o>.</span><span class=n>eye</span></a><span class=p>(</span><a class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"href=https://docs.python.org/3.8/library/functions.html#int title=builtins.int><span class=n>n_subjects</span></a><span class=p>),</span> <a class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"href=https://numpy.org/doc/stable/reference/generated/numpy.eye.html#numpy.eye title=numpy.eye><span class=n>np</span><span class=o>.</span><span class=n>eye</span></a><span class=p>(</span><a class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"href=https://docs.python.org/3.8/library/functions.html#int title=builtins.int><span class=n>n_subjects</span></a><span class=p>)))</span>
<a class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"href=https://docs.python.org/3.8/library/stdtypes.html#list title=builtins.list><span class=n>subjects</span></a> <span class=o>=</span> <span class=p>[</span><span class=sa>f</span><span class=s1>'S</span><span class=si>{</span><span class=n>i</span><span class=si>:</span><span class=s1>02d</span><span class=si>}</span><span class=s1>'</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <a class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"href=https://docs.python.org/3.8/library/functions.html#int title=builtins.int><span class=n>n_subjects</span></a> <span class=o>+</span> <span class=mi>1</span><span class=p>)]</span>
</pre></div></div><p>We then assemble those into design matrices</p><div class="highlight-default notranslate"><div class=highlight><pre><span></span><a class="sphx-glr-backref-module-pandas-core-frame sphx-glr-backref-type-py-class sphx-glr-backref-instance"href=https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html#pandas.DataFrame title=pandas.core.frame.DataFrame><span class=n>unpaired_design_matrix</span></a> <span class=o>=</span> <a class="sphx-glr-backref-module-pandas-core-frame sphx-glr-backref-type-py-class"href=https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html#pandas.DataFrame title=pandas.core.frame.DataFrame><span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span></a><span class=p>(</span>
    <a class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"href=https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray title=numpy.ndarray><span class=n>condition_effect</span></a><span class=p>[:,</span> <a class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-data"href=https://numpy.org/doc/stable/reference/constants.html#numpy.newaxis title=numpy.newaxis><span class=n>np</span><span class=o>.</span><span class=n>newaxis</span></a><span class=p>],</span>
    <span class=n>columns</span><span class=o>=</span><span class=p>[</span><span class=s1>'vertical vs horizontal'</span><span class=p>])</span>

<a class="sphx-glr-backref-module-pandas-core-frame sphx-glr-backref-type-py-class sphx-glr-backref-instance"href=https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html#pandas.DataFrame title=pandas.core.frame.DataFrame><span class=n>paired_design_matrix</span></a> <span class=o>=</span> <a class="sphx-glr-backref-module-pandas-core-frame sphx-glr-backref-type-py-class"href=https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html#pandas.DataFrame title=pandas.core.frame.DataFrame><span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span></a><span class=p>(</span>
    <a class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"href=https://numpy.org/doc/stable/reference/generated/numpy.hstack.html#numpy.hstack title=numpy.hstack><span class=n>np</span><span class=o>.</span><span class=n>hstack</span></a><span class=p>((</span><a class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"href=https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray title=numpy.ndarray><span class=n>condition_effect</span></a><span class=p>[:,</span> <a class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-data"href=https://numpy.org/doc/stable/reference/constants.html#numpy.newaxis title=numpy.newaxis><span class=n>np</span><span class=o>.</span><span class=n>newaxis</span></a><span class=p>],</span> <a class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"href=https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray title=numpy.ndarray><span class=n>subject_effect</span></a><span class=p>)),</span>
    <span class=n>columns</span><span class=o>=</span><span class=p>[</span><span class=s1>'vertical vs horizontal'</span><span class=p>]</span> <span class=o>+</span> <a class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"href=https://docs.python.org/3.8/library/stdtypes.html#list title=builtins.list><span class=n>subjects</span></a><span class=p>)</span>
</pre></div></div><p>and plot the designs.</p><div class="highlight-default notranslate"><div class=highlight><pre><span></span><span class=kn>from</span> <span class=nn>nilearn.plotting</span> <span class=kn>import</span> <a class="sphx-glr-backref-module-nilearn-plotting sphx-glr-backref-type-py-function"href=../../modules/generated/nilearn.plotting.plot_design_matrix.html#nilearn.plotting.plot_design_matrix title=nilearn.plotting.plot_design_matrix><span class=n>plot_design_matrix</span></a>
<a class="sphx-glr-backref-module-matplotlib-figure sphx-glr-backref-type-py-class sphx-glr-backref-instance"href=https://matplotlib.org/stable/api/figure_api.html#matplotlib.figure.Figure title=matplotlib.figure.Figure><span class=n>_</span></a><span class=p>,</span> <span class=p>(</span><span class=n>ax_unpaired</span><span class=p>,</span> <span class=n>ax_paired</span><span class=p>)</span> <span class=o>=</span> <a class="sphx-glr-backref-module-matplotlib-pyplot sphx-glr-backref-type-py-function"href=https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.subplots.html#matplotlib.pyplot.subplots title=matplotlib.pyplot.subplots><span class=n>plt</span><span class=o>.</span><span class=n>subplots</span></a><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=mi>2</span><span class=p>,</span> <span class=n>gridspec_kw</span><span class=o>=</span><span class=p>{</span><span class=s1>'width_ratios'</span><span class=p>:</span> <span class=p>[</span><span class=mi>1</span><span class=p>,</span> <span class=mi>17</span><span class=p>]})</span>
<a class="sphx-glr-backref-module-nilearn-plotting sphx-glr-backref-type-py-function"href=../../modules/generated/nilearn.plotting.plot_design_matrix.html#nilearn.plotting.plot_design_matrix title=nilearn.plotting.plot_design_matrix><span class=n>plot_design_matrix</span></a><span class=p>(</span><a class="sphx-glr-backref-module-pandas-core-frame sphx-glr-backref-type-py-class sphx-glr-backref-instance"href=https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html#pandas.DataFrame title=pandas.core.frame.DataFrame><span class=n>unpaired_design_matrix</span></a><span class=p>,</span> <span class=n>rescale</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>ax</span><span class=o>=</span><span class=n>ax_unpaired</span><span class=p>)</span>
<a class="sphx-glr-backref-module-nilearn-plotting sphx-glr-backref-type-py-function"href=../../modules/generated/nilearn.plotting.plot_design_matrix.html#nilearn.plotting.plot_design_matrix title=nilearn.plotting.plot_design_matrix><span class=n>plot_design_matrix</span></a><span class=p>(</span><a class="sphx-glr-backref-module-pandas-core-frame sphx-glr-backref-type-py-class sphx-glr-backref-instance"href=https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html#pandas.DataFrame title=pandas.core.frame.DataFrame><span class=n>paired_design_matrix</span></a><span class=p>,</span> <span class=n>rescale</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>ax</span><span class=o>=</span><span class=n>ax_paired</span><span class=p>)</span>
<a class="sphx-glr-backref-module-matplotlib-axes sphx-glr-backref-type-py-method"href=https://matplotlib.org/stable/api/_as_gen/matplotlib.axes.Axes.set_title.html#matplotlib.axes.Axes.set_title title=matplotlib.axes.Axes.set_title><span class=n>ax_unpaired</span><span class=o>.</span><span class=n>set_title</span></a><span class=p>(</span><span class=s1>'unpaired design'</span><span class=p>,</span> <span class=n>fontsize</span><span class=o>=</span><span class=mi>12</span><span class=p>)</span>
<a class="sphx-glr-backref-module-matplotlib-axes sphx-glr-backref-type-py-method"href=https://matplotlib.org/stable/api/_as_gen/matplotlib.axes.Axes.set_title.html#matplotlib.axes.Axes.set_title title=matplotlib.axes.Axes.set_title><span class=n>ax_paired</span><span class=o>.</span><span class=n>set_title</span></a><span class=p>(</span><span class=s1>'paired design'</span><span class=p>,</span> <span class=n>fontsize</span><span class=o>=</span><span class=mi>12</span><span class=p>)</span>
<a class="sphx-glr-backref-module-matplotlib-pyplot sphx-glr-backref-type-py-function"href=https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.tight_layout.html#matplotlib.pyplot.tight_layout title=matplotlib.pyplot.tight_layout><span class=n>plt</span><span class=o>.</span><span class=n>tight_layout</span></a><span class=p>()</span>
<a class="sphx-glr-backref-module-nilearn-plotting sphx-glr-backref-type-py-function"href=../../modules/generated/nilearn.plotting.show.html#nilearn.plotting.show title=nilearn.plotting.show><span class=n>plotting</span><span class=o>.</span><span class=n>show</span></a><span class=p>()</span>
</pre></div></div><img alt="unpaired design, paired design"class=sphx-glr-single-img src=../../_images/sphx_glr_plot_second_level_two_sample_test_001.png srcset=../../_images/sphx_glr_plot_second_level_two_sample_test_001.png><p>We specify the analysis models and fit them.</p><div class="highlight-default notranslate"><div class=highlight><pre><span></span><span class=kn>from</span> <span class=nn>nilearn.glm.second_level</span> <span class=kn>import</span> <a class="sphx-glr-backref-module-nilearn-glm-second_level sphx-glr-backref-type-py-class"href=../../modules/generated/nilearn.glm.second_level.SecondLevelModel.html#nilearn.glm.second_level.SecondLevelModel title=nilearn.glm.second_level.SecondLevelModel><span class=n>SecondLevelModel</span></a>

<a class="sphx-glr-backref-module-nilearn-glm-second_level sphx-glr-backref-type-py-class sphx-glr-backref-instance"href=../../modules/generated/nilearn.glm.second_level.SecondLevelModel.html#nilearn.glm.second_level.SecondLevelModel title=nilearn.glm.second_level.SecondLevelModel><span class=n>second_level_model_unpaired</span></a> <span class=o>=</span> <a class="sphx-glr-backref-module-nilearn-glm-second_level sphx-glr-backref-type-py-class"href=../../modules/generated/nilearn.glm.second_level.SecondLevelModel.html#nilearn.glm.second_level.SecondLevelModel title=nilearn.glm.second_level.SecondLevelModel><span class=n>SecondLevelModel</span></a><span class=p>()</span><span class=o>.</span><span class=n>fit</span><span class=p>(</span>
    <a class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"href=https://docs.python.org/3.8/library/stdtypes.html#list title=builtins.list><span class=n>second_level_input</span></a><span class=p>,</span> <span class=n>design_matrix</span><span class=o>=</span><a class="sphx-glr-backref-module-pandas-core-frame sphx-glr-backref-type-py-class sphx-glr-backref-instance"href=https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html#pandas.DataFrame title=pandas.core.frame.DataFrame><span class=n>unpaired_design_matrix</span></a><span class=p>)</span>

<a class="sphx-glr-backref-module-nilearn-glm-second_level sphx-glr-backref-type-py-class sphx-glr-backref-instance"href=../../modules/generated/nilearn.glm.second_level.SecondLevelModel.html#nilearn.glm.second_level.SecondLevelModel title=nilearn.glm.second_level.SecondLevelModel><span class=n>second_level_model_paired</span></a> <span class=o>=</span> <a class="sphx-glr-backref-module-nilearn-glm-second_level sphx-glr-backref-type-py-class"href=../../modules/generated/nilearn.glm.second_level.SecondLevelModel.html#nilearn.glm.second_level.SecondLevelModel title=nilearn.glm.second_level.SecondLevelModel><span class=n>SecondLevelModel</span></a><span class=p>()</span><span class=o>.</span><span class=n>fit</span><span class=p>(</span>
    <a class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"href=https://docs.python.org/3.8/library/stdtypes.html#list title=builtins.list><span class=n>second_level_input</span></a><span class=p>,</span> <span class=n>design_matrix</span><span class=o>=</span><a class="sphx-glr-backref-module-pandas-core-frame sphx-glr-backref-type-py-class sphx-glr-backref-instance"href=https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html#pandas.DataFrame title=pandas.core.frame.DataFrame><span class=n>paired_design_matrix</span></a><span class=p>)</span>
</pre></div></div><p>Estimating the contrast is simple. To do so, we provide the column name of the design matrix. The argument ‘output_type’ is set to return all available outputs so that we can compare differences in the effect size, variance, and z-score.</p><div class="highlight-default notranslate"><div class=highlight><pre><span></span><a class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"href=https://docs.python.org/3.8/library/stdtypes.html#dict title=builtins.dict><span class=n>stat_maps_unpaired</span></a> <span class=o>=</span> <a class="sphx-glr-backref-module-nilearn-glm-second_level sphx-glr-backref-type-py-method"href=../../modules/generated/nilearn.glm.second_level.SecondLevelModel.html#nilearn.glm.second_level.SecondLevelModel.compute_contrast title=nilearn.glm.second_level.SecondLevelModel.compute_contrast><span class=n>second_level_model_unpaired</span><span class=o>.</span><span class=n>compute_contrast</span></a><span class=p>(</span>
                                                    <span class=s1>'vertical vs horizontal'</span><span class=p>,</span>
                                                    <span class=n>output_type</span><span class=o>=</span><span class=s1>'all'</span><span class=p>)</span>

<a class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"href=https://docs.python.org/3.8/library/stdtypes.html#dict title=builtins.dict><span class=n>stat_maps_paired</span></a> <span class=o>=</span> <a class="sphx-glr-backref-module-nilearn-glm-second_level sphx-glr-backref-type-py-method"href=../../modules/generated/nilearn.glm.second_level.SecondLevelModel.html#nilearn.glm.second_level.SecondLevelModel.compute_contrast title=nilearn.glm.second_level.SecondLevelModel.compute_contrast><span class=n>second_level_model_paired</span><span class=o>.</span><span class=n>compute_contrast</span></a><span class=p>(</span>
                                                <span class=s1>'vertical vs horizontal'</span><span class=p>,</span>
                                                <span class=n>output_type</span><span class=o>=</span><span class=s1>'all'</span><span class=p>)</span>
</pre></div></div></div><div class=section id=plot-the-results><h2><span class=section-number>9.6.5.3. </span>Plot the results<a title="Permalink to this headline"class=headerlink href=#plot-the-results>¶</a></h2><p>The two effect_size images are essentially identical</p><div class="highlight-default notranslate"><div class=highlight><pre><span></span><span class=p>(</span><a class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"href=https://docs.python.org/3.8/library/stdtypes.html#dict title=builtins.dict><span class=n>stat_maps_unpaired</span></a><span class=p>[</span><span class=s1>'effect_size'</span><span class=p>]</span><span class=o>.</span><span class=n>get_fdata</span><span class=p>()</span>
    <span class=o>-</span> <a class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"href=https://docs.python.org/3.8/library/stdtypes.html#dict title=builtins.dict><span class=n>stat_maps_paired</span></a><span class=p>[</span><span class=s1>'effect_size'</span><span class=p>]</span><span class=o>.</span><span class=n>get_fdata</span><span class=p>())</span><span class=o>.</span><span class=n>max</span><span class=p>()</span>
</pre></div></div><p class=sphx-glr-script-out>Out:</p><div class="sphx-glr-script-out highlight-none notranslate"><div class=highlight><pre><span></span>8.881784197001252e-16
</pre></div></div><p>But the variance in the unpaired image is larger.</p><div class="highlight-default notranslate"><div class=highlight><pre><span></span><a class="sphx-glr-backref-module-nilearn-plotting sphx-glr-backref-type-py-function"href=../../modules/generated/nilearn.plotting.plot_glass_brain.html#nilearn.plotting.plot_glass_brain title=nilearn.plotting.plot_glass_brain><span class=n>plotting</span><span class=o>.</span><span class=n>plot_glass_brain</span></a><span class=p>(</span>
    <a class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"href=https://docs.python.org/3.8/library/stdtypes.html#dict title=builtins.dict><span class=n>stat_maps_unpaired</span></a><span class=p>[</span><span class=s1>'effect_variance'</span><span class=p>],</span> <span class=n>colorbar</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>vmin</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span> <span class=n>vmax</span><span class=o>=</span><span class=mi>6</span><span class=p>,</span>
    <span class=n>title</span><span class=o>=</span><span class=s1>'vertical vs horizontal effect variance, unpaired'</span><span class=p>)</span>

<a class="sphx-glr-backref-module-nilearn-plotting sphx-glr-backref-type-py-function"href=../../modules/generated/nilearn.plotting.plot_glass_brain.html#nilearn.plotting.plot_glass_brain title=nilearn.plotting.plot_glass_brain><span class=n>plotting</span><span class=o>.</span><span class=n>plot_glass_brain</span></a><span class=p>(</span>
    <a class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"href=https://docs.python.org/3.8/library/stdtypes.html#dict title=builtins.dict><span class=n>stat_maps_paired</span></a><span class=p>[</span><span class=s1>'effect_variance'</span><span class=p>],</span> <span class=n>colorbar</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>vmin</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span> <span class=n>vmax</span><span class=o>=</span><span class=mi>6</span><span class=p>,</span>
    <span class=n>title</span><span class=o>=</span><span class=s1>'vertical vs horizontal effect variance, paired'</span><span class=p>)</span>

<a class="sphx-glr-backref-module-nilearn-plotting sphx-glr-backref-type-py-function"href=../../modules/generated/nilearn.plotting.show.html#nilearn.plotting.show title=nilearn.plotting.show><span class=n>plotting</span><span class=o>.</span><span class=n>show</span></a><span class=p>()</span>
</pre></div></div><ul class=sphx-glr-horizontal><li><img alt="plot second level two sample test"class=sphx-glr-multi-img src=../../_images/sphx_glr_plot_second_level_two_sample_test_002.png srcset=../../_images/sphx_glr_plot_second_level_two_sample_test_002.png></li><li><img alt="plot second level two sample test"class=sphx-glr-multi-img src=../../_images/sphx_glr_plot_second_level_two_sample_test_003.png srcset=../../_images/sphx_glr_plot_second_level_two_sample_test_003.png></li></ul><p>Together, this makes the z_scores from the paired test larger. We threshold the second level contrast and plot it.</p><div class="highlight-default notranslate"><div class=highlight><pre><span></span><a class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"href=https://docs.python.org/3.8/library/functions.html#float title=builtins.float><span class=n>threshold</span></a> <span class=o>=</span> <span class=mf>3.1</span>  <span class=c1># corresponds to  p < .001, uncorrected</span>
<a class="sphx-glr-backref-module-nilearn-plotting-displays sphx-glr-backref-type-py-class sphx-glr-backref-instance"href=../../modules/generated/nilearn.plotting.displays.OrthoProjector.html#nilearn.plotting.displays.OrthoProjector title=nilearn.plotting.displays.OrthoProjector><span class=n>display</span></a> <span class=o>=</span> <a class="sphx-glr-backref-module-nilearn-plotting sphx-glr-backref-type-py-function"href=../../modules/generated/nilearn.plotting.plot_glass_brain.html#nilearn.plotting.plot_glass_brain title=nilearn.plotting.plot_glass_brain><span class=n>plotting</span><span class=o>.</span><span class=n>plot_glass_brain</span></a><span class=p>(</span>
    <a class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"href=https://docs.python.org/3.8/library/stdtypes.html#dict title=builtins.dict><span class=n>stat_maps_unpaired</span></a><span class=p>[</span><span class=s1>'z_score'</span><span class=p>],</span> <a class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"href=https://docs.python.org/3.8/library/functions.html#float title=builtins.float><span class=n>threshold</span></a><span class=o>=</span><a class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"href=https://docs.python.org/3.8/library/functions.html#float title=builtins.float><span class=n>threshold</span></a><span class=p>,</span> <span class=n>colorbar</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>plot_abs</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span>
    <span class=n>title</span><span class=o>=</span><span class=s1>'vertical vs horizontal (unc p&LT0.001)'</span><span class=p>,</span> <span class=n>vmin</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span> <span class=n>vmax</span><span class=o>=</span><span class=mi>6</span><span class=p>)</span>

<a class="sphx-glr-backref-module-nilearn-plotting-displays sphx-glr-backref-type-py-class sphx-glr-backref-instance"href=../../modules/generated/nilearn.plotting.displays.OrthoProjector.html#nilearn.plotting.displays.OrthoProjector title=nilearn.plotting.displays.OrthoProjector><span class=n>display</span></a> <span class=o>=</span> <a class="sphx-glr-backref-module-nilearn-plotting sphx-glr-backref-type-py-function"href=../../modules/generated/nilearn.plotting.plot_glass_brain.html#nilearn.plotting.plot_glass_brain title=nilearn.plotting.plot_glass_brain><span class=n>plotting</span><span class=o>.</span><span class=n>plot_glass_brain</span></a><span class=p>(</span>
    <a class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"href=https://docs.python.org/3.8/library/stdtypes.html#dict title=builtins.dict><span class=n>stat_maps_paired</span></a><span class=p>[</span><span class=s1>'z_score'</span><span class=p>],</span> <a class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"href=https://docs.python.org/3.8/library/functions.html#float title=builtins.float><span class=n>threshold</span></a><span class=o>=</span><a class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"href=https://docs.python.org/3.8/library/functions.html#float title=builtins.float><span class=n>threshold</span></a><span class=p>,</span> <span class=n>colorbar</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>plot_abs</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span>
    <span class=n>title</span><span class=o>=</span><span class=s1>'vertical vs horizontal (unc p&LT0.001)'</span><span class=p>,</span> <span class=n>vmin</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span> <span class=n>vmax</span><span class=o>=</span><span class=mi>6</span><span class=p>)</span>

<a class="sphx-glr-backref-module-nilearn-plotting sphx-glr-backref-type-py-function"href=../../modules/generated/nilearn.plotting.show.html#nilearn.plotting.show title=nilearn.plotting.show><span class=n>plotting</span><span class=o>.</span><span class=n>show</span></a><span class=p>()</span>
</pre></div></div><ul class=sphx-glr-horizontal><li><img alt="plot second level two sample test"class=sphx-glr-multi-img src=../../_images/sphx_glr_plot_second_level_two_sample_test_004.png srcset=../../_images/sphx_glr_plot_second_level_two_sample_test_004.png></li><li><img alt="plot second level two sample test"class=sphx-glr-multi-img src=../../_images/sphx_glr_plot_second_level_two_sample_test_005.png srcset=../../_images/sphx_glr_plot_second_level_two_sample_test_005.png></li></ul><p>Unsurprisingly, we see activity in the primary visual cortex, both positive and negative.</p><p class=sphx-glr-timing><strong>Total running time of the script:</strong> ( 0 minutes 31.403 seconds)</p><p><strong>Estimated memory usage:</strong> 17 MB</p><div class="sphx-glr-footer class sphx-glr-footer-example docutils container"id=sphx-glr-download-auto-examples-05-glm-second-level-plot-second-level-two-sample-test-py><div class="binder-badge docutils container"><a class="reference external image-reference"href=https://mybinder.org/v2/gh/nilearn/nilearn.github.io/main?filepath=examples/auto_examples/05_glm_second_level/plot_second_level_two_sample_test.ipynb><img alt="Launch binder"src=../../_images/binder_badge_logo4.svg width=150px></a></div><div class="sphx-glr-download sphx-glr-download-python docutils container"><p><a class="reference download internal"download href=../../_downloads/3872fa66ed1a1aa26a7d894ad8d9822f/plot_second_level_two_sample_test.py><code class="xref download docutils literal notranslate"><span class=pre>Download</span> <span class=pre>Python</span> <span class=pre>source</span> <span class=pre>code:</span> <span class=pre>plot_second_level_two_sample_test.py</span></code></a></p></div><div class="sphx-glr-download sphx-glr-download-jupyter docutils container"><p><a class="reference download internal"download href=../../_downloads/12cc2d26d59ec4b13cb8816906c03e68/plot_second_level_two_sample_test.ipynb><code class="xref download docutils literal notranslate"><span class=pre>Download</span> <span class=pre>Jupyter</span> <span class=pre>notebook:</span> <span class=pre>plot_second_level_two_sample_test.ipynb</span></code></a></p></div></div><p class=sphx-glr-signature><a class="reference external"href=https://sphinx-gallery.github.io>Gallery generated by Sphinx-Gallery</a></p></div></div><div class=clearer></div></div></div></div><div aria-label="main navigation"class=sphinxsidebar role=navigation><div class=sphinxsidebarwrapper><h4>Giving credit</h4><ul class=simple><li><p>Please consider <a href=../../authors.html#citing>citing the papers</a>.</p></li></ul><h3><a href=../../index.html>Table of Contents</a></h3><ul><li><a class="reference internal"href=#>9.6.5. Second-level fMRI model: two-sample test, unpaired and paired</a><ul><li><a class="reference internal"href=#fetch-dataset>9.6.5.1. Fetch dataset</a></li><li><a class="reference internal"href=#estimate-second-level-models>9.6.5.2. Estimate second level models</a></li><li><a class="reference internal"href=#plot-the-results>9.6.5.3. Plot the results</a></li></ul></li></ul><h4>Previous topic</h4><p class=topless><a title="previous chapter"href=plot_oasis.html><span class=section-number>9.6.4. </span>Voxel-Based Morphometry on Oasis dataset</a></p><h4>Next topic</h4><p class=topless><a title="next chapter"href=plot_second_level_one_sample_test.html><span class=section-number>9.6.6. </span>Second-level fMRI model: one sample test</a></p><div id=searchbox role=search style=display:none><h3 id=searchlabel>Quick search</h3><div class=searchformwrapper><form action=../../search.html class=search><input aria-labelledby=searchlabel name=q><input type=submit value=Go></form></div></div><script>$('#searchbox').show(0);</script></div></div><div class=clearer></div></div><div class=footer>© The nilearn developers 2010-2022. Created using <a href=http://sphinx.pocoo.org/>Sphinx</a> 4.0.2. <span style=padding-left:5ex> <a href=../../_sources/auto_examples/05_glm_second_level/plot_second_level_two_sample_test.rst.txt rel=nofollow>Show this page source</a> </span></div></body></html>