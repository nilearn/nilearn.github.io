


<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>NiLearn: Machine learning for NeuroImaging in Python &mdash; Machine learning for NeuroImaging</title>
    
    <link rel="stylesheet" href="../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.1a',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="top" title="Machine learning for NeuroImaging" href="../index.html" />
<meta content="True" name="HandheldFriendly">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0;">
<meta name="keywords" content="nilearn, neuroimaging, python, neuroscience, machinelearning">

<script type="text/javascript">

        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-41920728-1']);
        _gaq.push(['_trackPageview']);

        (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
    </script>

  </head>
  <body>
<div id="logo-banner">
  <div class="logo">
    <a href="../index.html">
      <img src="../_static/nilearn-logo.png" alt="NiLearn logo"  border="0" />
    </a>
  </div>
  <div class="banner">
    <h1>NiLearn:</h1>
    <h2>Machine learning for Neuro-Imaging in Python</h2>
  </div>
  <div class="search_form">
    <div id="cse" style="width: 100%;"></div>
    <script src="http://www.google.com/jsapi" type="text/javascript"></script>
    <script type="text/javascript">
      google.load('search', '1', {language : 'en'});
      google.setOnLoadCallback(function() {
      var customSearchControl = new google.search.CustomSearchControl('014136483057745874622:r-npolb1uki');
      customSearchControl.setResultSetSize(google.search.Search.FILTERED_CSE_RESULTSET);
      var options = new google.search.DrawOptions();
      options.setAutoComplete(true);
      customSearchControl.draw('cse', options);
      }, true);
    </script>
  </div>
</div>



    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../np-modindex.html" title="Python Module Index"
             >modules</a></li>
<li><a href="../index.html">NiLearn Home</a> |&nbsp;</li>
<li><a href="../user_guide.html">User Guide</a> |&nbsp;</li>
<li><a href="../auto_examples/index.html">Examples</a> |&nbsp;</li>
<li><a href="../modules/reference.html">Reference</a> |&nbsp;</li>
<li id="navbar-about"><a href="../AUTHORS.html">About</a>|&nbsp;</li>
<li id="navbar-ecosystem"><a href="http://www.nipy.org/">Nipy ecosystem</a></li>
 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">


<h4> Giving credit </h4>
  <ul class="simple">
    <li><p>Please consider <a href="../AUTHORS.html#citing">citing the
                    scikit-learn</a> if you use it.</p></li>
  </ul>

  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">3.1. Introduction to the neuroimaging machine-learning pipeline</a><ul>
<li><a class="reference internal" href="#data-loading-and-preprocessing">3.1.1. Data loading and preprocessing</a><ul>
<li><a class="reference internal" href="#downloading-the-data">3.1.1.1. Downloading the data</a></li>
<li><a class="reference internal" href="#loading-non-image-data-experiment-description">3.1.1.2. Loading non image data: experiment description</a></li>
<li><a class="reference internal" href="#masking-the-data-from-4d-image-to-2d-array">3.1.1.3. Masking the data: from 4D image to 2D array</a><ul>
<li><a class="reference internal" href="#applying-a-mask">3.1.1.3.1. Applying a mask</a></li>
<li><a class="reference internal" href="#automatically-computing-a-mask">3.1.1.3.2. Automatically computing a mask</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#applying-a-scikit-learn-machine-learning-method">3.1.2. Applying a scikit-learn machine learning method</a></li>
<li><a class="reference internal" href="#unmasking-inverse-transform">3.1.3. Unmasking (inverse_transform)</a></li>
<li><a class="reference internal" href="#visualizing-results">3.1.4. Visualizing results</a></li>
<li><a class="reference internal" href="#going-further">3.1.5. Going further</a></li>
</ul>
</li>
</ul>


<div class="navbar">
</div> <!-- end navbar -->

<script type="text/javascript">$('#searchbox-ml').show(0);</script>
<script type="text/javascript">$('#searchbox-site').show(0);</script>


        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="introduction-to-the-neuroimaging-machine-learning-pipeline">
<span id="getting-started"></span><h1>3.1. Introduction to the neuroimaging machine-learning pipeline<a class="headerlink" href="#introduction-to-the-neuroimaging-machine-learning-pipeline" title="Permalink to this headline">¶</a></h1>
<p>Nilearn comes with code to simplify the use of scikit-learn when dealing
with neuroimaging data. For the moment, Nilearn is focused on functional MRI
data.</p>
<p>Before using a machine learning tool, we may need to apply the following
steps:</p>
<blockquote>
<div><ol class="arabic simple">
<li><a class="reference internal" href="#data-loading"><em>Data loading and preprocessing</em></a> : load Nifti files and check consistency of data</li>
<li><a class="reference internal" href="#masking"><em>Masking data</em></a> : if a mask is not provided, one is
computed automatically</li>
<li><a class="reference internal" href="data_preparation.html#resampling"><em>Resampling</em></a>: optionally data could be resampled to a
different resolution</li>
<li><a class="reference internal" href="data_preparation.html#temporal-filtering"><em>Temporal Filtering</em></a>: detrending, regressing out confounds,
normalization</li>
</ol>
</div></blockquote>
<div class="section" id="data-loading-and-preprocessing">
<span id="data-loading"></span><h2>3.1.1. Data loading and preprocessing<a class="headerlink" href="#data-loading-and-preprocessing" title="Permalink to this headline">¶</a></h2>
<div class="section" id="downloading-the-data">
<h3>3.1.1.1. Downloading the data<a class="headerlink" href="#downloading-the-data" title="Permalink to this headline">¶</a></h3>
<p>To run demos, data are retrieved using a function provided by Nilearn
which downloads a dataset and returns a bunch of paths to the dataset
files (more details in <a class="reference internal" href="manipulating_mr_images.html#downloading-data"><em>Downloading example datasets</em></a>). We can then proceed
loading them as if they were just any other files on our disk. For
example, we can download the data from the
<a class="reference external" href="http://dx.doi.org/10.1126/science.1063736">Haxby 2001 paper</a></p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">nilearn</span> <span class="kn">import</span> <span class="n">datasets</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dataset</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">fetch_haxby</span><span class="p">()</span>
</pre></div>
</div>
<p><cite>dataset.func</cite> contains filenames referring to dataset files on the disk:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">dataset</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<span class="go">[&#39;mask_house_little&#39;, &#39;anat&#39;, &#39;mask_house&#39;, &#39;mask_face&#39;, &#39;func&#39;, &#39;session_target&#39;, &#39;mask_vt&#39;, &#39;mask_face_little&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dataset</span><span class="o">.</span><span class="n">func</span> 
<span class="go">[&#39;.../haxby2001/subj1/bold.nii.gz&#39;]</span>
</pre></div>
</div>
</div>
<div class="section" id="loading-non-image-data-experiment-description">
<h3>3.1.1.2. Loading non image data: experiment description<a class="headerlink" href="#loading-non-image-data-experiment-description" title="Permalink to this headline">¶</a></h3>
<p>An experiment may need additional information about subjects, sessions or
experiments. In the Haxby experiment, fMRI data are acquired while
presenting different category of pictures to the subject (face, house...)
and the goal of this experiment is to predict which category is presented
to the subjects from the brain activation.</p>
<p>These conditions are presented as string into a CSV file. The numpy function
<cite>loadtxt</cite> is very useful to load this kind of data.</p>
<p>For example, we will now remove the <em>rest</em> condition from our dataset.
This can be done as follows:</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you are not comfortable with this kind of data processing, do not
worry: there are plenty of examples in Nilearn that allows you to easily
load data from provided datasets. Do not hesitate to copy/paste the
code and adapt it to your own data format if needed. More information
can be found in the <a class="reference internal" href="manipulating_mr_images.html#data-manipulation"><em>data manipulation</em></a>
section.</p>
</div>
</div>
<div class="section" id="masking-the-data-from-4d-image-to-2d-array">
<span id="masking"></span><h3>3.1.1.3. Masking the data: from 4D image to 2D array<a class="headerlink" href="#masking-the-data-from-4d-image-to-2d-array" title="Permalink to this headline">¶</a></h3>
<p>While functional neuroimaging data consist in 4D images, positioned in a
coordinate space (which we will call <a class="reference internal" href="manipulating_mr_images.html#niimg"><em>Niimgs</em></a>). For use with
the scikit-learn, they need to be converted into 2D arrays of
samples and features.</p>
<p class="centered">
<strong><a class="reference internal image-reference" href="building_blocks/images/niimgs.jpg"><img alt="niimgs" src="building_blocks/images/niimgs.jpg" /></a>
  <span style="padding: .5em; font-size: 400%">&rarr;</span>  <a class="reference internal image-reference" href="building_blocks/images/feature_array.jpg"><img alt="arrays" src="building_blocks/images/feature_array.jpg" /></a>
</strong></p><p>We use masking to convert 4D data (i.e. 3D volume over time) into 2D data
(i.e. voxels over time). For this purpose, we use the
<a class="reference internal" href="../modules/generated/nilearn.input_data.NiftiMasker.html#nilearn.input_data.NiftiMasker" title="nilearn.input_data.NiftiMasker"><tt class="xref py py-class docutils literal"><span class="pre">NiftiMasker</span></tt></a> object, a very powerful data loading tool.</p>
<div class="section" id="applying-a-mask">
<h4>3.1.1.3.1. Applying a mask<a class="headerlink" href="#applying-a-mask" title="Permalink to this headline">¶</a></h4>
<div class="figure align-right">
<a class="reference external image-reference" href="auto_examples/plot_haxby_simple.html"><img alt="building_blocks/auto_examples/images/plot_haxby_simple_2.png" src="building_blocks/auto_examples/images/plot_haxby_simple_2.png" /></a>
</div>
<p>If your dataset provides a mask, the <a class="reference internal" href="../modules/generated/nilearn.input_data.NiftiMasker.html#nilearn.input_data.NiftiMasker" title="nilearn.input_data.NiftiMasker"><tt class="xref py py-class docutils literal"><span class="pre">NiftiMasker</span></tt></a> can apply it
automatically. All you have to do is to pass your mask as a parameter when
creating your masker. Here we use the mask of the ventral stream,
provided with the Haxby dataset.</p>
<p>The <a class="reference internal" href="../modules/generated/nilearn.input_data.NiftiMasker.html#nilearn.input_data.NiftiMasker" title="nilearn.input_data.NiftiMasker"><tt class="xref py py-class docutils literal"><span class="pre">NiftiMasker</span></tt></a> can be seen as a <em>tube</em> that transforms data
from 4D images to 2D arrays, but first it needs to &#8216;fit&#8217; this data in
order to learn simple parameters from it, such as its shape:</p>
<p>Note that you can call <cite>nifti_masker.transform(dataset.func[1])</cite> on new
data to mask it in a similar way as the data that was used during the
fit.</p>
</div>
<div class="section" id="automatically-computing-a-mask">
<h4>3.1.1.3.2. Automatically computing a mask<a class="headerlink" href="#automatically-computing-a-mask" title="Permalink to this headline">¶</a></h4>
<p>If your dataset does not provide a mask, the Nifti masker will compute
one for you in the <cite>fit</cite> step. The generated mask can be accessed via the
<cite>mask_img_</cite> attribute.</p>
<p>Detailed information on automatic mask computation can be found in:
<a class="reference internal" href="data_preparation.html#extracting-data"><em>Data preparation: input/output and basic transformation</em></a>.</p>
</div>
</div>
</div>
<div class="section" id="applying-a-scikit-learn-machine-learning-method">
<h2>3.1.2. Applying a scikit-learn machine learning method<a class="headerlink" href="#applying-a-scikit-learn-machine-learning-method" title="Permalink to this headline">¶</a></h2>
<p>Now that we have a 2D array, we can apply any estimator from the
scikit-learn, using its <cite>fit</cite>, <cite>predict</cite> or <cite>transform</cite> methods.</p>
<p>Here, we use scikit-learn Support Vector Classification to learn how to
predict the category of picture seen by the subject:</p>
<p>We will not detail it here since there is a very good documentation about it in the
<a class="reference external" href="http://scikit-learn.org/stable/modules/svm.html#classification">scikit-learn documentation</a></p>
</div>
<div class="section" id="unmasking-inverse-transform">
<h2>3.1.3. Unmasking (inverse_transform)<a class="headerlink" href="#unmasking-inverse-transform" title="Permalink to this headline">¶</a></h2>
<p>Unmasking data is as easy as masking it! This can be done by using
method <cite>inverse_transform</cite> on your processed data. As you may want to
unmask several kinds of data (not only the data that you previously
masked but also the results of an algorithm), the masker is clever and
can take data of dimension 1D (resp. 2D) to convert it back to 3D
(resp. 4D).</p>
<p>Here we want to see the discriminating weights of some voxels.</p>
</div>
<div class="section" id="visualizing-results">
<h2>3.1.4. Visualizing results<a class="headerlink" href="#visualizing-results" title="Permalink to this headline">¶</a></h2>
<p>Again the visualization code is simple. We can use an fMRI slice as a
background and plot the weights. Brighter points have a higher
discriminating weight.</p>
<div class="figure align-center">
<a class="reference external image-reference" href="auto_examples/plot_haxby_simple.html"><img alt="building_blocks/auto_examples/images/plot_haxby_simple_1.png" src="building_blocks/auto_examples/images/plot_haxby_simple_1.png" /></a>
</div>
</div>
<div class="section" id="going-further">
<h2>3.1.5. Going further<a class="headerlink" href="#going-further" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference internal" href="../modules/generated/nilearn.input_data.NiftiMasker.html#nilearn.input_data.NiftiMasker" title="nilearn.input_data.NiftiMasker"><tt class="xref py py-class docutils literal"><span class="pre">NiftiMasker</span></tt></a> is a very powerful object and we have only
scratched the surface of its possibilities. It is described in more
details in the section <a class="reference internal" href="data_preparation.html#nifti-masker"><em>NiftiMasker: loading, masking and filtering</em></a>. Also, simple functions that
can be used to perform elementary operations such as masking or filtering
are described in <a class="reference internal" href="manipulating_mr_images.html#preprocessing-functions"><em>Preprocessing functions</em></a>.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../np-modindex.html" title="Python Module Index"
             >modules</a></li>
<li><a href="../index.html">NiLearn Home</a> |&nbsp;</li>
<li><a href="../user_guide.html">User Guide</a> |&nbsp;</li>
<li><a href="../auto_examples/index.html">Examples</a> |&nbsp;</li>
<li><a href="../modules/reference.html">Reference</a> |&nbsp;</li>
<li id="navbar-about"><a href="../AUTHORS.html">About</a>|&nbsp;</li>
<li id="navbar-ecosystem"><a href="http://www.nipy.org/">Nipy ecosystem</a></li>
 
      </ul>
    </div>
    <div class="footer">
            &copy; INRIA Parietal 2010-2013.
          Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
        <span style="padding-left: 5ex;">
          <a href="../_sources/building_blocks/pipeline_introduction.txt"
        	 rel="nofollow">Show this page source</a>
        </span>
    </div>
  </body>
</html>