<!doctypehtml><html lang=en><meta charset=utf-8><meta content=width=device-width,initial-scale=1.0 name=viewport><meta content="9.6.4. Voxel-Based Morphometry on Oasis dataset"property=og:title><meta content=website property=og:type><meta content=https://nilearn.github.io/auto_examples/05_glm_second_level/plot_oasis.html property=og:url><meta content=Nilearn property=og:site_name><meta content="This example uses Voxel-Based Morphometry (VBM) to study the relationship between aging, sex and gray matter density. The data come from the OASIS project. If you use it, you need to agree with the..."property=og:description><meta content=https://nilearn.github.io/_static/nilearn-logo.png property=og:image><meta content=Nilearn property=og:image:alt><title>Nilearn: Statistical Analysis for NeuroImaging in Python — Machine learning for NeuroImaging</title><link href=../../_static/pygments.css rel=stylesheet><link href=../../_static/nature.css rel=stylesheet><link href=../../_static/copybutton.css rel=stylesheet><link href=../../_static/sg_gallery.css rel=stylesheet><link href=../../_static/sg_gallery-binder.css rel=stylesheet><link href=../../_static/sg_gallery-dataframe.css rel=stylesheet><link href=../../_static/sg_gallery-rendered-html.css rel=stylesheet><script data-url_root=../../ id=documentation_options src=../../_static/documentation_options.js></script><script src=../../_static/jquery.js></script><script src=../../_static/underscore.js></script><script src=../../_static/doctools.js></script><script src=../../_static/clipboard.min.js></script><script src=../../_static/copybutton.js></script><link rel="shortcut icon"href=../../_static/favicon.ico><link href=../../search.html rel=search title=Search><link title="9.6.5. Second-level fMRI model: two-sample test, unpaired and paired"href=plot_second_level_two_sample_test.html rel=next><link title="9.6.3. Statistical testing of a second-level analysis"href=plot_thresholding.html rel=prev><meta content=True name=HandheldFriendly><meta content=width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0 name=viewport><meta content="nilearn, neuroimaging, python, neuroscience, machinelearning"name=keywords><script>function updateTopMenuPosition(height, width) {
    if($(window).scrollTop() > height && $(window).outerWidth() > 1024) {
        //begin to scroll
        $('.related-wrapper').css("z-index", 1000);
        $('.related-wrapper').css("position", "sticky");
        $('.related-wrapper').css("top", 0);
        $('.related-wrapper').css("width", width)
    } else {
        //lock it back into place
        $('.related-wrapper').css("position", "relative");
        $('.related-wrapper').css("top", 0)
    }
}

$(function() {
    var banner_height = $('#logo-banner').outerHeight();
    var banner_width = $('#logo-banner').outerWidth();
    var width = $('.related-wrapper').css("height", $('.related').outerHeight());

    updateTopMenuPosition(banner_height, width);

    $(window).scroll(function(event) {
        updateTopMenuPosition(banner_height, width)
    });

    $(window).resize(function(event) {
        var banner_width = $('#logo-banner').outerWidth();
        var menu_height = $('.related').outerHeight();
        $('.related').css("width", banner_width);
        $('.related-wrapper').css("height", menu_height);
        updateTopMenuPosition(banner_height, width)
    })
});</script><script>function updateSideBarPosition(top, offset, sections) {
    var pos = $(window).scrollTop();
    // Lock the table of content to a fixed position once we scroll enough
    var topShift = 2 * offset;
    if(pos > top + topShift + 1) {
        // begin to scroll with sticky menu bar
        var topShift = -topShift + 1;
        if ($(window).outerWidth() < 1024) {
            // compensate top menu that disappears
            topShift -= offset + 1
        }
        $('.sphinxsidebarwrapper').css("position", "fixed");
        $('.sphinxsidebarwrapper').css("top", topShift)
    }
    else {
        //lock it back into place
        $('.sphinxsidebarwrapper').css("position", "relative");
        $('.sphinxsidebarwrapper').css("top",0)
    }

    // Highlight the current section
    i = 0;
    current_section = 0;
    $('a.internal').removeClass('active');
    for(i in sections) {
        if(sections[i] > pos) {
            break
        }
        if($('a.internal[href$="' + i + '"]').is(':visible')){
            current_section = i
        }
    }
    $('a.internal[href$="' + current_section + '"]').addClass('active');
    $('a.internal[href$="' + current_section + '"]').parent().addClass('active')
}

$(function () {
    // Lock the table of content to a fixed position once we scroll enough
    var tocOffset = $('.related-wrapper').outerHeight();
    var marginTop = parseFloat($('.sphinxsidebarwrapper').css('margin-top').replace(/auto/, 0));
    var top = $('.sphinxsidebarwrapper').offset().top - marginTop;
    sections = {};
    url = document.URL.replace(/#.*$/, "");

    // Grab positions of our sections
    $('.headerlink').each(function(){
        sections[this.href.replace(url, '')] = $(this).offset().top - 50
    });

    updateSideBarPosition(top, tocOffset, sections);

    $(window).scroll(function(event) {
        updateSideBarPosition(top, tocOffset, sections)
    });

    $(window).resize(function(event) {
        tocOffset = $('.related-wrapper').outerHeight();
        updateSideBarPosition(top, tocOffset, sections)
    });
});</script><script>var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-41920728-1']);
        _gaq.push(['_trackPageview']);

        (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();</script><body><div id=logo-banner><div class=logo><a href=../../index.html> <img alt="Nilearn logo"border=0 src=../../_static/nilearn-logo.png> </a></div><div class=tags><ul><li><big><a href=../decoding/plot_haxby_anova_svm.html>SVM</a></big></li><li><small><a href=../../connectivity/parcellating.html>Ward clustering</a></small></li><li><a href=../../decoding/searchlight.html>Searchlight</a></li><li><big><a href=../../connectivity/resting_state_networks.html>ICA</a></big></li><li><a href=../../manipulating_images/data_preparation.html>Nifti IO</a></li><li><a href=../../modules/reference.html#module-nilearn.datasets>Datasets</a></li></ul></div><div class=banner><h1>Nilearn:</h1><h2>Statistics for NeuroImaging in Python</h2></div><div class=search_form><div class=gcse-search id=cse style=width:100%></div><script>(function() {
        var cx = '017289614950330089114:elrt9qoutrq';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();</script></div></div><div class=related-wrapper><div aria-label="related navigation"class=related role=navigation><h3>Navigation</h3><ul><li class=right style=margin-right:10px><a title="Python Module Index"href=../../py-modindex.html>modules</a></li><li class=right><a title="9.6.5. Second-level fMRI model: two-sample test, unpaired and paired"accesskey=N href=plot_second_level_two_sample_test.html>next</a> |</li><li class=right><a title="9.6.3. Statistical testing of a second-level analysis"accesskey=P href=plot_thresholding.html>previous</a> |</li><li><a href=../../index.html>Nilearn Home</a> | </li><li><a href=../../user_guide.html>User Guide</a> | </li><li><a href=../index.html>Examples</a> | </li><li><a href=../../modules/reference.html>Reference</a> | </li><li id=navbar-about><a href=../../authors.html>About</a>| </li><li><a href=../../glossary.html>Glossary</a>| </li><li><a href=../../bibliography.html>Bibliography</a>| </li><li id=navbar-ecosystem><a href=http://www.nipy.org/>Nipy ecosystem</a></li><li class="nav-item nav-item-1"><a href=../../user_guide.html>User guide: table of contents</a> »</li><li class="nav-item nav-item-2"><a accesskey=U href=../index.html><span class=section-number>9. </span>Nilearn usage examples</a> »</li><li class="nav-item nav-item-this"><a href>Nilearn: Statistical Analysis for NeuroImaging in Python</a></li></ul></div></div><div class=stable-banner>This is the <em>stable</em> documentation for the latest release of Nilearn, the current development version is available <a href=https://nilearn.github.io/dev/index.html>here</a>.</div><div class=document><div class=documentwrapper><div class=bodywrapper><div class=body role=main><div class="sphx-glr-download-link-note admonition note"><p class=admonition-title>Note</p><p>Click <a class="reference internal"href=#sphx-glr-download-auto-examples-05-glm-second-level-plot-oasis-py><span class="std std-ref">here</span></a> to download the full example code or to run this example in your browser via Binder</p></div><div class="sphx-glr-example-title section"id=voxel-based-morphometry-on-oasis-dataset><span id=sphx-glr-auto-examples-05-glm-second-level-plot-oasis-py></span><h1><span class=section-number>9.6.4. </span>Voxel-Based Morphometry on Oasis dataset<a title="Permalink to this headline"class=headerlink href=#voxel-based-morphometry-on-oasis-dataset>¶</a></h1><p>This example uses Voxel-Based Morphometry (VBM) to study the relationship between aging, sex and gray matter density.</p><p>The data come from the <a class="reference external"href=http://www.oasis-brains.org/>OASIS</a> project. If you use it, you need to agree with the data usage agreement available on the website.</p><p>It has been run through a standard VBM pipeline (using SPM8 and NewSegment) to create VBM maps, which we study here.</p><div class=section id=vbm-analysis-of-aging><h2><span class=section-number>9.6.4.1. </span>VBM analysis of aging<a title="Permalink to this headline"class=headerlink href=#vbm-analysis-of-aging>¶</a></h2><p>We run a standard GLM analysis to study the association between age and gray matter density from the VBM data. We use only 100 subjects from the OASIS dataset to limit the memory usage.</p><p>Note that more power would be obtained from using a larger sample of subjects.</p><div class="highlight-default notranslate"><div class=highlight><pre><span></span><span class=c1># Authors: Bertrand Thirion, &LTbertrand.thirion@inria.fr>, July 2018</span>
<span class=c1>#          Elvis Dhomatob, &LTelvis.dohmatob@inria.fr>, Apr. 2014</span>
<span class=c1>#          Virgile Fritsch, &LTvirgile.fritsch@inria.fr>, Apr 2014</span>
<span class=c1>#          Gael Varoquaux, Apr 2014</span>


<a class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"href=https://docs.python.org/3.8/library/functions.html#int title=builtins.int><span class=n>n_subjects</span></a> <span class=o>=</span> <span class=mi>100</span>  <span class=c1># more subjects requires more memory</span>
</pre></div></div></div><div class=section id=load-oasis-dataset><h2><span class=section-number>9.6.4.2. </span>Load Oasis dataset<a title="Permalink to this headline"class=headerlink href=#load-oasis-dataset>¶</a></h2><div class="highlight-default notranslate"><div class=highlight><pre><span></span><span class=kn>from</span> <span class=nn>nilearn</span> <span class=kn>import</span> <span class=n>datasets</span>
<a class="sphx-glr-backref-module-sklearn-utils sphx-glr-backref-type-py-function"href=https://scikit-learn.org/stable/modules/generated/sklearn.utils.Bunch.html#sklearn.utils.Bunch title=sklearn.utils.Bunch><span class=n>oasis_dataset</span></a> <span class=o>=</span> <a class="sphx-glr-backref-module-nilearn-datasets sphx-glr-backref-type-py-function"href=../../modules/generated/nilearn.datasets.fetch_oasis_vbm.html#nilearn.datasets.fetch_oasis_vbm title=nilearn.datasets.fetch_oasis_vbm><span class=n>datasets</span><span class=o>.</span><span class=n>fetch_oasis_vbm</span></a><span class=p>(</span>
    <a class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"href=https://docs.python.org/3.8/library/functions.html#int title=builtins.int><span class=n>n_subjects</span></a><span class=o>=</span><a class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"href=https://docs.python.org/3.8/library/functions.html#int title=builtins.int><span class=n>n_subjects</span></a><span class=p>,</span> <span class=n>legacy_format</span><span class=o>=</span><span class=kc>False</span>
<span class=p>)</span>
<a class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"href=https://docs.python.org/3.8/library/stdtypes.html#list title=builtins.list><span class=n>gray_matter_map_filenames</span></a> <span class=o>=</span> <a class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"href=https://docs.python.org/3.8/library/stdtypes.html#list title=builtins.list><span class=n>oasis_dataset</span><span class=o>.</span><span class=n>gray_matter_maps</span></a>
<a class="sphx-glr-backref-module-pandas-core-series sphx-glr-backref-type-py-class sphx-glr-backref-instance"href=https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.html#pandas.Series title=pandas.core.series.Series><span class=n>age</span></a> <span class=o>=</span> <a class="sphx-glr-backref-module-pandas-core-frame sphx-glr-backref-type-py-class sphx-glr-backref-instance"href=https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html#pandas.DataFrame title=pandas.core.frame.DataFrame><span class=n>oasis_dataset</span><span class=o>.</span><span class=n>ext_vars</span></a><span class=p>[</span><span class=s1>'age'</span><span class=p>]</span><span class=o>.</span><span class=n>astype</span><span class=p>(</span><span class=nb>float</span><span class=p>)</span>
</pre></div></div><p>Sex is encoded as ‘M’ or ‘F’. Hence, we make it a binary variable.</p><div class="highlight-default notranslate"><div class=highlight><pre><span></span><a class="sphx-glr-backref-module-pandas-core-series sphx-glr-backref-type-py-class sphx-glr-backref-instance"href=https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.html#pandas.Series title=pandas.core.series.Series><span class=n>sex</span></a> <span class=o>=</span> <a class="sphx-glr-backref-module-pandas-core-frame sphx-glr-backref-type-py-class sphx-glr-backref-instance"href=https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html#pandas.DataFrame title=pandas.core.frame.DataFrame><span class=n>oasis_dataset</span><span class=o>.</span><span class=n>ext_vars</span></a><span class=p>[</span><span class=s1>'mf'</span><span class=p>]</span> <span class=o>==</span> <span class=s1>'F'</span>
</pre></div></div><p>Print basic information on the dataset.</p><div class="highlight-default notranslate"><div class=highlight><pre><span></span><span class=nb>print</span><span class=p>(</span><span class=s1>'First gray-matter anatomy image (3D) is located at: </span><span class=si>%s</span><span class=s1>'</span> <span class=o>%</span>
      <a class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"href=https://docs.python.org/3.8/library/stdtypes.html#list title=builtins.list><span class=n>oasis_dataset</span><span class=o>.</span><span class=n>gray_matter_maps</span></a><span class=p>[</span><span class=mi>0</span><span class=p>])</span>  <span class=c1># 3D data</span>
<span class=nb>print</span><span class=p>(</span><span class=s1>'First white-matter anatomy image (3D) is located at: </span><span class=si>%s</span><span class=s1>'</span> <span class=o>%</span>
      <a class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"href=https://docs.python.org/3.8/library/stdtypes.html#list title=builtins.list><span class=n>oasis_dataset</span><span class=o>.</span><span class=n>white_matter_maps</span></a><span class=p>[</span><span class=mi>0</span><span class=p>])</span>  <span class=c1># 3D data</span>
</pre></div></div><p class=sphx-glr-script-out>Out:</p><div class="sphx-glr-script-out highlight-none notranslate"><div class=highlight><pre><span></span>First gray-matter anatomy image (3D) is located at: /home/nicolas/nilearn_data/oasis1/OAS1_0001_MR1/mwrc1OAS1_0001_MR1_mpr_anon_fslswapdim_bet.nii.gz
First white-matter anatomy image (3D) is located at: /home/nicolas/nilearn_data/oasis1/OAS1_0001_MR1/mwrc2OAS1_0001_MR1_mpr_anon_fslswapdim_bet.nii.gz
</pre></div></div><p>Get a mask image: A mask of the cortex of the ICBM template.</p><div class="highlight-default notranslate"><div class=highlight><pre><span></span><a class="sphx-glr-backref-module-nibabel-nifti1 sphx-glr-backref-type-py-class sphx-glr-backref-instance"href=https://nipy.org/nibabel/reference/nibabel.nifti1.html#nibabel.nifti1.Nifti1Image title=nibabel.nifti1.Nifti1Image><span class=n>gm_mask</span></a> <span class=o>=</span> <a class="sphx-glr-backref-module-nilearn-datasets sphx-glr-backref-type-py-function"href=../../modules/generated/nilearn.datasets.fetch_icbm152_brain_gm_mask.html#nilearn.datasets.fetch_icbm152_brain_gm_mask title=nilearn.datasets.fetch_icbm152_brain_gm_mask><span class=n>datasets</span><span class=o>.</span><span class=n>fetch_icbm152_brain_gm_mask</span></a><span class=p>()</span>
</pre></div></div><p>Resample the images, since this mask has a different resolution.</p><div class="highlight-default notranslate"><div class=highlight><pre><span></span><span class=kn>from</span> <span class=nn>nilearn.image</span> <span class=kn>import</span> <a class="sphx-glr-backref-module-nilearn-image sphx-glr-backref-type-py-function"href=../../modules/generated/nilearn.image.resample_to_img.html#nilearn.image.resample_to_img title=nilearn.image.resample_to_img><span class=n>resample_to_img</span></a>
<a class="sphx-glr-backref-module-nibabel-nifti1 sphx-glr-backref-type-py-class sphx-glr-backref-instance"href=https://nipy.org/nibabel/reference/nibabel.nifti1.html#nibabel.nifti1.Nifti1Image title=nibabel.nifti1.Nifti1Image><span class=n>mask_img</span></a> <span class=o>=</span> <a class="sphx-glr-backref-module-nilearn-image sphx-glr-backref-type-py-function"href=../../modules/generated/nilearn.image.resample_to_img.html#nilearn.image.resample_to_img title=nilearn.image.resample_to_img><span class=n>resample_to_img</span></a><span class=p>(</span>
    <a class="sphx-glr-backref-module-nibabel-nifti1 sphx-glr-backref-type-py-class sphx-glr-backref-instance"href=https://nipy.org/nibabel/reference/nibabel.nifti1.html#nibabel.nifti1.Nifti1Image title=nibabel.nifti1.Nifti1Image><span class=n>gm_mask</span></a><span class=p>,</span> <a class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"href=https://docs.python.org/3.8/library/stdtypes.html#list title=builtins.list><span class=n>gray_matter_map_filenames</span></a><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>interpolation</span><span class=o>=</span><span class=s1>'nearest'</span><span class=p>)</span>
</pre></div></div></div><div class=section id=analyse-data><h2><span class=section-number>9.6.4.3. </span>Analyse data<a title="Permalink to this headline"class=headerlink href=#analyse-data>¶</a></h2><p>First, we create an adequate design matrix with three columns: ‘age’, ‘sex’, ‘intercept’.</p><div class="highlight-default notranslate"><div class=highlight><pre><span></span><span class=kn>import</span> <span class=nn>pandas</span> <span class=k>as</span> <span class=nn>pd</span>
<span class=kn>import</span> <span class=nn>numpy</span> <span class=k>as</span> <span class=nn>np</span>
<a class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"href=https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray title=numpy.ndarray><span class=n>intercept</span></a> <span class=o>=</span> <a class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"href=https://numpy.org/doc/stable/reference/generated/numpy.ones.html#numpy.ones title=numpy.ones><span class=n>np</span><span class=o>.</span><span class=n>ones</span></a><span class=p>(</span><a class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"href=https://docs.python.org/3.8/library/functions.html#int title=builtins.int><span class=n>n_subjects</span></a><span class=p>)</span>
<a class="sphx-glr-backref-module-pandas-core-frame sphx-glr-backref-type-py-class sphx-glr-backref-instance"href=https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html#pandas.DataFrame title=pandas.core.frame.DataFrame><span class=n>design_matrix</span></a> <span class=o>=</span> <a class="sphx-glr-backref-module-pandas-core-frame sphx-glr-backref-type-py-class"href=https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html#pandas.DataFrame title=pandas.core.frame.DataFrame><span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span></a><span class=p>(</span><a class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"href=https://numpy.org/doc/stable/reference/generated/numpy.vstack.html#numpy.vstack title=numpy.vstack><span class=n>np</span><span class=o>.</span><span class=n>vstack</span></a><span class=p>((</span><a class="sphx-glr-backref-module-pandas-core-series sphx-glr-backref-type-py-class sphx-glr-backref-instance"href=https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.html#pandas.Series title=pandas.core.series.Series><span class=n>age</span></a><span class=p>,</span> <a class="sphx-glr-backref-module-pandas-core-series sphx-glr-backref-type-py-class sphx-glr-backref-instance"href=https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.html#pandas.Series title=pandas.core.series.Series><span class=n>sex</span></a><span class=p>,</span> <a class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"href=https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray title=numpy.ndarray><span class=n>intercept</span></a><span class=p>))</span><span class=o>.</span><span class=n>T</span><span class=p>,</span>
                             <span class=n>columns</span><span class=o>=</span><span class=p>[</span><span class=s1>'age'</span><span class=p>,</span> <span class=s1>'sex'</span><span class=p>,</span> <span class=s1>'intercept'</span><span class=p>])</span>
</pre></div></div><p>Let’s plot the design matrix.</p><div class="highlight-default notranslate"><div class=highlight><pre><span></span><span class=kn>from</span> <span class=nn>nilearn.plotting</span> <span class=kn>import</span> <a class="sphx-glr-backref-module-nilearn-plotting sphx-glr-backref-type-py-function"href=../../modules/generated/nilearn.plotting.plot_design_matrix.html#nilearn.plotting.plot_design_matrix title=nilearn.plotting.plot_design_matrix><span class=n>plot_design_matrix</span></a>

<span class=n>ax</span> <span class=o>=</span> <a class="sphx-glr-backref-module-nilearn-plotting sphx-glr-backref-type-py-function"href=../../modules/generated/nilearn.plotting.plot_design_matrix.html#nilearn.plotting.plot_design_matrix title=nilearn.plotting.plot_design_matrix><span class=n>plot_design_matrix</span></a><span class=p>(</span><a class="sphx-glr-backref-module-pandas-core-frame sphx-glr-backref-type-py-class sphx-glr-backref-instance"href=https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html#pandas.DataFrame title=pandas.core.frame.DataFrame><span class=n>design_matrix</span></a><span class=p>)</span>
<a class="sphx-glr-backref-module-matplotlib-axes sphx-glr-backref-type-py-method"href=https://matplotlib.org/stable/api/_as_gen/matplotlib.axes.Axes.set_title.html#matplotlib.axes.Axes.set_title title=matplotlib.axes.Axes.set_title><span class=n>ax</span><span class=o>.</span><span class=n>set_title</span></a><span class=p>(</span><span class=s1>'Second level design matrix'</span><span class=p>,</span> <span class=n>fontsize</span><span class=o>=</span><span class=mi>12</span><span class=p>)</span>
<a class="sphx-glr-backref-module-matplotlib-axes sphx-glr-backref-type-py-method"href=https://matplotlib.org/stable/api/_as_gen/matplotlib.axes.Axes.set_ylabel.html#matplotlib.axes.Axes.set_ylabel title=matplotlib.axes.Axes.set_ylabel><span class=n>ax</span><span class=o>.</span><span class=n>set_ylabel</span></a><span class=p>(</span><span class=s1>'maps'</span><span class=p>)</span>
</pre></div></div><img alt="Second level design matrix"class=sphx-glr-single-img src=../../_images/sphx_glr_plot_oasis_001.png srcset=../../_images/sphx_glr_plot_oasis_001.png><p class=sphx-glr-script-out>Out:</p><div class="sphx-glr-script-out highlight-none notranslate"><div class=highlight><pre><span></span>Text(29.000000000000007, 0.5, 'maps')
</pre></div></div><p>Next, we specify and fit the second-level model when loading the data and also smooth a little bit to improve statistical behavior.</p><div class="highlight-default notranslate"><div class=highlight><pre><span></span><span class=kn>from</span> <span class=nn>nilearn.glm.second_level</span> <span class=kn>import</span> <a class="sphx-glr-backref-module-nilearn-glm-second_level sphx-glr-backref-type-py-class"href=../../modules/generated/nilearn.glm.second_level.SecondLevelModel.html#nilearn.glm.second_level.SecondLevelModel title=nilearn.glm.second_level.SecondLevelModel><span class=n>SecondLevelModel</span></a>
<a class="sphx-glr-backref-module-nilearn-glm-second_level sphx-glr-backref-type-py-class sphx-glr-backref-instance"href=../../modules/generated/nilearn.glm.second_level.SecondLevelModel.html#nilearn.glm.second_level.SecondLevelModel title=nilearn.glm.second_level.SecondLevelModel><span class=n>second_level_model</span></a> <span class=o>=</span> <a class="sphx-glr-backref-module-nilearn-glm-second_level sphx-glr-backref-type-py-class"href=../../modules/generated/nilearn.glm.second_level.SecondLevelModel.html#nilearn.glm.second_level.SecondLevelModel title=nilearn.glm.second_level.SecondLevelModel><span class=n>SecondLevelModel</span></a><span class=p>(</span><span class=n>smoothing_fwhm</span><span class=o>=</span><span class=mf>2.0</span><span class=p>,</span> <a class="sphx-glr-backref-module-nibabel-nifti1 sphx-glr-backref-type-py-class sphx-glr-backref-instance"href=https://nipy.org/nibabel/reference/nibabel.nifti1.html#nibabel.nifti1.Nifti1Image title=nibabel.nifti1.Nifti1Image><span class=n>mask_img</span></a><span class=o>=</span><a class="sphx-glr-backref-module-nibabel-nifti1 sphx-glr-backref-type-py-class sphx-glr-backref-instance"href=https://nipy.org/nibabel/reference/nibabel.nifti1.html#nibabel.nifti1.Nifti1Image title=nibabel.nifti1.Nifti1Image><span class=n>mask_img</span></a><span class=p>)</span>
<a class="sphx-glr-backref-module-nilearn-glm-second_level sphx-glr-backref-type-py-method"href=../../modules/generated/nilearn.glm.second_level.SecondLevelModel.html#nilearn.glm.second_level.SecondLevelModel.fit title=nilearn.glm.second_level.SecondLevelModel.fit><span class=n>second_level_model</span><span class=o>.</span><span class=n>fit</span></a><span class=p>(</span><a class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"href=https://docs.python.org/3.8/library/stdtypes.html#list title=builtins.list><span class=n>gray_matter_map_filenames</span></a><span class=p>,</span>
                       <a class="sphx-glr-backref-module-pandas-core-frame sphx-glr-backref-type-py-class sphx-glr-backref-instance"href=https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html#pandas.DataFrame title=pandas.core.frame.DataFrame><span class=n>design_matrix</span></a><span class=o>=</span><a class="sphx-glr-backref-module-pandas-core-frame sphx-glr-backref-type-py-class sphx-glr-backref-instance"href=https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html#pandas.DataFrame title=pandas.core.frame.DataFrame><span class=n>design_matrix</span></a><span class=p>)</span>
</pre></div></div><p class=sphx-glr-script-out>Out:</p><div class="sphx-glr-script-out highlight-none notranslate"><div class=highlight><pre><span></span>SecondLevelModel(mask_img=&LTnibabel.nifti1.Nifti1Image object at 0x7f9de6a10040>,
                 smoothing_fwhm=2.0)
</pre></div></div><p>Estimating the contrast is very simple. We can just provide the column name of the design matrix.</p><div class="highlight-default notranslate"><div class=highlight><pre><span></span><a class="sphx-glr-backref-module-nibabel-nifti1 sphx-glr-backref-type-py-class sphx-glr-backref-instance"href=https://nipy.org/nibabel/reference/nibabel.nifti1.html#nibabel.nifti1.Nifti1Image title=nibabel.nifti1.Nifti1Image><span class=n>z_map</span></a> <span class=o>=</span> <a class="sphx-glr-backref-module-nilearn-glm-second_level sphx-glr-backref-type-py-method"href=../../modules/generated/nilearn.glm.second_level.SecondLevelModel.html#nilearn.glm.second_level.SecondLevelModel.compute_contrast title=nilearn.glm.second_level.SecondLevelModel.compute_contrast><span class=n>second_level_model</span><span class=o>.</span><span class=n>compute_contrast</span></a><span class=p>(</span><span class=n>second_level_contrast</span><span class=o>=</span><span class=p>[</span><span class=mi>1</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>],</span>
                                            <span class=n>output_type</span><span class=o>=</span><span class=s1>'z_score'</span><span class=p>)</span>
</pre></div></div><p>We threshold the second level contrast at uncorrected p < 0.001 and plot it.</p><div class="highlight-default notranslate"><div class=highlight><pre><span></span><span class=kn>from</span> <span class=nn>nilearn</span> <span class=kn>import</span> <span class=n>plotting</span>
<span class=kn>from</span> <span class=nn>nilearn.glm</span> <span class=kn>import</span> <a class="sphx-glr-backref-module-nilearn-glm sphx-glr-backref-type-py-function"href=../../modules/generated/nilearn.glm.threshold_stats_img.html#nilearn.glm.threshold_stats_img title=nilearn.glm.threshold_stats_img><span class=n>threshold_stats_img</span></a>
<a class="sphx-glr-backref-module-nibabel-nifti1 sphx-glr-backref-type-py-class sphx-glr-backref-instance"href=https://nipy.org/nibabel/reference/nibabel.nifti1.html#nibabel.nifti1.Nifti1Image title=nibabel.nifti1.Nifti1Image><span class=n>_</span></a><span class=p>,</span> <a class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-attribute"href=https://numpy.org/doc/stable/reference/arrays.scalars.html#numpy.float64 title=numpy.float64><span class=n>threshold</span></a> <span class=o>=</span> <a class="sphx-glr-backref-module-nilearn-glm sphx-glr-backref-type-py-function"href=../../modules/generated/nilearn.glm.threshold_stats_img.html#nilearn.glm.threshold_stats_img title=nilearn.glm.threshold_stats_img><span class=n>threshold_stats_img</span></a><span class=p>(</span>
    <a class="sphx-glr-backref-module-nibabel-nifti1 sphx-glr-backref-type-py-class sphx-glr-backref-instance"href=https://nipy.org/nibabel/reference/nibabel.nifti1.html#nibabel.nifti1.Nifti1Image title=nibabel.nifti1.Nifti1Image><span class=n>z_map</span></a><span class=p>,</span> <span class=n>alpha</span><span class=o>=.</span><span class=mi>05</span><span class=p>,</span> <span class=n>height_control</span><span class=o>=</span><span class=s1>'fdr'</span><span class=p>)</span>
<span class=nb>print</span><span class=p>(</span><span class=s1>'The FDR=.05-corrected threshold is: </span><span class=si>%.3g</span><span class=s1>'</span> <span class=o>%</span> <a class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-attribute"href=https://numpy.org/doc/stable/reference/arrays.scalars.html#numpy.float64 title=numpy.float64><span class=n>threshold</span></a><span class=p>)</span>

<a class="sphx-glr-backref-module-nilearn-plotting-displays sphx-glr-backref-type-py-class sphx-glr-backref-instance"href=../../modules/generated/nilearn.plotting.displays.ZSlicer.html#nilearn.plotting.displays.ZSlicer title=nilearn.plotting.displays.ZSlicer><span class=n>display</span></a> <span class=o>=</span> <a class="sphx-glr-backref-module-nilearn-plotting sphx-glr-backref-type-py-function"href=../../modules/generated/nilearn.plotting.plot_stat_map.html#nilearn.plotting.plot_stat_map title=nilearn.plotting.plot_stat_map><span class=n>plotting</span><span class=o>.</span><span class=n>plot_stat_map</span></a><span class=p>(</span>
    <a class="sphx-glr-backref-module-nibabel-nifti1 sphx-glr-backref-type-py-class sphx-glr-backref-instance"href=https://nipy.org/nibabel/reference/nibabel.nifti1.html#nibabel.nifti1.Nifti1Image title=nibabel.nifti1.Nifti1Image><span class=n>z_map</span></a><span class=p>,</span> <a class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-attribute"href=https://numpy.org/doc/stable/reference/arrays.scalars.html#numpy.float64 title=numpy.float64><span class=n>threshold</span></a><span class=o>=</span><a class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-attribute"href=https://numpy.org/doc/stable/reference/arrays.scalars.html#numpy.float64 title=numpy.float64><span class=n>threshold</span></a><span class=p>,</span> <span class=n>colorbar</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>display_mode</span><span class=o>=</span><span class=s1>'z'</span><span class=p>,</span>
    <span class=n>cut_coords</span><span class=o>=</span><span class=p>[</span><span class=o>-</span><span class=mi>4</span><span class=p>,</span> <span class=mi>26</span><span class=p>],</span>
    <span class=n>title</span><span class=o>=</span><span class=s1>'age effect on grey matter density (FDR = .05)'</span><span class=p>)</span>
<a class="sphx-glr-backref-module-nilearn-plotting sphx-glr-backref-type-py-function"href=../../modules/generated/nilearn.plotting.show.html#nilearn.plotting.show title=nilearn.plotting.show><span class=n>plotting</span><span class=o>.</span><span class=n>show</span></a><span class=p>()</span>
</pre></div></div><img alt="plot oasis"class=sphx-glr-single-img src=../../_images/sphx_glr_plot_oasis_002.png srcset=../../_images/sphx_glr_plot_oasis_002.png><p class=sphx-glr-script-out>Out:</p><div class="sphx-glr-script-out highlight-none notranslate"><div class=highlight><pre><span></span>The FDR=.05-corrected threshold is: 2.4
</pre></div></div><p>We can also study the effect of sex by computing the contrast, thresholding it and plot the resulting map.</p><div class="highlight-default notranslate"><div class=highlight><pre><span></span><a class="sphx-glr-backref-module-nibabel-nifti1 sphx-glr-backref-type-py-class sphx-glr-backref-instance"href=https://nipy.org/nibabel/reference/nibabel.nifti1.html#nibabel.nifti1.Nifti1Image title=nibabel.nifti1.Nifti1Image><span class=n>z_map</span></a> <span class=o>=</span> <a class="sphx-glr-backref-module-nilearn-glm-second_level sphx-glr-backref-type-py-method"href=../../modules/generated/nilearn.glm.second_level.SecondLevelModel.html#nilearn.glm.second_level.SecondLevelModel.compute_contrast title=nilearn.glm.second_level.SecondLevelModel.compute_contrast><span class=n>second_level_model</span><span class=o>.</span><span class=n>compute_contrast</span></a><span class=p>(</span><span class=n>second_level_contrast</span><span class=o>=</span><span class=s1>'sex'</span><span class=p>,</span>
                                            <span class=n>output_type</span><span class=o>=</span><span class=s1>'z_score'</span><span class=p>)</span>
<a class="sphx-glr-backref-module-nibabel-nifti1 sphx-glr-backref-type-py-class sphx-glr-backref-instance"href=https://nipy.org/nibabel/reference/nibabel.nifti1.html#nibabel.nifti1.Nifti1Image title=nibabel.nifti1.Nifti1Image><span class=n>_</span></a><span class=p>,</span> <a class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-attribute"href=https://numpy.org/doc/stable/reference/arrays.scalars.html#numpy.float64 title=numpy.float64><span class=n>threshold</span></a> <span class=o>=</span> <a class="sphx-glr-backref-module-nilearn-glm sphx-glr-backref-type-py-function"href=../../modules/generated/nilearn.glm.threshold_stats_img.html#nilearn.glm.threshold_stats_img title=nilearn.glm.threshold_stats_img><span class=n>threshold_stats_img</span></a><span class=p>(</span>
    <a class="sphx-glr-backref-module-nibabel-nifti1 sphx-glr-backref-type-py-class sphx-glr-backref-instance"href=https://nipy.org/nibabel/reference/nibabel.nifti1.html#nibabel.nifti1.Nifti1Image title=nibabel.nifti1.Nifti1Image><span class=n>z_map</span></a><span class=p>,</span> <span class=n>alpha</span><span class=o>=.</span><span class=mi>05</span><span class=p>,</span> <span class=n>height_control</span><span class=o>=</span><span class=s1>'fdr'</span><span class=p>)</span>
<a class="sphx-glr-backref-module-nilearn-plotting sphx-glr-backref-type-py-function"href=../../modules/generated/nilearn.plotting.plot_stat_map.html#nilearn.plotting.plot_stat_map title=nilearn.plotting.plot_stat_map><span class=n>plotting</span><span class=o>.</span><span class=n>plot_stat_map</span></a><span class=p>(</span>
    <a class="sphx-glr-backref-module-nibabel-nifti1 sphx-glr-backref-type-py-class sphx-glr-backref-instance"href=https://nipy.org/nibabel/reference/nibabel.nifti1.html#nibabel.nifti1.Nifti1Image title=nibabel.nifti1.Nifti1Image><span class=n>z_map</span></a><span class=p>,</span> <a class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-attribute"href=https://numpy.org/doc/stable/reference/arrays.scalars.html#numpy.float64 title=numpy.float64><span class=n>threshold</span></a><span class=o>=</span><a class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-attribute"href=https://numpy.org/doc/stable/reference/arrays.scalars.html#numpy.float64 title=numpy.float64><span class=n>threshold</span></a><span class=p>,</span> <span class=n>colorbar</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
    <span class=n>title</span><span class=o>=</span><span class=s1>'sex effect on grey matter density (FDR = .05)'</span><span class=p>)</span>
</pre></div></div><img alt="plot oasis"class=sphx-glr-single-img src=../../_images/sphx_glr_plot_oasis_003.png srcset=../../_images/sphx_glr_plot_oasis_003.png><p class=sphx-glr-script-out>Out:</p><div class="sphx-glr-script-out highlight-none notranslate"><div class=highlight><pre><span></span>&LTnilearn.plotting.displays._slicers.OrthoSlicer object at 0x7f9e14975430>
</pre></div></div><p>Note that there does not seem to be any significant effect of sex on grey matter density on that dataset.</p></div><div class=section id=generating-a-report><h2><span class=section-number>9.6.4.4. </span>Generating a report<a title="Permalink to this headline"class=headerlink href=#generating-a-report>¶</a></h2><p>It can be useful to quickly generate a portable, ready-to-view report with most of the pertinent information. This is easy to do if you have a fitted model and the list of contrasts, which we do here.</p><div class="highlight-default notranslate"><div class=highlight><pre><span></span><span class=kn>from</span> <span class=nn>nilearn.reporting</span> <span class=kn>import</span> <a class="sphx-glr-backref-module-nilearn-reporting sphx-glr-backref-type-py-function"href=../../modules/generated/nilearn.reporting.make_glm_report.html#nilearn.reporting.make_glm_report title=nilearn.reporting.make_glm_report><span class=n>make_glm_report</span></a>

<a class="sphx-glr-backref-module-sklearn-utils sphx-glr-backref-type-py-function"href=https://scikit-learn.org/stable/modules/generated/sklearn.utils.Bunch.html#sklearn.utils.Bunch title=sklearn.utils.Bunch><span class=n>icbm152_2009</span></a> <span class=o>=</span> <a class="sphx-glr-backref-module-nilearn-datasets sphx-glr-backref-type-py-function"href=../../modules/generated/nilearn.datasets.fetch_icbm152_2009.html#nilearn.datasets.fetch_icbm152_2009 title=nilearn.datasets.fetch_icbm152_2009><span class=n>datasets</span><span class=o>.</span><span class=n>fetch_icbm152_2009</span></a><span class=p>()</span>
<span class=n>report</span> <span class=o>=</span> <a class="sphx-glr-backref-module-nilearn-reporting sphx-glr-backref-type-py-function"href=../../modules/generated/nilearn.reporting.make_glm_report.html#nilearn.reporting.make_glm_report title=nilearn.reporting.make_glm_report><span class=n>make_glm_report</span></a><span class=p>(</span><span class=n>model</span><span class=o>=</span><a class="sphx-glr-backref-module-nilearn-glm-second_level sphx-glr-backref-type-py-class sphx-glr-backref-instance"href=../../modules/generated/nilearn.glm.second_level.SecondLevelModel.html#nilearn.glm.second_level.SecondLevelModel title=nilearn.glm.second_level.SecondLevelModel><span class=n>second_level_model</span></a><span class=p>,</span>
                         <span class=n>contrasts</span><span class=o>=</span><span class=p>[</span><span class=s1>'age'</span><span class=p>,</span> <span class=s1>'sex'</span><span class=p>],</span>
                         <span class=n>bg_img</span><span class=o>=</span><a class="sphx-glr-backref-module-sklearn-utils sphx-glr-backref-type-py-function"href=https://scikit-learn.org/stable/modules/generated/sklearn.utils.Bunch.html#sklearn.utils.Bunch title=sklearn.utils.Bunch><span class=n>icbm152_2009</span></a><span class=p>[</span><span class=s1>'t1'</span><span class=p>],</span>
                         <span class=p>)</span>
</pre></div></div><p>We have several ways to access the report:</p><div class="highlight-default notranslate"><div class=highlight><pre><span></span><span class=c1># report  # This report can be viewed in a notebook</span>
<span class=c1># report.save_as_html('report.html')</span>
<span class=c1># report.open_in_browser()</span>
</pre></div></div><p class=sphx-glr-timing><strong>Total running time of the script:</strong> ( 2 minutes 36.504 seconds)</p><p><strong>Estimated memory usage:</strong> 1023 MB</p><div class="sphx-glr-footer class sphx-glr-footer-example docutils container"id=sphx-glr-download-auto-examples-05-glm-second-level-plot-oasis-py><div class="binder-badge docutils container"><a class="reference external image-reference"href=https://mybinder.org/v2/gh/nilearn/nilearn.github.io/main?filepath=examples/auto_examples/05_glm_second_level/plot_oasis.ipynb><img alt="Launch binder"src=../../_images/binder_badge_logo4.svg width=150px></a></div><div class="sphx-glr-download sphx-glr-download-python docutils container"><p><a class="reference download internal"download href=../../_downloads/1020ea2b51f8e38daf607e192d4bdc5d/plot_oasis.py><code class="xref download docutils literal notranslate"><span class=pre>Download</span> <span class=pre>Python</span> <span class=pre>source</span> <span class=pre>code:</span> <span class=pre>plot_oasis.py</span></code></a></p></div><div class="sphx-glr-download sphx-glr-download-jupyter docutils container"><p><a class="reference download internal"download href=../../_downloads/bc534df441f349d0f6e70283606cb03c/plot_oasis.ipynb><code class="xref download docutils literal notranslate"><span class=pre>Download</span> <span class=pre>Jupyter</span> <span class=pre>notebook:</span> <span class=pre>plot_oasis.ipynb</span></code></a></p></div></div><p class=sphx-glr-signature><a class="reference external"href=https://sphinx-gallery.github.io>Gallery generated by Sphinx-Gallery</a></p></div></div><div class=clearer></div></div></div></div><div aria-label="main navigation"class=sphinxsidebar role=navigation><div class=sphinxsidebarwrapper><h4>Giving credit</h4><ul class=simple><li><p>Please consider <a href=../../authors.html#citing>citing the papers</a>.</p></li></ul><h3><a href=../../index.html>Table of Contents</a></h3><ul><li><a class="reference internal"href=#>9.6.4. Voxel-Based Morphometry on Oasis dataset</a><ul><li><a class="reference internal"href=#vbm-analysis-of-aging>9.6.4.1. VBM analysis of aging</a></li><li><a class="reference internal"href=#load-oasis-dataset>9.6.4.2. Load Oasis dataset</a></li><li><a class="reference internal"href=#analyse-data>9.6.4.3. Analyse data</a></li><li><a class="reference internal"href=#generating-a-report>9.6.4.4. Generating a report</a></li></ul></li></ul><h4>Previous topic</h4><p class=topless><a title="previous chapter"href=plot_thresholding.html><span class=section-number>9.6.3. </span>Statistical testing of a second-level analysis</a></p><h4>Next topic</h4><p class=topless><a title="next chapter"href=plot_second_level_two_sample_test.html><span class=section-number>9.6.5. </span>Second-level fMRI model: two-sample test, unpaired and paired</a></p><div id=searchbox role=search style=display:none><h3 id=searchlabel>Quick search</h3><div class=searchformwrapper><form action=../../search.html class=search><input aria-labelledby=searchlabel name=q><input type=submit value=Go></form></div></div><script>$('#searchbox').show(0);</script></div></div><div class=clearer></div></div><div class=footer>© The nilearn developers 2010-2022. Created using <a href=http://sphinx.pocoo.org/>Sphinx</a> 4.0.2. <span style=padding-left:5ex> <a href=../../_sources/auto_examples/05_glm_second_level/plot_oasis.rst.txt rel=nofollow>Show this page source</a> </span></div></body></html>